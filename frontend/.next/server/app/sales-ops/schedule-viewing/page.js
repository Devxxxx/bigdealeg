(()=>{var e={};e.id=4199,e.ids=[4199],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},8243:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>u,tree:()=>o});var r=t(7096),i=t(6132),a=t(7284),l=t.n(a),n=t(2564),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let o=["",{children:["sales-ops",{children:["schedule-viewing",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2373)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\schedule-viewing\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,5627)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\schedule-viewing\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,2776)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,9851)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\schedule-viewing\\page.tsx"],m="/sales-ops/schedule-viewing/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/sales-ops/schedule-viewing/page",pathname:"/sales-ops/schedule-viewing",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},3819:(e,s,t)=>{Promise.resolve().then(t.bind(t,4755))},5303:()=>{},4755:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ScheduleViewing});var r=t(784),i=t(9885),a=t(7114),l=t(1440),n=t.n(l),d=t(6405),o=t(3500),c=t(3431),m=t(2522);function ScheduleViewing(){let{supabase:e}=(0,d.$)(),s=(0,a.useRouter)(),t=(0,a.useSearchParams)(),l=t.get("request"),x=t.get("user"),u=t.get("viewing"),[h,p]=(0,i.useState)(!0),[g,v]=(0,i.useState)(!1),[y,j]=(0,i.useState)(""),[f,b]=(0,i.useState)(!1),[w,N]=(0,i.useState)(null),[_,S]=(0,i.useState)(null),[P,k]=(0,i.useState)(null),[q,C]=(0,i.useState)(null),[E,M]=(0,i.useState)([]),[A,V]=(0,i.useState)(""),[D,F]=(0,i.useState)(""),[Z,I]=(0,i.useState)(""),[T,$]=(0,i.useState)(""),[G,L]=(0,i.useState)(""),[O,R]=(0,i.useState)("confirmed"),z=new Date().toISOString().split("T")[0];(0,i.useEffect)(()=>{let fetchData=async()=>{p(!0);try{if(u){let{data:s,error:t}=await e.from("scheduled_viewings").select(`
              *,
              property:properties(*),
              profile:user_id(*)
            `).eq("id",u).single();if(t)throw t;C(s),V(s.property_id),F(s.viewing_date||""),I(s.viewing_time||""),$(s.notes||""),L(s.private_notes||""),R(s.status),N(s.profile),S(s.property)}else if(l&&x){let{data:s,error:t}=await e.from("profiles").select("*").eq("id",x).single();if(t)throw t;if(N(s),"null"!==l&&"undefined"!==l){let{data:s,error:t}=await e.from("property_requests").select("*").eq("id",l).single();t||k(s)}let{data:r,error:i}=await e.from("properties").select("*").eq("available",!0).order("created_at",{ascending:!1});if(i)throw i;M(r)}else throw Error("Missing required parameters")}catch(e){console.error("Error fetching data:",e),j("Failed to load required data. Please try again.")}finally{p(!1)}};fetchData()},[e,l,x,u]);let handleSubmit=async t=>{t.preventDefault(),v(!0),j("");try{if(!A||!D||!Z)throw Error("Please fill in all required fields");let t={property_id:A,user_id:x,request_id:"null"!==l&&"undefined"!==l?l:null,viewing_date:D,viewing_time:Z,notes:T,private_notes:G,status:O};if(u){let{error:s}=await e.from("scheduled_viewings").update(t).eq("id",u);if(s)throw s}else{let{error:s}=await e.from("scheduled_viewings").insert([t]);if(s)throw s}b(!0),await e.from("notifications").insert([{user_id:x,title:"Viewing Scheduled",message:`A viewing has been ${u?"updated":"scheduled"} for you. Please check your scheduled viewings.`,type:"viewing_scheduled",action_url:"/dashboard/scheduled-viewings",entity_id:A,entity_type:"property"}]),setTimeout(()=>{s.push("/sales-ops/scheduled-viewings")},2e3)}catch(e){console.error("Error saving viewing:",e),j(e.message||"Failed to save viewing. Please try again.")}finally{v(!1)}},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return h?r.jsx("div",{className:"flex justify-center items-center h-64",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)(n(),{href:"/sales-ops/scheduled-viewings",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[r.jsx(o.x_l,{className:"mr-2 h-4 w-4"}),"Back to Scheduled Viewings"]}),r.jsx("h1",{className:"mt-2 text-2xl font-bold text-gray-900",children:u?"Edit Viewing Appointment":"Schedule New Viewing"})]}),f?(0,r.jsxs)(c.Z,{className:"p-6 text-center",children:[r.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:r.jsx(o.FJM,{className:"h-6 w-6 text-green-600"})}),(0,r.jsxs)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:["Viewing ",u?"Updated":"Scheduled"," Successfully"]}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["The viewing has been ",u?"updated":"scheduled"," and the customer has been notified."]}),r.jsx("div",{className:"mt-6",children:r.jsx(m.Z,{variant:"primary",onClick:()=>s.push("/sales-ops/scheduled-viewings"),children:"Go to Scheduled Viewings"})})]}):(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[r.jsx("div",{className:"lg:col-span-2",children:r.jsx(c.Z,{children:(0,r.jsxs)("form",{onSubmit:handleSubmit,children:[(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Viewing Details"}),y&&r.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx(o.G5m,{className:"h-5 w-5 text-red-400 mr-2"}),r.jsx("span",{children:y})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"property",className:"block text-sm font-medium text-gray-700 mb-1",children:["Property ",r.jsx("span",{className:"text-red-500",children:"*"})]}),q||_?(0,r.jsxs)("div",{className:"flex items-center bg-gray-50 p-3 rounded-md",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:r.jsx("img",{className:"h-10 w-10 rounded-md object-cover",src:q?.property?.featured_image||_?.featured_image||"https://via.placeholder.com/100?text=No+Image",alt:""})}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:q?.property?.title||_?.title}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[r.jsx(o.Nh4,{className:"mr-1 h-3 w-3"}),q?.property?.location||_?.location]})]})]}):(0,r.jsxs)("select",{id:"property",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",value:A,onChange:e=>V(e.target.value),required:!0,children:[r.jsx("option",{value:"",children:"Select a property"}),E.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.title," - ",e.location]},e.id))]})]}),q&&q.preferred_dates&&q.preferred_times&&r.jsx("div",{className:"mb-4 bg-yellow-50 p-4 rounded-md",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(o.DAO,{className:"h-5 w-5 text-yellow-400"})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Customer Preferences"}),(0,r.jsxs)("div",{className:"mt-2 text-sm text-yellow-700",children:[(0,r.jsxs)("p",{className:"mb-1",children:[r.jsx("strong",{children:"Preferred dates:"})," ",Array.isArray(q.preferred_dates)&&q.preferred_dates.map(e=>formatDate(e)).join(", ")]}),(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Preferred times:"})," ",Array.isArray(q.preferred_times)&&q.preferred_times.join(", ")]})]})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(o.IiJ,{className:"h-5 w-5 text-gray-400"})}),r.jsx("input",{type:"date",id:"date",className:"focus:ring-primary focus:border-primary block w-full pl-10 sm:text-sm border-gray-300 rounded-md",min:z,value:D,onChange:e=>F(e.target.value),required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700 mb-1",children:["Time ",r.jsx("span",{className:"text-red-500",children:"*"})]}),(0,r.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:r.jsx(o.qyc,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsxs)("select",{id:"time",className:"focus:ring-primary focus:border-primary block w-full pl-10 sm:text-sm border-gray-300 rounded-md",value:Z,onChange:e=>I(e.target.value),required:!0,children:[r.jsx("option",{value:"",children:"Select a time"}),r.jsx("option",{value:"09:00",children:"9:00 AM"}),r.jsx("option",{value:"10:00",children:"10:00 AM"}),r.jsx("option",{value:"11:00",children:"11:00 AM"}),r.jsx("option",{value:"12:00",children:"12:00 PM"}),r.jsx("option",{value:"13:00",children:"1:00 PM"}),r.jsx("option",{value:"14:00",children:"2:00 PM"}),r.jsx("option",{value:"15:00",children:"3:00 PM"}),r.jsx("option",{value:"16:00",children:"4:00 PM"}),r.jsx("option",{value:"17:00",children:"5:00 PM"}),r.jsx("option",{value:"18:00",children:"6:00 PM"})]})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,r.jsxs)("select",{id:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",value:O,onChange:e=>R(e.target.value),children:[r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"confirmed",children:"Confirmed"}),r.jsx("option",{value:"completed",children:"Completed"}),r.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Notes (Visible to customer)"}),r.jsx("textarea",{id:"notes",rows:3,className:"shadow-sm focus:ring-primary focus:border-primary block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Instructions for the customer...",value:T,onChange:e=>$(e.target.value)})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{htmlFor:"privateNotes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Private Notes (Only visible to sales team)"}),r.jsx("textarea",{id:"privateNotes",rows:3,className:"shadow-sm focus:ring-primary focus:border-primary block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Internal notes about this viewing...",value:G,onChange:e=>L(e.target.value)})]})]})]}),r.jsx("div",{className:"px-6 py-3 bg-gray-50 text-right sm:px-6 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[r.jsx(m.Z,{type:"button",variant:"light",onClick:()=>s.back(),children:"Cancel"}),r.jsx(m.Z,{type:"submit",variant:"primary",leftIcon:r.jsx(o.TvB,{}),loading:g,children:g?"Saving...":"Save Viewing"})]})})]})})}),(0,r.jsxs)("div",{children:[r.jsx(c.Z,{children:(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Customer Information"}),w?(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center",children:r.jsx(o.Xws,{className:"h-5 w-5 text-primary-600"})}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.name}),r.jsx("div",{className:"text-sm text-gray-500",children:w.email})]})]}),w.phone&&(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:[r.jsx("div",{className:"font-medium text-gray-700",children:"Phone"}),r.jsx("div",{children:w.phone})]}),r.jsx("div",{className:"mt-6 pt-6 border-t border-gray-100",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[r.jsx(m.Z,{variant:"outline",size:"sm",onClick:()=>s.push(`/sales-ops/customers/${w.id}`),children:"View Profile"}),r.jsx(m.Z,{variant:"outline",size:"sm",onClick:()=>s.push(`/sales-ops/messages?user=${w.id}`),children:"Send Message"})]})})]}):r.jsx("div",{className:"text-center py-4",children:r.jsx("p",{className:"text-sm text-gray-500",children:"Customer information not available"})})]})}),P&&r.jsx(c.Z,{className:"mt-6",children:(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Property Request"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Title"}),r.jsx("div",{className:"mt-1 text-sm text-gray-900",children:P.title})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Property Type"}),r.jsx("div",{className:"mt-1 text-sm text-gray-900",children:P.property_type})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Location"}),r.jsx("div",{className:"mt-1 text-sm text-gray-900",children:P.location})]})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Budget"}),(0,r.jsxs)("div",{className:"mt-1 text-sm text-gray-900",children:[P.min_price.toLocaleString()," - ",P.max_price.toLocaleString()," EGP"]})]}),r.jsx("div",{className:"pt-4 border-t border-gray-100",children:r.jsx(m.Z,{variant:"outline",size:"sm",fullWidth:!0,onClick:()=>s.push(`/sales-ops/requests/${P.id}`),children:"View Full Request"})})]})]})})]})]})]})}},6405:(e,s,t)=>{"use strict";t.d(s,{$:()=>useSupabase}),t(784);let useSupabase=()=>{throw Error("useSupabase has been deprecated. Use the backend API endpoints instead.")}},5627:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ScheduleViewingLayout});var r=t(4656);function ScheduleViewingLayout({children:e}){return r.jsx("div",{className:"p-6",children:e})}},2373:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>a,default:()=>d});var r=t(5153);let i=(0,r.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\app\sales-ops\schedule-viewing\page.tsx`),{__esModule:a,$$typeof:l}=i,n=i.default,d=n}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[657,4043,2076,3500,1407,2070,549,5846,2522,3431,2718],()=>__webpack_exec__(8243));module.exports=t})();