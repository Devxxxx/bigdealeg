(()=>{var e={};e.id=5816,e.ids=[5816],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6221:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o});var a=t(7096),r=t(6132),i=t(7284),l=t.n(i),n=t(2564),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);t.d(s,c);let o=["",{children:["sales-ops",{children:["requests",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4246)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\requests\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,2776)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,9851)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\requests\\page.tsx"],m="/sales-ops/requests/page",x={require:t,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/sales-ops/requests/page",pathname:"/sales-ops/requests",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},5158:(e,s,t)=>{Promise.resolve().then(t.bind(t,1165))},1165:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>CustomerRequests});var a=t(784),r=t(9885),i=t(1440),l=t.n(i),n=t(1332),c=t(7686),o=t(7114),d=t(647),m=t(4383),x=t(345),u=t(5105),p=t(3431),h=t(2522),g=t(2770);function CustomerRequests(){let{session:e}=(0,d.a)();(0,o.useRouter)();let s=(0,o.useSearchParams)(),[t,i]=(0,r.useState)([]),[y,f]=(0,r.useState)(!0),[j,b]=(0,r.useState)(""),[v,N]=(0,r.useState)(0),[w,_]=(0,r.useState)(1),[q]=(0,r.useState)(10),[S,k]=(0,r.useState)({status:s.get("status")||"",location:"",property_type:""}),[C,P]=(0,r.useState)("created_at"),[E,A]=(0,r.useState)("desc"),[F,R]=(0,r.useState)(!1),[I,M]=(0,r.useState)(null),[Z,z]=(0,r.useState)([]);(0,r.useEffect)(()=>{let fetchRequests=async()=>{f(!0);try{if(!e?.access_token){console.error("No access token available");return}let s={searchTerm:j,status:S.status,location:S.location,property_type:S.property_type,sortField:C,sortDirection:E,page:w-1,pageSize:q,viewAll:!0},t=await (0,m.im)(e.access_token,s);console.log("Property requests result:",t),i(t.requests||[]),N(t.totalCount||0)}catch(e){console.error("Error fetching customer requests:",e),x.toast.error("Failed to load property requests")}finally{f(!1)}};fetchRequests()},[e,j,S,C,E,w,q]);let handleSort=e=>{C===e?A("asc"===E?"desc":"asc"):(P(e),A("desc"))},handleFilterChange=(e,s)=>{k(t=>({...t,[e]:s})),_(1)},updateRequestStatus=async(s,a)=>{M(s);try{if(!e?.access_token)throw Error("No access token available");let r={status:a,notes:`Status changed to ${a}`,is_private:!1},{request:l}=await (0,m.Od)(e.access_token,s,r);i(t.map(e=>e.id===s?{...e,status:a}:e)),x.toast.success(`Request status updated to ${a}`)}catch(e){console.error("Error updating request status:",e),x.toast.error("Failed to update request status")}finally{M(null)}},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),formatPriceRange=(e,s)=>{let t=new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0});return`${t.format(e)} - ${t.format(s)}`},D=[...new Set(t.map(e=>e.location))].sort(),T=[...new Set(t.map(e=>e.property_type))].sort(),toggleExpanded=e=>{z(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},getStatusBadge=e=>{switch(e){case"active":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[a.jsx(u._rq,{className:"mr-1 h-3 w-3"}),"Active"]});case"pending":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:[a.jsx(u.bcx,{className:"mr-1 h-3 w-3"}),"Pending"]});case"closed":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[a.jsx(u.$Rx,{className:"mr-1 h-3 w-3"}),"Closed"]});default:return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[a.jsx(u.bcx,{className:"mr-1 h-3 w-3"}),e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown"]})}};return(0,a.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[(0,a.jsxs)("div",{className:"sm:flex sm:items-center sm:justify-between mb-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customer Requests"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage and process property requests from customers"})]}),a.jsx("div",{className:"mt-4 sm:mt-0",children:a.jsx(h.Z,{variant:"gradient",size:"sm",leftIcon:a.jsx(u.Ihx,{}),onClick:()=>R(!F),children:F?"Hide Filters":"Show Filters"})})]}),(0,a.jsxs)(p.Z,{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between",children:[a.jsx("div",{className:"w-full sm:w-2/3 relative",children:a.jsx(g.Z,{type:"text",value:j,onChange:e=>{b(e.target.value),_(1)},placeholder:"Search by title, location, or property type...",leftIcon:a.jsx(u.jRj,{}),rightIcon:j?a.jsx(u.q5L,{}):null,clickableRightIcon:!0,onRightIconClick:()=>b(""),className:"w-full"})}),(0,a.jsxs)("div",{className:"w-full sm:w-auto flex space-x-2 mt-4 sm:mt-0",children:[a.jsx("div",{className:"relative",children:a.jsx(h.Z,{variant:"light",onClick:()=>handleSort("created_at"),rightIcon:"created_at"===C?"asc"===E?a.jsx(u.bTu,{className:"rotate-180"}):a.jsx(u.bTu,{}):null,className:"created_at"===C?"bg-gray-100":"",size:"sm",children:"Date"})}),a.jsx("div",{className:"relative",children:a.jsx(h.Z,{variant:"light",onClick:()=>handleSort("status"),rightIcon:"status"===C?"asc"===E?a.jsx(u.bTu,{className:"rotate-180"}):a.jsx(u.bTu,{}):null,className:"status"===C?"bg-gray-100":"",size:"sm",children:"Status"})})]})]}),a.jsx(c.M,{children:F&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-4 mt-4 border-t border-gray-100",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,a.jsxs)("select",{id:"status-filter",value:S.status,onChange:e=>handleFilterChange("status",e.target.value),className:"block w-full rounded-lg border border-gray-300 py-2 px-3 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[a.jsx("option",{value:"",children:"All Statuses"}),a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"closed",children:"Closed"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"location-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),(0,a.jsxs)("select",{id:"location-filter",value:S.location,onChange:e=>handleFilterChange("location",e.target.value),className:"block w-full rounded-lg border border-gray-300 py-2 px-3 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[a.jsx("option",{value:"",children:"All Locations"}),D.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{htmlFor:"property-type-filter",className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Type"}),(0,a.jsxs)("select",{id:"property-type-filter",value:S.property_type,onChange:e=>handleFilterChange("property_type",e.target.value),className:"block w-full rounded-lg border border-gray-300 py-2 px-3 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[a.jsx("option",{value:"",children:"All Types"}),T.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsx("div",{className:"flex justify-end pt-4 mt-4",children:a.jsx(h.Z,{variant:"outline",size:"sm",onClick:()=>{k({status:"",location:"",property_type:""}),_(1)},children:"Clear Filters"})})]})})]}),y?a.jsx("div",{className:"flex justify-center items-center h-64",children:(0,a.jsxs)("div",{className:"relative h-16 w-16",children:[a.jsx("div",{className:"absolute top-0 left-0 right-0 bottom-0 border-t-4 border-primary-500 border-solid rounded-full animate-spin"}),a.jsx("div",{className:"absolute top-0 left-0 right-0 bottom-0 border-t-4 border-primary-200 border-solid rounded-full opacity-20"})]})}):t.length>0?(0,a.jsxs)("div",{className:"space-y-4",children:[t.map(e=>a.jsx(n.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:I===e.id?"opacity-75":"",children:a.jsx(p.Z,{className:"overflow-hidden",padding:"none",hover:!0,children:(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"sm:flex sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mr-3",children:e.title||`Request #${e.id.substring(0,8)}`}),getStatusBadge(e.status)]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1 mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(u.fzv,{className:"text-primary-500 mr-2 flex-shrink-0"}),a.jsx("span",{children:e.user?.name||"Unknown User"})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(u.i63,{className:"text-primary-500 mr-2 flex-shrink-0"}),a.jsx("span",{children:e.location})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(u.m6D,{className:"text-primary-500 mr-2 flex-shrink-0"}),a.jsx("span",{children:e.property_type})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx(u.oQC,{className:"text-primary-500 mr-2 flex-shrink-0"}),a.jsx("span",{children:formatPriceRange(e.min_price,e.max_price)})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mt-3",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.bedrooms," Beds"]}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.bathrooms," Baths"]}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.area_size," m\xb2"]}),e.created_at&&(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[a.jsx(u.vlc,{className:"mr-1 h-3 w-3"}),formatDate(e.created_at)]})]})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 sm:ml-4 flex sm:flex-col sm:items-end",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{disabled:I===e.id,value:e.status,onChange:s=>updateRequestStatus(e.id,s.target.value),className:"block w-full rounded-lg border border-gray-300 py-2 px-3 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 text-sm",children:[a.jsx("option",{value:"pending",children:"Set as Pending"}),a.jsx("option",{value:"active",children:"Set as Active"}),a.jsx("option",{value:"closed",children:"Set as Closed"})]}),I===e.id&&a.jsx("div",{className:"absolute right-3 top-2.5",children:a.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"})})]}),a.jsx("button",{onClick:()=>toggleExpanded(e.id),className:"mt-3 text-primary-600 hover:text-primary-800 text-sm flex items-center",children:Z.includes(e.id)?(0,a.jsxs)(a.Fragment,{children:["Hide Details ",a.jsx(u.bTu,{className:"ml-1 rotate-180"})]}):(0,a.jsxs)(a.Fragment,{children:["View Details ",a.jsx(u.bTu,{className:"ml-1"})]})})]})]}),a.jsx(c.M,{children:Z.includes(e.id)&&(0,a.jsxs)(n.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-4 pt-4 border-t border-gray-100 overflow-hidden",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Contact Information"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[a.jsx(u.fzv,{className:"text-gray-400 mr-2 h-4 w-4"}),a.jsx("span",{className:"text-gray-600",children:e.user?.name||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[a.jsx(u.Imn,{className:"text-gray-400 mr-2 h-4 w-4"}),a.jsx("span",{className:"text-gray-600",children:e.user?.email||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center text-sm",children:[a.jsx(u.tUt,{className:"text-gray-400 mr-2 h-4 w-4"}),a.jsx("span",{className:"text-gray-600",children:e.user?.phone||"N/A"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex space-x-2",children:[a.jsx(h.Z,{variant:"outline",size:"xs",leftIcon:a.jsx(u.Imn,{}),children:"Email"}),a.jsx(h.Z,{variant:"outline",size:"xs",leftIcon:a.jsx(u.tUt,{}),children:"Call"})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Additional Information"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.additional_features?a.jsx("p",{className:"text-sm text-gray-600 mb-3",children:e.additional_features}):a.jsx("p",{className:"text-sm text-gray-500 italic mb-3",children:"No additional information provided."}),Object.keys(e.custom_fields||{}).length>0&&(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("h5",{className:"text-xs font-medium text-gray-700",children:"Custom Fields:"}),a.jsx("div",{className:"grid grid-cols-2 gap-1",children:Object.entries(e.custom_fields).map(([e,s])=>(0,a.jsxs)("div",{className:"flex items-center text-xs",children:[(0,a.jsxs)("span",{className:"font-medium text-gray-600",children:[e.replace(/_/g," "),":"]}),a.jsx("span",{className:"ml-1 text-gray-600",children:s.toString()})]},e))})]})]})]})]}),a.jsx("div",{className:"mt-4 flex justify-end",children:(0,a.jsxs)(l(),{href:`/sales-ops/requests/${e.id}`,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-sm rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[a.jsx(u.AlO,{className:"mr-1.5 h-4 w-4"}),"Full Details"]})})]})})]})})},e.id)),v>q&&(0,a.jsxs)(p.Z,{className:"p-4 flex items-center justify-between",children:[a.jsx("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",a.jsx("span",{className:"font-medium",children:(w-1)*q+1})," to"," ",a.jsx("span",{className:"font-medium",children:Math.min(w*q,v)})," ","of ",a.jsx("span",{className:"font-medium",children:v})," results"]})}),(0,a.jsxs)("div",{className:"flex space-x-1",children:[a.jsx(h.Z,{variant:"light",size:"sm",onClick:()=>_(Math.max(1,w-1)),disabled:1===w,children:"Previous"}),[...Array(Math.min(5,Math.ceil(v/q)))].map((e,s)=>{let t=s+1;return a.jsx(h.Z,{variant:w===t?"primary":"light",size:"sm",onClick:()=>_(t),children:t},s)}),a.jsx(h.Z,{variant:"light",size:"sm",onClick:()=>_(Math.min(Math.ceil(v/q),w+1)),disabled:w>=Math.ceil(v/q),children:"Next"})]})]})]}):(0,a.jsxs)(p.Z,{className:"p-8 text-center",children:[a.jsx("div",{className:"mx-auto h-20 w-20 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:a.jsx(u.j4u,{className:"h-10 w-10 text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No customer requests found"}),a.jsx("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:j||S.status||S.location||S.property_type?"Try adjusting your search or filters to find what you're looking for.":"Customer requests will appear here once they are submitted."})]})]})}},4246:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>i,default:()=>c});var a=t(5153);let r=(0,a.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\app\sales-ops\requests\page.tsx`),{__esModule:i,$$typeof:l}=r,n=r.default,c=n}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[657,4043,2076,1332,7686,1407,2070,549,5846,2522,3431,2718,2770,4383],()=>__webpack_exec__(6221));module.exports=t})();