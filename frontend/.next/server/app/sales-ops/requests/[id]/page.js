(()=>{var e={};e.id=903,e.ids=[903],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},154:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>o,pages:()=>c,routeModule:()=>h,tree:()=>d});var a=t(7096),r=t(6132),i=t(7284),l=t.n(i),n=t(2564),m={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(m[e]=()=>n[e]);t.d(s,m);let d=["",{children:["sales-ops",{children:["requests",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2620)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\requests\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,2776)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,9851)),"E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\bigdealegy\\bigdealegy\\frontend\\src\\app\\sales-ops\\requests\\[id]\\page.tsx"],o="/sales-ops/requests/[id]/page",x={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/sales-ops/requests/[id]/page",pathname:"/sales-ops/requests/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4508:(e,s,t)=>{Promise.resolve().then(t.bind(t,3245))},3245:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>RequestDetail});var a=t(784),r=t(9885),i=t(7114),l=t(1440),n=t.n(l),m=t(647),d=t(8753),c=t(3500);function RequestDetails({request:e}){let formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(e);return(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[a.jsx("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:e.title||`Property Request #${e.id}`}),a.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Property requirements and specifications"})]})}),a.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:(0,a.jsxs)("dl",{className:"sm:divide-y sm:divide-gray-200",children:[(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.m17,{className:"mr-2 h-4 w-4 text-gray-400"}),"Property Type"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.property_type})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.Nh4,{className:"mr-2 h-4 w-4 text-gray-400"}),"Location"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.location})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.l80,{className:"mr-2 h-4 w-4 text-gray-400"}),"Price Range"]}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:[formatCurrency(e.min_price)," - ",formatCurrency(e.max_price)]})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.f0S,{className:"mr-2 h-4 w-4 text-gray-400"}),"Bedrooms"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.bedrooms})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.MvV,{className:"mr-2 h-4 w-4 text-gray-400"}),"Bathrooms"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.bathrooms})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.BxQ,{className:"mr-2 h-4 w-4 text-gray-400"}),"Area Size"]}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:[e.area_size," m\xb2"]})]}),e.additional_features&&(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Additional Features"}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.additional_features})]}),e.custom_fields&&Object.keys(e.custom_fields).length>0&&(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Custom Fields"}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:a.jsx("ul",{className:"border border-gray-200 rounded-md divide-y divide-gray-200",children:Object.entries(e.custom_fields).map(([e,s])=>(0,a.jsxs)("li",{className:"pl-3 pr-4 py-3 flex items-center justify-between text-sm",children:[a.jsx("div",{className:"w-0 flex-1 flex items-center",children:(0,a.jsxs)("span",{className:"ml-2 flex-1 w-0 truncate font-medium",children:[e,":"]})}),a.jsx("div",{className:"ml-4 flex-shrink-0",children:a.jsx("span",{className:"font-normal",children:s?.toString()||"N/A"})})]},e))})})]})]})})]})}function MatchedProperties({matchedProperties:e,requestId:s}){let formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(e);return(0,a.jsxs)("div",{className:"bg-white shadow sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Matched Properties"}),a.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Properties that match the customer's requirements"})]}),(0,a.jsxs)("div",{className:"text-sm",children:[a.jsx("span",{className:"font-medium",children:e.length})," matches found"]})]}),a.jsx("div",{className:"border-t border-gray-200",children:e.length>0?a.jsx("ul",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("li",{className:"px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-16 w-16 bg-gray-100 rounded-md overflow-hidden",children:e.image_urls&&e.image_urls.length>0?a.jsx("img",{src:e.image_urls[0],alt:e.title,className:"h-full w-full object-cover"}):a.jsx("div",{className:"flex items-center justify-center h-full w-full",children:a.jsx(c.m17,{className:"h-8 w-8 text-gray-400"})})}),(0,a.jsxs)("div",{className:"ml-4 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[a.jsx(c.qvk,{className:"mr-1 h-3 w-3"}),e.matchPercentage,"% Match"]})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[a.jsx(c.Nh4,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),a.jsx("span",{children:e.location})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[a.jsx(c.f0S,{className:"mr-1 h-4 w-4 text-gray-400"}),e.bedrooms]}),(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[a.jsx(c.MvV,{className:"mr-1 h-4 w-4 text-gray-400"}),e.bathrooms]}),(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[a.jsx(c.BxQ,{className:"mr-1 h-4 w-4 text-gray-400"}),e.area_size," m\xb2"]}),a.jsx("span",{className:"font-medium text-gray-900",children:formatCurrency(e.price)})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end space-x-3",children:[(0,a.jsxs)(n(),{href:`/properties/${e.id}`,className:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[a.jsx(c.CkN,{className:"mr-1 h-3 w-3"}),"View Property"]}),(0,a.jsxs)(n(),{href:`/sales-ops/schedule-viewing?property=${e.id}&request=${s}`,className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[a.jsx(c.IiJ,{className:"mr-1 h-3 w-3"}),"Schedule Viewing"]})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-6",children:[a.jsx(c.m17,{className:"mx-auto h-12 w-12 text-gray-300"}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No matching properties"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"There are no properties that match this customer's requirements."}),a.jsx("div",{className:"mt-6",children:a.jsx(n(),{href:"/sales-ops/properties/new",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Add New Property"})})]})})]})}function RequestStatusHistory({statusHistory:e,formatDate:s}){return 0===e.length?a.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Status History"}),a.jsx("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:a.jsx("p",{children:"No status updates have been recorded yet."})})]})}):a.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Status History"}),a.jsx("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:a.jsx("p",{children:"History of status changes for this property request."})}),a.jsx("div",{className:"mt-4 flow-root",children:a.jsx("ul",{className:"-mb-8",children:e.map((t,r)=>a.jsx("li",{children:(0,a.jsxs)("div",{className:"relative pb-8",children:[r!==e.length-1?a.jsx("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}):null,(0,a.jsxs)("div",{className:"relative flex space-x-3",children:[a.jsx("div",{children:a.jsx("span",{className:`h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white
                          ${"pending"===t.new_status?"bg-yellow-100":"active"===t.new_status?"bg-green-100":"bg-gray-100"}`,children:a.jsx("svg",{className:`h-5 w-5 
                            ${"pending"===t.new_status?"text-yellow-600":"active"===t.new_status?"text-green-600":"text-gray-600"}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1 pt-1.5 flex justify-between space-x-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Status changed to"," ",a.jsx("span",{className:"font-medium text-gray-900",children:t.new_status.charAt(0).toUpperCase()+t.new_status.slice(1)}),t.old_status&&(0,a.jsxs)(a.Fragment,{children:[" ","from"," ",a.jsx("span",{className:"font-medium text-gray-900",children:t.old_status.charAt(0).toUpperCase()+t.old_status.slice(1)})]})]}),t.notes&&(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:[t.is_private&&a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 mr-2",children:"Private"}),t.notes]})]}),a.jsx("div",{className:"text-right text-sm whitespace-nowrap text-gray-500",children:a.jsx("time",{dateTime:t.created_at,children:s(t.created_at)})})]})]})]})},t.id))})})]})})}function StatusUpdateForm({request:e,newStatus:s,setNewStatus:t,statusNote:r,setStatusNote:i,isPrivateNote:l,setIsPrivateNote:n,handleStatusUpdate:m,isUpdatingStatus:d,updateError:o}){return a.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Update Request Status"}),a.jsx("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:a.jsx("p",{children:"Change the status of this property request and add notes for the customer or your team."})}),(0,a.jsxs)("form",{onSubmit:m,className:"mt-5",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[a.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,a.jsxs)("select",{id:"status",value:s,onChange:e=>t(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[a.jsx("option",{value:"pending",children:"Pending"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"closed",children:"Closed"})]})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[a.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Status Notes"}),a.jsx("textarea",{id:"notes",rows:3,value:r,onChange:e=>i(e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Add notes about this status change..."})]}),a.jsx("div",{className:"sm:col-span-6",children:(0,a.jsxs)("div",{className:"relative flex items-start",children:[a.jsx("div",{className:"flex items-center h-5",children:a.jsx("input",{id:"private-note",name:"private-note",type:"checkbox",checked:l,onChange:e=>n(e.target.checked),className:"focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded"})}),(0,a.jsxs)("div",{className:"ml-3 text-sm",children:[a.jsx("label",{htmlFor:"private-note",className:"font-medium text-gray-700",children:"Private Note"}),a.jsx("p",{className:"text-gray-500",children:"This note will only be visible to the sales team, not the customer."})]})]})})]}),o&&a.jsx("div",{className:"mt-4 bg-red-50 border-l-4 border-red-400 p-4",children:(0,a.jsxs)("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(c.G5m,{className:"h-5 w-5 text-red-400"})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-red-700",children:o})})]})}),a.jsx("div",{className:"mt-5",children:a.jsx("button",{type:"submit",disabled:d,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(c.TvB,{className:"-ml-1 mr-2 h-4 w-4"}),"Update Status"]})})})]})]})})}function CustomerInfo({user:e}){return e?(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Customer Information"}),a.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Contact and personal details"})]}),a.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:(0,a.jsxs)("dl",{className:"sm:divide-y sm:divide-gray-200",children:[(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.Xws,{className:"mr-2 h-4 w-4 text-gray-400"}),"Full name"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.name})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.SRX,{className:"mr-2 h-4 w-4 text-gray-400"}),"Email address"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:a.jsx("a",{href:`mailto:${e.email}`,className:"text-primary hover:text-primary-dark",children:e.email})})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[a.jsx(c.I7T,{className:"mr-2 h-4 w-4 text-gray-400"}),"Phone number"]}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:a.jsx("a",{href:`tel:${e.phone}`,className:"text-primary hover:text-primary-dark",children:e.phone})})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-gray-500",children:"Role"}),a.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:e.role.charAt(0).toUpperCase()+e.role.slice(1)})]})]})})]}):a.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Customer Information"}),a.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Loading customer details..."})]})})}function ScheduledViewings({viewings:e,loadingViewings:s,formatDate:t,requestId:r,userId:i}){return s?a.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Scheduled Viewings"}),a.jsx("div",{className:"mt-4 flex justify-center",children:a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})]})}):(0,a.jsxs)("div",{className:"bg-white shadow sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Scheduled Viewings"}),a.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Property viewings for this customer"})]}),(0,a.jsxs)(n(),{href:`/sales-ops/schedule-viewing?request=${r}&user=${i}`,className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[a.jsx(c.IiJ,{className:"mr-1 h-3 w-3"}),"Schedule Viewing"]})]}),a.jsx("div",{className:"border-t border-gray-200",children:e.length>0?a.jsx("ul",{className:"divide-y divide-gray-200",children:e.map(e=>a.jsx("li",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(c.m17,{className:"h-5 w-5 text-gray-400"}),a.jsx("span",{className:"ml-1 text-sm font-medium text-gray-900",children:e.property?.title||"Unknown Property"}),(0,a.jsxs)("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                          ${"confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"completed"===e.status?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:["confirmed"===e.status&&a.jsx(c.FJM,{className:"mr-1 h-3 w-3"}),"cancelled"===e.status&&a.jsx(c.G5m,{className:"mr-1 h-3 w-3"}),"pending"===e.status&&a.jsx(c.a4m,{className:"mr-1 h-3 w-3"}),e.status.charAt(0).toUpperCase()+e.status.slice(1)]})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[a.jsx(c.Nh4,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),a.jsx("p",{children:e.property?.location||"Unknown Location"})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(c.IiJ,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),a.jsx("p",{children:e.viewing_date?t(e.viewing_date):"Date TBD"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(c.qyc,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),a.jsx("p",{children:e.viewing_time||"Time TBD"})]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[a.jsx("p",{className:"font-medium",children:"Notes:"}),a.jsx("p",{children:e.notes})]})]}),a.jsx("div",{children:a.jsx(n(),{href:`/sales-ops/viewings/${e.id}`,className:"text-sm text-primary hover:text-primary-dark",children:"View details →"})})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-6",children:[a.jsx(c.IiJ,{className:"mx-auto h-12 w-12 text-gray-300"}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No viewings scheduled"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"This customer hasn't scheduled any property viewings yet."}),a.jsx("div",{className:"mt-6",children:(0,a.jsxs)(n(),{href:`/sales-ops/schedule-viewing?request=${r}&user=${i}`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[a.jsx(c.IiJ,{className:"mr-2 -ml-1 h-5 w-5"}),"Schedule Viewing"]})})]})})]})}function RequestDetail({params:e}){let{id:s}=e,{user:t,session:l}=(0,m.a)(),o=(0,i.useRouter)(),[x,h]=(0,r.useState)(null),[p,u]=(0,r.useState)([]),[g,y]=(0,r.useState)([]),[f,j]=(0,r.useState)(!0),[N,w]=(0,r.useState)(null),[v,b]=(0,r.useState)(!1),[_,q]=(0,r.useState)(""),[k,S]=(0,r.useState)(""),[P,C]=(0,r.useState)(!1),[$,E]=(0,r.useState)(""),[T,A]=(0,r.useState)([]),[D,R]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let fetchRequestData=async()=>{if(!l?.access_token){console.log("No access token available, please log in");return}j(!0);try{let e=await (0,d.Hf)(l.access_token,s);h(e.request),q(e.request.status);let t=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/property-requests/${s}/status-history`,{method:"GET",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();y(e.statusHistory||[])}else console.error("Error fetching status history:",await t.json()),y([]);let a=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/property-requests/${s}/matched-properties`,{method:"GET",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"}});if(a.ok){let e=await a.json();u(e.properties||[])}else console.error("Error fetching matched properties:",await a.json()),u([]);let r=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/users/${e.request.user_id}`,{method:"GET",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"}});if(r.ok){let e=await r.json();w(e.user||null)}else console.error("Error fetching user data:",await r.json()),w(null);let i=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/scheduled-viewings?userId=${e.request.user_id}`,{method:"GET",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"}});if(i.ok){let e=await i.json();A(e.viewings||[])}else console.error("Error fetching scheduled viewings:",await i.json()),A([]);R(!1)}catch(e){console.error("Error fetching request data:",e),o.push("/sales-ops/requests")}finally{j(!1)}};fetchRequestData()},[s,o,l]);let handleStatusUpdate=async e=>{e.preventDefault(),b(!0),E("");try{let e=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/property-requests/${s}/status-update`,{method:"POST",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({status:_,notes:k,isPrivate:P})});if(!e.ok){let s=await e.json();throw Error(s.error?.message||"Failed to update status")}await e.json(),h({...x,status:_});let t=await fetch(`bigdealegypt.up.railway.app/api/sales-ops/property-requests/${s}/status-history`,{method:"GET",headers:{Authorization:`Bearer ${l.access_token}`,"Content-Type":"application/json"}});if(t.ok){let e=await t.json();y(e.statusHistory||[])}S(""),C(!1),b(!1)}catch(e){console.error("Error updating status:",e),E("Failed to update status: "+e.message),b(!1)}},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return f?a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):x?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)(n(),{href:"/sales-ops/requests",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[a.jsx(c.x_l,{className:"mr-2 h-4 w-4"}),"Back to Requests"]}),a.jsx("h1",{className:"mt-2 text-2xl font-bold text-gray-900",children:"Request Details"}),(0,a.jsxs)("div",{className:"mt-1 flex flex-col sm:flex-row sm:flex-wrap sm:mt-0 sm:space-x-6",children:[a.jsx("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:a.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium 
                ${"pending"===x.status?"bg-yellow-100 text-yellow-800":"active"===x.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})}),(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:["Created on ",formatDate(x.created_at)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[a.jsx(RequestDetails,{request:x}),a.jsx(StatusUpdateForm,{request:x,newStatus:_,setNewStatus:q,statusNote:k,setStatusNote:S,isPrivateNote:P,setIsPrivateNote:C,handleStatusUpdate:handleStatusUpdate,isUpdatingStatus:v,updateError:$}),a.jsx(RequestStatusHistory,{statusHistory:g,formatDate:formatDate}),a.jsx(MatchedProperties,{matchedProperties:p,requestId:s})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx(CustomerInfo,{user:N}),a.jsx(ScheduledViewings,{viewings:T,loadingViewings:D,formatDate:formatDate,requestId:s,userId:N?.id})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:a.jsx(c.G5m,{className:"h-6 w-6 text-red-600"})}),a.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Request not found"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The property request you're looking for doesn't exist or you don't have access to it."}),a.jsx("div",{className:"mt-6",children:(0,a.jsxs)(n(),{href:"/sales-ops/requests",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[a.jsx(c.x_l,{className:"mr-2 -ml-1 h-5 w-5"}),"Back to Requests"]})})]})}},2620:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>l,__esModule:()=>i,default:()=>m});var a=t(5153);let r=(0,a.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\app\sales-ops\requests\[id]\page.tsx`),{__esModule:i,$$typeof:l}=r,n=r.default,m=n}};var s=require("../../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[657,4043,2076,3500,1407,2070,549,5846,2718,8753],()=>__webpack_exec__(154));module.exports=t})();