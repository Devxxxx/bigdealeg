exports.id=1407,exports.ids=[1407],exports.modules={5590:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3724,23)),Promise.resolve().then(r.t.bind(r,5365,23)),Promise.resolve().then(r.t.bind(r,4900,23)),Promise.resolve().then(r.t.bind(r,4714,23)),Promise.resolve().then(r.t.bind(r,5392,23)),Promise.resolve().then(r.t.bind(r,8898,23))},7565:(e,t,r)=>{Promise.resolve().then(r.bind(r,345)),Promise.resolve().then(r.bind(r,6984)),Promise.resolve().then(r.bind(r,8262))},6984:(e,t,r)=>{"use strict";r.r(t),r.d(t,{NotificationProvider:()=>NotificationProvider,default:()=>l,useNotifications:()=>useNotifications});var s=r(784),o=r(9885),i=r(647),n=r(9377);r(2856);var a=r(4877);let initFirebase=async()=>{try{return!1}catch(e){return console.error("Error initializing Firebase:",e),!1}},requestNotificationPermission=async()=>{try{{let e=await initFirebase();if(!e)return null}if("granted"!==Notification.permission){let e=await Notification.requestPermission();if("granted"!==e)return console.log("Notification permission denied"),null}let e=await (0,a.LP)(null,{vapidKey:"BJbRlVX8z4Z9uL4vcE1p2Bw78zo_0DqpTUhgRRljS_2vvJuhwR5NZ2htVNmeAYuK6rUqVnjK2VcJKaDMqFgG6VY"});if(e)return console.log("FCM token obtained"),e;return console.log("No registration token available"),null}catch(e){return console.error("Error requesting notification permission:",e),null}},onForegroundMessage=e=>(console.error("Firebase messaging not initialized"),()=>{}),saveFCMToken=async(e,t)=>{try{if(!e||!t)return!1;let r=await fetch("bigdealegypt.up.railway.app/api/notifications/token",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({token:e,device_type:"web"}),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to save FCM token")}let s=await r.json();return s.success}catch(e){return console.error("Error saving FCM token:",e),!1}},c=(0,o.createContext)(null),useNotifications=()=>{let e=(0,o.useContext)(c);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e},NotificationProvider=({children:e})=>{let{user:t,session:r}=(0,i.a)(),{notifications:a}=(0,n.r)(),[l,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(!1),[g,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let setup=async()=>{if(!t||!r?.access_token||!a)return;let e=!1!==a.push_notifications;if(e){let e=await initFirebase();if(h(e),e){let e=await requestNotificationPermission();if(e){let t=await saveFCMToken(e,r.access_token);f(t)}}}};setup()},[t,r?.access_token,a]),(0,o.useEffect)(()=>{if(!d)return;console.log("Setting up foreground message handler");let e=onForegroundMessage(e=>{if(console.log("Foreground message received:",e),"visible"!==document.visibilityState&&"granted"===Notification.permission){let t=new Notification(e.notification.title,{body:e.notification.body,icon:"/logo.png"});t.onclick=e=>{e.preventDefault(),window.focus(),t.close()}}u({id:e.data?.id||Date.now().toString(),title:e.notification.title,message:e.notification.body,type:e.data?.type||"system",related_entity_id:e.data?.entityId,related_entity_type:e.data?.entityType,link:e.data?.link,is_read:!1,created_at:new Date().toISOString()});let t=document.getElementById("notification-sound");t&&t.play().catch(e=>console.log("Error playing notification sound:",e))});return()=>{"function"==typeof e&&e()}},[d]);let togglePushNotifications=async e=>{if(!e)return f(!1),!0;{if(!d){let e=await initFirebase();if(h(e),!e)return!1}let e=await requestNotificationPermission();if(e&&r?.access_token){let t=await saveFCMToken(e,r.access_token);return f(t),t}return!1}};return(0,s.jsxs)(c.Provider,{value:{pushEnabled:g,newNotification:l,togglePushNotifications},children:[s.jsx("audio",{id:"notification-sound",preload:"auto",children:s.jsx("source",{src:"/sounds/notification.mp3",type:"audio/mpeg"})}),e]})},l=NotificationProvider},647:(e,t,r)=>{"use strict";r.d(t,{a:()=>useAuth});var s=r(8262);function useAuth(){let e=(0,s.useAuth)(),t=e.user?.role||"customer",signIn=async(t,r)=>{try{return await e.signIn(t,r),{error:null}}catch(e){return{error:e}}},signUp=async(t,r,s)=>{try{return await e.signUp(t,r,s),{error:null}}catch(e){return{error:e}}};return{...e,role:t,signIn,signUp}}},9377:(e,t,r)=>{"use strict";r.d(t,{r:()=>useSettings});var s=r(9885),o=r(647),i=r(8506);function useSettings(){let[e,t]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),{user:a,session:c}=(0,o.a)(),[l,u]=(0,s.useState)({name:"",email:"",phone:""}),[d,h]=(0,s.useState)({email_notifications:!0,sms_notifications:!0,push_notifications:!0,request_updates:!0,viewing_reminders:!0,marketing_emails:!1}),[g,f]=(0,s.useState)(null),fetchSettings=async()=>{if(!a||!c?.access_token){t(!1);return}t(!0),n(null);try{let e=await i.ZP.getUserSettings(c.access_token);u({name:e.profile.name||"",email:e.profile.email||"",phone:e.profile.phone||""}),h({email_notifications:e.settings.email_notifications??!0,sms_notifications:e.settings.sms_notifications??!0,push_notifications:e.settings.push_notifications??!0,request_updates:e.settings.request_updates??!0,viewing_reminders:e.settings.viewing_reminders??!0,marketing_emails:e.settings.marketing_emails??!1})}catch(e){console.error("Error fetching settings:",e),n(e.message||"Failed to fetch settings")}finally{t(!1)}},fetchSessions=async()=>{if(a&&c?.access_token)try{let e=await i.ZP.getUserSessions(c.access_token);f(e)}catch(e){console.error("Error fetching sessions:",e)}},updateProfile=async()=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{let e=await i.ZP.updateUserProfile(c.access_token,l);return u(t=>({...t,...e})),{success:!0}}catch(e){throw console.error("Error updating profile:",e),e}},updateNotifications=async()=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{let e=await i.ZP.updateNotificationSettings(c.access_token,d);return h(t=>({...t,...e})),{success:!0}}catch(e){throw console.error("Error updating notifications:",e),e}},updatePassword=async e=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{let t=await i.ZP.updatePassword(c.access_token,e);return t}catch(e){throw console.error("Error updating password:",e),e}},exportData=async()=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{let e=await i.ZP.exportUserData(c.access_token);return e}catch(e){throw console.error("Error exporting user data:",e),e}},deleteAccount=async e=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{let t=await i.ZP.deleteUserAccount(c.access_token,e);return t}catch(e){throw console.error("Error deleting account:",e),e}},terminateSession=async e=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{return await i.ZP.terminateSession(c.access_token,e),f(t=>({...t,otherSessions:t.otherSessions.filter(t=>t.id!==e)})),{success:!0}}catch(e){throw console.error("Error terminating session:",e),e}},terminateAllSessions=async()=>{if(!a||!c?.access_token)throw Error("User not authenticated");try{return await i.ZP.terminateAllSessions(c.access_token),f(e=>({...e,otherSessions:[]})),{success:!0}}catch(e){throw console.error("Error terminating all sessions:",e),e}};return(0,s.useEffect)(()=>{fetchSettings(),fetchSessions()},[a,c?.access_token]),{loading:e,error:r,profile:l,setProfile:u,notifications:d,setNotifications:h,sessionData:g,updateProfile,updateNotifications,updatePassword,exportData,deleteAccount,terminateSession,terminateAllSessions,refreshSettings:fetchSettings,refreshSessions:fetchSessions}}},8506:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>o});let s="bigdealegypt.up.railway.app/api",getUserSettings=async e=>{try{let t=await fetch(`${s}/settings`,{method:"GET",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error?.message||"Failed to fetch user settings")}return await t.json()}catch(e){throw console.error("Get user settings error:",e),e}},updateUserProfile=async(e,t)=>{try{let r=await fetch(`${s}/settings/profile`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to update user profile")}return await r.json()}catch(e){throw console.error("Update user profile error:",e),e}},updateNotificationSettings=async(e,t)=>{try{let r=await fetch(`${s}/settings/notifications`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to update notification settings")}return await r.json()}catch(e){throw console.error("Update notification settings error:",e),e}},updatePassword=async(e,t)=>{try{let r=await fetch(`${s}/settings/password`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to update password")}return await r.json()}catch(e){throw console.error("Update password error:",e),e}},exportUserData=async e=>{try{let t=await fetch(`${s}/settings/export`,{method:"GET",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error?.message||"Failed to export user data")}return await t.json()}catch(e){throw console.error("Export user data error:",e),e}},deleteUserAccount=async(e,t)=>{try{let r=await fetch(`${s}/settings/delete-account`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({confirmation:t}),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to delete user account")}return await r.json()}catch(e){throw console.error("Delete user account error:",e),e}},getUserSessions=async e=>{try{let t=await fetch(`${s}/settings/sessions`,{method:"GET",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error?.message||"Failed to fetch user sessions")}return await t.json()}catch(e){throw console.error("Get user sessions error:",e),e}},terminateSession=async(e,t)=>{try{let r=await fetch(`${s}/settings/sessions/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to terminate session")}return await r.json()}catch(e){throw console.error("Terminate session error:",e),e}},terminateAllSessions=async e=>{try{let t=await fetch(`${s}/settings/sessions`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error?.message||"Failed to terminate all sessions")}return await t.json()}catch(e){throw console.error("Terminate all sessions error:",e),e}},o={getUserSettings,updateUserProfile,updateNotificationSettings,updatePassword,exportUserData,deleteUserAccount,getUserSessions,terminateSession,terminateAllSessions}},8262:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthProvider:()=>AuthProvider,default:()=>l,useAuth:()=>useAuth});var s=r(784),o=r(9885);let i="bigdealegypt.up.railway.app/api",signIn=async(e,t)=>{try{let r=await fetch(`${i}/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Authentication failed")}return await r.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,t,r)=>{try{let s=await fetch(`${i}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})});if(!s.ok){let e=await s.json();throw Error(e.error?.message||"Registration failed")}return await s.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let e=await fetch(`${i}/auth/signout`,{method:"POST",credentials:"include"});if(!e.ok){let t=await e.json();throw Error(t.error?.message||"Sign out failed")}return await e.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let t=await fetch(`${i}/auth/session`,{method:"GET",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!t.ok){let e=await t.json();throw Error(e.error?.message||"Failed to retrieve session")}return await t.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let e=await fetch(`${i}/auth/refresh-token`,{method:"POST",credentials:"include"});if(!e.ok){let t=await e.json();throw Error(t.error?.message||"Failed to refresh token")}return await e.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,t)=>{try{let r=await fetch(`${i}/auth/profile/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){let e=await r.json();throw Error(e.error?.message||"Failed to get user profile")}return await r.json()}catch(e){throw console.error("Get user profile error:",e),e}},n={signIn,signUp,signOut,getSession,refreshToken,getUserProfile};var a=r(7114);let c=(0,o.createContext)(void 0),AuthProvider=({children:e})=>{let[t,r]=(0,o.useState)(null),[i,l]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),[h,g]=(0,o.useState)(null),f=(0,a.useRouter)();(0,o.useEffect)(()=>{if(i){let e=new Date(i.expires_at).getTime(),t=Date.now(),r=e-t;if(r<3e5){refreshSession();return}let s=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(s)}},[i]),(0,o.useEffect)(()=>{let initAuth=async()=>{d(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){d(!1);return}let t=await n.getSession(e);t?.user&&t?.session?(r(t.user),l(t.session),localStorage.setItem("access_token",t.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{d(!1)}};initAuth()},[]);let signIn=async(e,t)=>{d(!0),g(null);try{let s=await n.signIn(e,t);s?.user&&s?.session&&(r(s.user),l(s.session),localStorage.setItem("access_token",s.session.access_token),f.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{d(!1)}},signUp=async(e,t,r)=>{d(!0),g(null);try{let s=await n.signUp(e,t,r);s?.user&&f.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{d(!1)}},signOut=async()=>{d(!0);try{await n.signOut(),r(null),l(null),localStorage.removeItem("access_token"),f.push("/")}catch(e){console.error("Sign out error:",e),r(null),l(null),localStorage.removeItem("access_token"),f.push("/")}finally{d(!1)}},refreshSession=async()=>{if(!u)try{let e=await n.refreshToken();e?.user&&e?.session?(r(e.user),l(e.session),localStorage.setItem("access_token",e.session.access_token)):(r(null),l(null),localStorage.removeItem("access_token"),f.push("/login"))}catch(e){console.error("Session refresh error:",e),r(null),l(null),localStorage.removeItem("access_token"),f.push("/login")}};return s.jsx(c.Provider,{value:{user:t,session:i,loading:u,error:h,isAuthenticated:!!t,signIn,signUp,signOut,refreshSession},children:e})},useAuth=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},l=c},9851:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>RootLayout,metadata:()=>y});var s=r(4656),o=r(3732),i=r.n(o);r(4315);var n=r(5153);let a=(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\providers\AuthProvider.tsx`),{__esModule:c,$$typeof:l}=a;a.default;let u=(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\providers\AuthProvider.tsx#AuthProvider`);(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\providers\AuthProvider.tsx#useAuth`);let d=(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\components\providers\NotificationProvider.jsx`),{__esModule:h,$$typeof:g}=d,f=d.default;(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\components\providers\NotificationProvider.jsx#useNotifications`),(0,n.createProxy)(String.raw`E:\bigdealegy\bigdealegy\frontend\src\components\providers\NotificationProvider.jsx#NotificationProvider`),r(3542);var p=r(8204);let y={title:"BigDealEgypt - Property Marketplace",description:"Connect directly with property sellers in Egypt, eliminate brokers and get cashback on purchases",keywords:"egypt, real estate, property, cashback, no brokers, direct selling",authors:[{name:"BigDealEgypt Team"}],colorScheme:"light",themeColor:"#0F766E",viewport:"width=device-width, initial-scale=1"};function RootLayout({children:e}){return(0,s.jsxs)("html",{lang:"en",className:`${i().variable} h-full scroll-smooth`,children:[(0,s.jsxs)("head",{children:[s.jsx("link",{rel:"preload",href:"https://rsms.me/inter/inter.css",as:"style"}),s.jsx("link",{rel:"preload",href:"https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200..800&display=swap",as:"style"})]}),s.jsx("body",{className:"h-full bg-gray-50 text-gray-900 antialiased",children:s.jsx(u,{children:s.jsx(f,{children:(0,s.jsxs)("main",{className:"min-h-screen",children:[e,s.jsx(p.x7,{position:"top-right",toastOptions:{style:{background:"#FFFFFF",color:"#1F2937",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",borderRadius:"0.5rem",border:"1px solid #F3F4F6",padding:"0.75rem 1rem",fontSize:"0.875rem"},success:{style:{borderLeft:"4px solid #16A34A"},iconTheme:{primary:"#16A34A",secondary:"#FFFFFF"}},error:{style:{borderLeft:"4px solid #DC2626"},iconTheme:{primary:"#DC2626",secondary:"#FFFFFF"}},loading:{style:{borderLeft:"4px solid #0F766E"}}}})]})})})})]})}},4315:()=>{}};