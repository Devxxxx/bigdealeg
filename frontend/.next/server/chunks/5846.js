"use strict";exports.id=5846,exports.ids=[5846],exports.modules={1761:(e,t,a)=>{a.d(t,{Z:()=>ProtectedRoute});var i=a(784),s=a(9885),l=a.n(s),r=a(7114),o=a(647);let checkAuthorization=async(e,t=["customer","sales_ops","admin"])=>{try{let a=new URLSearchParams;t&&t.length&&a.append("roles",t.join(","));let i=await fetch(`bigdealegypt.up.railway.app/api/protected-route/check-authorization?${a.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${e}`},credentials:"include"});if(!i.ok){let e=await i.json();throw Error(e.error?.message||"Authorization check failed")}return await i.json()}catch(e){throw console.error("Check authorization error:",e),e}},n={checkAuthorization},d=l().memo(()=>(0,i.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-white z-50",children:[(0,i.jsxs)("div",{className:"w-16 h-16 mb-4 relative",children:[i.jsx("div",{className:"absolute top-0 left-0 w-full h-full border-4 border-primary-100 rounded-full"}),i.jsx("div",{className:"absolute top-0 left-0 w-full h-full border-4 border-primary-600 rounded-full animate-spin border-t-transparent"})]}),i.jsx("p",{className:"text-gray-600 animate-pulse",children:"Loading..."})]})),c=l().memo(()=>{let e=(0,r.useRouter)();return(0,s.useEffect)(()=>{let t=setTimeout(()=>{e.replace("/login")},2e3);return()=>clearTimeout(t)},[e]),i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,i.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,i.jsxs)("div",{className:"bg-red-600 px-6 py-8 text-white",children:[i.jsx("div",{className:"mx-auto w-16 h-16 flex items-center justify-center bg-white bg-opacity-20 rounded-full mb-4",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z",clipRule:"evenodd"})})}),i.jsx("h2",{className:"text-xl font-bold text-center",children:"Access Denied"})]}),i.jsx("div",{className:"px-6 py-8",children:i.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"You don't have permission to access this page. Redirecting to login page..."})})]})})});function ProtectedRoute({children:e,allowedRoles:t=["customer","sales_ops","admin"]}){let[a,l]=(0,s.useState)("loading"),u=(0,r.useRouter)(),{user:h,session:m}=(0,o.a)();return((0,s.useEffect)(()=>{let checkAuthorization=async()=>{try{if(!h||!m?.access_token){l("unauthenticated"),setTimeout(()=>{u.replace("/login")},100);return}let{authState:e}=await n.checkAuthorization(m.access_token,t);"authorized"===e?l("authorized"):l("unauthorized")}catch(e){console.error("Authorization check failed:",e),e instanceof Error&&(e.message.includes("Access denied")||e.message.includes("role not allowed"))?l("unauthorized"):(l("unauthenticated"),setTimeout(()=>{u.replace("/login")},100))}};checkAuthorization()},[t,u,h,m]),"loading"===a)?i.jsx(d,{}):"unauthorized"===a?i.jsx(c,{}):"unauthenticated"===a?i.jsx(d,{}):i.jsx(i.Fragment,{children:e})}},2460:(e,t,a)=>{a.d(t,{Z:()=>UniversalLayout});var i=a(784),s=a(9885),l=a(2070),r=a(549),o=a(7114),n=a(647);function UniversalLayout({children:e,sidebarType:t="customer"}){let{user:a}=(0,n.a)(),[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!0),f=(0,o.usePathname)();(0,s.useEffect)(()=>{h(!1)},[f]),(0,s.useEffect)(()=>{let handleResize=()=>{let e=window.innerWidth>=1024;x(e),e?h(!1):c(!0)};return handleResize(),window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]);let toggleMobileSidebar=()=>{h(!u)};return a?(0,i.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-50",children:[i.jsx("div",{className:"hidden lg:block fixed inset-y-0 left-0 z-20 transition-all duration-300",style:{width:d?"5rem":"16rem"},children:i.jsx(r.Z,{isCollapsed:d,toggleSidebar:()=>{c(!d)},sidebarType:t})}),u&&i.jsx("div",{className:"lg:hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-20 transition-opacity duration-300",onClick:toggleMobileSidebar}),i.jsx("div",{className:`lg:hidden fixed inset-y-0 left-0 z-30 transform transition-transform duration-300 ease-in-out ${u?"translate-x-0":"-translate-x-full"}`,style:{width:"16rem"},children:i.jsx(r.Z,{isCollapsed:!1,toggleSidebar:toggleMobileSidebar,sidebarType:t})}),i.jsx("div",{className:"flex-1 flex flex-col w-full transition-all duration-300",children:(0,i.jsxs)("div",{className:"flex-1 flex flex-col h-screen",style:{marginLeft:m?d?"5rem":"16rem":"0"},children:[i.jsx(l.Z,{toggleSidebar:toggleMobileSidebar,isSidebarCollapsed:d}),i.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:i.jsx("div",{className:"max-w-7xl mx-auto",children:e})})]})})]}):(0,i.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[i.jsx(l.Z,{toggleSidebar:toggleMobileSidebar,isSidebarCollapsed:!1}),i.jsx("main",{className:"flex-1",children:e})]})}}};