"use strict";exports.id=4252,exports.ids=[4252],exports.modules={4252:(e,t,r)=>{r.d(t,{m:()=>usePropertyRequests});var s=r(9885),a=r(647),l=r(4383);function usePropertyRequests(e={}){let[t,r]=(0,s.useState)([]),[o,u]=(0,s.useState)(null),[n,c]=(0,s.useState)(!1),[i,p]=(0,s.useState)(null),[y,d]=(0,s.useState)(e.filters||{}),[g,f]=(0,s.useState)({page:1,limit:10,totalPages:1,totalCount:0}),[_,q]=(0,s.useState)([]),{user:k,session:P}=(0,a.a)(),h=(0,s.useCallback)(async()=>{if(k&&P?.access_token){c(!0),p(null);try{let e=await l.ZP.getPropertyRequests(P.access_token,{...y,page:g.page,limit:g.limit,role:k?.role});console.log("Property requests result:",e),r(e.requests||[]),f({...g,totalPages:e.totalPages||1,totalCount:e.totalCount||0})}catch(e){console.error("Error fetching property requests:",e),p(e.message||"Failed to fetch property requests")}finally{c(!1)}}},[k,P,y,g.page,g.limit]),m=(0,s.useCallback)(async e=>{if(k&&P?.access_token&&e){c(!0),p(null);try{let t=await l.ZP.getPropertyRequestById(P.access_token,e);return u(t),t}catch(e){return console.error("Error fetching property request:",e),p(e.message||"Failed to fetch property request"),null}finally{c(!1)}}},[k,P]),C=(0,s.useCallback)(async e=>{if(!k||!P?.access_token)return null;c(!0),p(null);try{let t=await l.ZP.createPropertyRequest(P.access_token,e);return t}catch(e){return console.error("Error creating property request:",e),p(e.message||"Failed to create property request"),null}finally{c(!1)}},[k,P]),b=(0,s.useCallback)(async(e,t)=>{if(!k||!P?.access_token||!e)return null;c(!0),p(null);try{let s=await l.ZP.updatePropertyRequest(P.access_token,e,t);return o&&o.id===e&&u(s),r(t=>t.map(t=>t.id===e?{...t,...s}:t)),s}catch(e){return console.error("Error updating property request:",e),p(e.message||"Failed to update property request"),null}finally{c(!1)}},[k,P,o]),E=(0,s.useCallback)(async e=>{if(!k||!P?.access_token||!e)return!1;c(!0),p(null);try{return await l.ZP.deletePropertyRequest(P.access_token,e),r(t=>t.filter(t=>t.id!==e)),o&&o.id===e&&u(null),!0}catch(e){return console.error("Error deleting property request:",e),p(e.message||"Failed to delete property request"),!1}finally{c(!1)}},[k,P,o]),F=(0,s.useCallback)(async()=>{if(k&&P?.access_token){c(!0),p(null);try{let e=await l.ZP.getPropertyRequestFields(P.access_token);return q(e||[]),e}catch(e){return console.error("Error fetching property request fields:",e),p(e.message||"Failed to fetch property request fields"),[]}finally{c(!1)}}},[k,P]),R=(0,s.useCallback)(async(e,t,s="")=>{if(!k||!P?.access_token||!e||!t)return null;c(!0),p(null);try{let a=await l.ZP.assignPropertyRequest(P.access_token,e,t,s);return o&&o.id===e&&u({...o,assigned_to:t,assigned_to_profile:a.assigned_to_profile}),r(r=>r.map(r=>r.id===e?{...r,assigned_to:t,assigned_to_profile:a.assigned_to_profile}:r)),a}catch(e){return console.error("Error assigning property request:",e),p(e.message||"Failed to assign property request"),null}finally{c(!1)}},[k,P,o]),w=(0,s.useCallback)(async(e,t)=>{if(!k||!P?.access_token||!e||!t.status)return null;c(!0),p(null);try{let s=await l.ZP.addStatusUpdate(P.access_token,e,t);return o&&o.id===e&&u({...o,status:t.status,status_history:[s.history,...o.status_history||[]]}),r(r=>r.map(r=>r.id===e?{...r,status:t.status}:r)),s}catch(e){return console.error("Error updating property request status:",e),p(e.message||"Failed to update property request status"),null}finally{c(!1)}},[k,P,o]),S=(0,s.useCallback)(e=>{d(t=>({...t,...e})),f(e=>({...e,page:1}))},[]),Z=(0,s.useCallback)(e=>{f(t=>({...t,...e}))},[]);return(0,s.useEffect)(()=>{e.loadOnMount&&h()},[e.loadOnMount,h]),(0,s.useEffect)(()=>{F()},[F]),{requests:t,currentRequest:o,loading:n,error:i,filters:y,pagination:g,fields:_,fetchRequests:h,fetchRequestById:m,createRequest:C,updateRequest:b,deleteRequest:E,fetchFields:F,assignRequest:R,addStatusUpdate:w,updateFilters:S,updatePagination:Z,setCurrentRequest:u}}}};