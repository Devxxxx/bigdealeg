"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1207],{5243:function(e,t,r){r.d(t,{a:function(){return useAuth}});var o=r(4523);function useAuth(){var e;let t=(0,o.useAuth)(),r=(null===(e=t.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,r)=>{try{return await t.signIn(e,r),{error:null}}catch(e){return{error:e}}},signUp=async(e,r,o)=>{try{return await t.signUp(e,r,o),{error:null}}catch(e){return{error:e}}};return{...t,role:r,signIn,signUp}}},2080:function(e,t,r){r.d(t,{Hf:function(){return getPropertyRequestById}});let o="bigdealegypt.up.railway.app/api",getDashboardData=async e=>{try{let r=await fetch("".concat(o,"/sales-ops/dashboard"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch dashboard data")}return await r.json()}catch(e){throw console.error("Get dashboard data error:",e),e}},getProperties=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;for(let[e,r]of Object.entries(t))null!=r&&""!==r&&a.append(e,r.toString());let n=await fetch("".concat(o,"/sales-ops/properties?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!n.ok){var r;let e=await n.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch properties")}return await n.json()}catch(e){throw console.error("Get properties error:",e),e}},togglePropertyAvailability=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/sales-ops/properties/").concat(t,"/toggle-availability"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({currentStatus:r})});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to toggle property availability")}return await n.json()}catch(e){throw console.error("Toggle property availability error:",e),e}},createProperty=async(e,t)=>{try{let a=await fetch("".concat(o,"/sales-ops/properties"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to create property")}return await a.json()}catch(e){throw console.error("Create property error:",e),e}},deleteProperty=async(e,t)=>{try{let a=await fetch("".concat(o,"/sales-ops/properties/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to delete property")}return await a.json()}catch(e){throw console.error("Delete property error:",e),e}},getPropertyRequests=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;for(let[e,r]of Object.entries(t))null!=r&&""!==r&&a.append(e,r.toString());let n=await fetch("".concat(o,"/sales-ops/property-requests?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!n.ok){var r;let e=await n.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch property requests")}return await n.json()}catch(e){throw console.error("Get property requests error:",e),e}},getPropertyRequestById=async(e,t)=>{try{let a=await fetch("".concat(o,"/sales-ops/property-requests/").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch property request")}return await a.json()}catch(e){throw console.error("Get property request error:",e),e}},updatePropertyRequestStatus=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/sales-ops/property-requests/").concat(t,"/status"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({status:r})});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update property request status")}return await n.json()}catch(e){throw console.error("Update property request status error:",e),e}},getScheduledViewings=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;for(let[e,r]of Object.entries(t))null!=r&&""!==r&&a.append(e,r.toString());let n=await fetch("".concat(o,"/sales-ops/scheduled-viewings?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!n.ok){var r;let e=await n.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch scheduled viewings")}return await n.json()}catch(e){throw console.error("Get scheduled viewings error:",e),e}},getScheduledViewingById=async(e,t)=>{try{let a=await fetch("".concat(o,"/sales-ops/scheduled-viewings/").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch scheduled viewing")}return await a.json()}catch(e){throw console.error("Get scheduled viewing error:",e),e}};t.ZP={getDashboardData,getProperties,createProperty,togglePropertyAvailability,deleteProperty,getPropertyRequests,getPropertyRequestById,updatePropertyRequestStatus,getScheduledViewings,getScheduledViewingById}},4523:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},default:function(){return c},useAuth:function(){return useAuth}});var o=r(7437),a=r(2265);let n="bigdealegypt.up.railway.app/api",signIn=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Authentication failed")}return await o.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,t,r)=>{try{let a=await fetch("".concat(n,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})});if(!a.ok){var o;let e=await a.json();throw Error((null===(o=e.error)||void 0===o?void 0:o.message)||"Registration failed")}return await a.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let t=await fetch("".concat(n,"/auth/signout"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await t.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let r=await fetch("".concat(n,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to retrieve session")}return await r.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let t=await fetch("".concat(n,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await t.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to get user profile")}return await o.json()}catch(e){throw console.error("Get user profile error:",e),e}};var s={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},i=r(4033);let l=(0,a.createContext)(void 0),AuthProvider=e=>{let{children:t}=e,[r,n]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[h,d]=(0,a.useState)(!0),[p,g]=(0,a.useState)(null),y=(0,i.useRouter)();(0,a.useEffect)(()=>{if(c){let e=new Date(c.expires_at).getTime(),t=Date.now(),r=e-t;if(r<3e5){refreshSession();return}let o=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(o)}},[c]),(0,a.useEffect)(()=>{let initAuth=async()=>{d(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){d(!1);return}let t=await s.getSession(e);(null==t?void 0:t.user)&&(null==t?void 0:t.session)?(n(t.user),u(t.session),localStorage.setItem("access_token",t.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{d(!1)}};initAuth()},[]);let signIn=async(e,t)=>{d(!0),g(null);try{let r=await s.signIn(e,t);(null==r?void 0:r.user)&&(null==r?void 0:r.session)&&(n(r.user),u(r.session),localStorage.setItem("access_token",r.session.access_token),y.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{d(!1)}},signUp=async(e,t,r)=>{d(!0),g(null);try{let o=await s.signUp(e,t,r);(null==o?void 0:o.user)&&y.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{d(!1)}},signOut=async()=>{d(!0);try{await s.signOut(),n(null),u(null),localStorage.removeItem("access_token"),y.push("/")}catch(e){console.error("Sign out error:",e),n(null),u(null),localStorage.removeItem("access_token"),y.push("/")}finally{d(!1)}},refreshSession=async()=>{if(!h)try{let e=await s.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(n(e.user),u(e.session),localStorage.setItem("access_token",e.session.access_token)):(n(null),u(null),localStorage.removeItem("access_token"),y.push("/login"))}catch(e){console.error("Session refresh error:",e),n(null),u(null),localStorage.removeItem("access_token"),y.push("/login")}};return(0,o.jsx)(l.Provider,{value:{user:r,session:c,loading:h,error:p,isAuthenticated:!!r,signIn,signUp,signOut,refreshSession},children:t})},useAuth=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var c=l}}]);