"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9480],{5243:function(e,t,r){r.d(t,{a:function(){return useAuth}});var o=r(4523);function useAuth(){var e;let t=(0,o.useAuth)(),r=(null===(e=t.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,r)=>{try{return await t.signIn(e,r),{error:null}}catch(e){return{error:e}}},signUp=async(e,r,o)=>{try{return await t.signUp(e,r,o),{error:null}}catch(e){return{error:e}}};return{...t,role:r,signIn,signUp}}},1949:function(e,t,r){r.d(t,{GA:function(){return getUserById},Gw:function(){return getSettings},HG:function(){return deleteFormField},Rf:function(){return getUsers},Sl:function(){return resetSettings},VC:function(){return toggleUserStatus},VP:function(){return updateSettings},WP:function(){return createFormField},ZS:function(){return getDashboardData},bs:function(){return toggleFieldRequired},c7:function(){return updateUserRole},h8:function(){return deleteUser},kN:function(){return updateFormField},ow:function(){return updateFieldOrder},s4:function(){return getFormFields}});let o="bigdealegypt.up.railway.app/api",getDashboardData=async e=>{try{let r=await fetch("".concat(o,"/admin/dashboard"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch dashboard data")}return await r.json()}catch(e){throw console.error("Get dashboard data error:",e),e}},getUsers=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;for(let[e,r]of Object.entries(t))null!=r&&""!==r&&a.append(e,r.toString());let n=await fetch("".concat(o,"/admin/users?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!n.ok){var r;let e=await n.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch users")}return await n.json()}catch(e){throw console.error("Get users error:",e),e}},getUserById=async(e,t)=>{try{let a=await fetch("".concat(o,"/admin/users/").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch user details")}return await a.json()}catch(e){throw console.error("Get user details error:",e),e}},updateUserRole=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/admin/users/").concat(t,"/role"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({role:r})});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update user role")}return await n.json()}catch(e){throw console.error("Update user role error:",e),e}},toggleUserStatus=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/admin/users/").concat(t,"/status"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({is_active:r})});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update user status")}return await n.json()}catch(e){throw console.error("Toggle user status error:",e),e}},deleteUser=async(e,t)=>{try{let a=await fetch("".concat(o,"/admin/users/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to delete user")}return await a.json()}catch(e){throw console.error("Delete user error:",e),e}},getFormFields=async e=>{try{let r=await fetch("".concat(o,"/admin/form-fields"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch form fields")}let a=await r.json();return a.fields||[]}catch(e){throw console.error("Get form fields error:",e),e}},createFormField=async(e,t)=>{try{let a=await fetch("".concat(o,"/admin/form-fields"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to create form field")}let n=await a.json();return n.field}catch(e){throw console.error("Create form field error:",e),e}},updateFormField=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/admin/form-fields/").concat(t),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update form field")}let i=await n.json();return i.field}catch(e){throw console.error("Update form field error:",e),e}},deleteFormField=async(e,t)=>{try{let a=await fetch("".concat(o,"/admin/form-fields/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to delete form field")}return await a.json()}catch(e){throw console.error("Delete form field error:",e),e}},toggleFieldRequired=async(e,t,r)=>{try{let n=await fetch("".concat(o,"/admin/form-fields/").concat(t,"/required"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({required:r})});if(!n.ok){var a;let e=await n.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to toggle field required status")}let i=await n.json();return i.field}catch(e){throw console.error("Toggle field required error:",e),e}},updateFieldOrder=async(e,t,r,a)=>{try{let i=parseInt(r,10),s=parseInt(a,10);if(isNaN(i)||isNaN(s))throw Error("Invalid order values");let l=await fetch("".concat(o,"/admin/form-fields/").concat(t,"/order"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({order:i,targetOrder:s})});if(!l.ok){var n;let e=await l.json();throw Error((null===(n=e.error)||void 0===n?void 0:n.message)||"Failed to update field order")}return await l.json()}catch(e){throw console.error("Update field order error:",e),e}},getSettings=async e=>{try{let r=await fetch("".concat(o,"/admin/settings"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch settings")}let a=await r.json();return a.settings}catch(e){throw console.error("Get settings error:",e),e}},updateSettings=async(e,t)=>{try{let a=await fetch("".concat(o,"/admin/settings"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to update settings")}let n=await a.json();return n.settings}catch(e){throw console.error("Update settings error:",e),e}},resetSettings=async e=>{try{let r=await fetch("".concat(o,"/admin/settings/reset"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to reset settings")}let a=await r.json();return a.settings}catch(e){throw console.error("Reset settings error:",e),e}}},4523:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},default:function(){return c},useAuth:function(){return useAuth}});var o=r(7437),a=r(2265);let n="bigdealegypt.up.railway.app/api",signIn=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Authentication failed")}return await o.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,t,r)=>{try{let a=await fetch("".concat(n,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})});if(!a.ok){var o;let e=await a.json();throw Error((null===(o=e.error)||void 0===o?void 0:o.message)||"Registration failed")}return await a.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let t=await fetch("".concat(n,"/auth/signout"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await t.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let r=await fetch("".concat(n,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to retrieve session")}return await r.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let t=await fetch("".concat(n,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await t.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to get user profile")}return await o.json()}catch(e){throw console.error("Get user profile error:",e),e}};var i={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},s=r(4033);let l=(0,a.createContext)(void 0),AuthProvider=e=>{let{children:t}=e,[r,n]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[d,h]=(0,a.useState)(!0),[f,g]=(0,a.useState)(null),w=(0,s.useRouter)();(0,a.useEffect)(()=>{if(c){let e=new Date(c.expires_at).getTime(),t=Date.now(),r=e-t;if(r<3e5){refreshSession();return}let o=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(o)}},[c]),(0,a.useEffect)(()=>{let initAuth=async()=>{h(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){h(!1);return}let t=await i.getSession(e);(null==t?void 0:t.user)&&(null==t?void 0:t.session)?(n(t.user),u(t.session),localStorage.setItem("access_token",t.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{h(!1)}};initAuth()},[]);let signIn=async(e,t)=>{h(!0),g(null);try{let r=await i.signIn(e,t);(null==r?void 0:r.user)&&(null==r?void 0:r.session)&&(n(r.user),u(r.session),localStorage.setItem("access_token",r.session.access_token),w.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{h(!1)}},signUp=async(e,t,r)=>{h(!0),g(null);try{let o=await i.signUp(e,t,r);(null==o?void 0:o.user)&&w.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{h(!1)}},signOut=async()=>{h(!0);try{await i.signOut(),n(null),u(null),localStorage.removeItem("access_token"),w.push("/")}catch(e){console.error("Sign out error:",e),n(null),u(null),localStorage.removeItem("access_token"),w.push("/")}finally{h(!1)}},refreshSession=async()=>{if(!d)try{let e=await i.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(n(e.user),u(e.session),localStorage.setItem("access_token",e.session.access_token)):(n(null),u(null),localStorage.removeItem("access_token"),w.push("/login"))}catch(e){console.error("Session refresh error:",e),n(null),u(null),localStorage.removeItem("access_token"),w.push("/login")}};return(0,o.jsx)(l.Provider,{value:{user:r,session:c,loading:d,error:f,isAuthenticated:!!r,signIn,signUp,signOut,refreshSession},children:t})},useAuth=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var c=l}}]);