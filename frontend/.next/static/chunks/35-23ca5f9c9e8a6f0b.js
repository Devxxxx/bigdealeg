"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[35],{5243:function(e,t,r){r.d(t,{a:function(){return useAuth}});var o=r(4523);function useAuth(){var e;let t=(0,o.useAuth)(),r=(null===(e=t.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,r)=>{try{return await t.signIn(e,r),{error:null}}catch(e){return{error:e}}},signUp=async(e,r,o)=>{try{return await t.signUp(e,r,o),{error:null}}catch(e){return{error:e}}};return{...t,role:r,signIn,signUp}}},3287:function(e,t,r){let o="bigdealegypt.up.railway.app/api",getUserSettings=async e=>{try{let r=await fetch("".concat(o,"/settings"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch user settings")}return await r.json()}catch(e){throw console.error("Get user settings error:",e),e}},updateUserProfile=async(e,t)=>{try{let s=await fetch("".concat(o,"/settings/profile"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!s.ok){var r;let e=await s.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to update user profile")}return await s.json()}catch(e){throw console.error("Update user profile error:",e),e}},updateNotificationSettings=async(e,t)=>{try{let s=await fetch("".concat(o,"/settings/notifications"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!s.ok){var r;let e=await s.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to update notification settings")}return await s.json()}catch(e){throw console.error("Update notification settings error:",e),e}},updatePassword=async(e,t)=>{try{let s=await fetch("".concat(o,"/settings/password"),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!s.ok){var r;let e=await s.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to update password")}return await s.json()}catch(e){throw console.error("Update password error:",e),e}},exportUserData=async e=>{try{let r=await fetch("".concat(o,"/settings/export"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to export user data")}return await r.json()}catch(e){throw console.error("Export user data error:",e),e}},deleteUserAccount=async(e,t)=>{try{let s=await fetch("".concat(o,"/settings/delete-account"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({confirmation:t}),credentials:"include"});if(!s.ok){var r;let e=await s.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to delete user account")}return await s.json()}catch(e){throw console.error("Delete user account error:",e),e}},getUserSessions=async e=>{try{let r=await fetch("".concat(o,"/settings/sessions"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch user sessions")}return await r.json()}catch(e){throw console.error("Get user sessions error:",e),e}},terminateSession=async(e,t)=>{try{let s=await fetch("".concat(o,"/settings/sessions/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!s.ok){var r;let e=await s.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to terminate session")}return await s.json()}catch(e){throw console.error("Terminate session error:",e),e}},terminateAllSessions=async e=>{try{let r=await fetch("".concat(o,"/settings/sessions"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to terminate all sessions")}return await r.json()}catch(e){throw console.error("Terminate all sessions error:",e),e}};t.ZP={getUserSettings,updateUserProfile,updateNotificationSettings,updatePassword,exportUserData,deleteUserAccount,getUserSessions,terminateSession,terminateAllSessions}},4523:function(e,t,r){r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},default:function(){return l},useAuth:function(){return useAuth}});var o=r(7437),s=r(2265);let n="bigdealegypt.up.railway.app/api",signIn=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Authentication failed")}return await o.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,t,r)=>{try{let s=await fetch("".concat(n,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})});if(!s.ok){var o;let e=await s.json();throw Error((null===(o=e.error)||void 0===o?void 0:o.message)||"Registration failed")}return await s.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let t=await fetch("".concat(n,"/auth/signout"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await t.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let r=await fetch("".concat(n,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to retrieve session")}return await r.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let t=await fetch("".concat(n,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await t.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,t)=>{try{let o=await fetch("".concat(n,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(!o.ok){var r;let e=await o.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to get user profile")}return await o.json()}catch(e){throw console.error("Get user profile error:",e),e}};var a={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},i=r(4033);let c=(0,s.createContext)(void 0),AuthProvider=e=>{let{children:t}=e,[r,n]=(0,s.useState)(null),[l,u]=(0,s.useState)(null),[h,d]=(0,s.useState)(!0),[g,w]=(0,s.useState)(null),f=(0,i.useRouter)();(0,s.useEffect)(()=>{if(l){let e=new Date(l.expires_at).getTime(),t=Date.now(),r=e-t;if(r<3e5){refreshSession();return}let o=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(o)}},[l]),(0,s.useEffect)(()=>{let initAuth=async()=>{d(!0),w(null);try{let e=localStorage.getItem("access_token");if(!e){d(!1);return}let t=await a.getSession(e);(null==t?void 0:t.user)&&(null==t?void 0:t.session)?(n(t.user),u(t.session),localStorage.setItem("access_token",t.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),w("Authentication error. Please login again.")}finally{d(!1)}};initAuth()},[]);let signIn=async(e,t)=>{d(!0),w(null);try{let r=await a.signIn(e,t);(null==r?void 0:r.user)&&(null==r?void 0:r.session)&&(n(r.user),u(r.session),localStorage.setItem("access_token",r.session.access_token),f.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),w(e instanceof Error?e.message:"Authentication failed"),e}finally{d(!1)}},signUp=async(e,t,r)=>{d(!0),w(null);try{let o=await a.signUp(e,t,r);(null==o?void 0:o.user)&&f.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),w(e instanceof Error?e.message:"Registration failed"),e}finally{d(!1)}},signOut=async()=>{d(!0);try{await a.signOut(),n(null),u(null),localStorage.removeItem("access_token"),f.push("/")}catch(e){console.error("Sign out error:",e),n(null),u(null),localStorage.removeItem("access_token"),f.push("/")}finally{d(!1)}},refreshSession=async()=>{if(!h)try{let e=await a.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(n(e.user),u(e.session),localStorage.setItem("access_token",e.session.access_token)):(n(null),u(null),localStorage.removeItem("access_token"),f.push("/login"))}catch(e){console.error("Session refresh error:",e),n(null),u(null),localStorage.removeItem("access_token"),f.push("/login")}};return(0,o.jsx)(c.Provider,{value:{user:r,session:l,loading:h,error:g,isAuthenticated:!!r,signIn,signUp,signOut,refreshSession},children:t})},useAuth=()=>{let e=(0,s.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var l=c}}]);