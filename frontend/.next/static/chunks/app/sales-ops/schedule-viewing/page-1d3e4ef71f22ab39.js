(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4199],{2278:function(e,r,s){Promise.resolve().then(s.bind(s,430))},430:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return ScheduleViewing}});var t=s(7437),a=s(2265),i=s(4033),l=s(1396),n=s.n(l),d=s(7436),o=s(3159),c=s(2595),m=s(4734);function ScheduleViewing(){var e,r,s;let{supabase:l}=(0,d.$)(),u=(0,i.useRouter)(),x=(0,i.useSearchParams)(),h=x.get("request"),g=x.get("user"),p=x.get("viewing"),[v,b]=(0,a.useState)(!0),[y,f]=(0,a.useState)(!1),[j,w]=(0,a.useState)(""),[N,S]=(0,a.useState)(!1),[_,k]=(0,a.useState)(null),[P,C]=(0,a.useState)(null),[q,M]=(0,a.useState)(null),[V,Z]=(0,a.useState)(null),[A,D]=(0,a.useState)([]),[E,F]=(0,a.useState)(""),[I,T]=(0,a.useState)(""),[L,B]=(0,a.useState)(""),[O,z]=(0,a.useState)(""),[G,R]=(0,a.useState)(""),[U,J]=(0,a.useState)("confirmed"),$=new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{let fetchData=async()=>{b(!0);try{if(p){let{data:e,error:r}=await l.from("scheduled_viewings").select("\n              *,\n              property:properties(*),\n              profile:user_id(*)\n            ").eq("id",p).single();if(r)throw r;Z(e),F(e.property_id),T(e.viewing_date||""),B(e.viewing_time||""),z(e.notes||""),R(e.private_notes||""),J(e.status),k(e.profile),C(e.property)}else if(h&&g){let{data:e,error:r}=await l.from("profiles").select("*").eq("id",g).single();if(r)throw r;if(k(e),"null"!==h&&"undefined"!==h){let{data:e,error:r}=await l.from("property_requests").select("*").eq("id",h).single();r||M(e)}let{data:s,error:t}=await l.from("properties").select("*").eq("available",!0).order("created_at",{ascending:!1});if(t)throw t;D(s)}else throw Error("Missing required parameters")}catch(e){console.error("Error fetching data:",e),w("Failed to load required data. Please try again.")}finally{b(!1)}};fetchData()},[l,h,g,p]);let handleSubmit=async e=>{e.preventDefault(),f(!0),w("");try{if(!E||!I||!L)throw Error("Please fill in all required fields");let e={property_id:E,user_id:g,request_id:"null"!==h&&"undefined"!==h?h:null,viewing_date:I,viewing_time:L,notes:O,private_notes:G,status:U};if(p){let{error:r}=await l.from("scheduled_viewings").update(e).eq("id",p);if(r)throw r}else{let{error:r}=await l.from("scheduled_viewings").insert([e]);if(r)throw r}S(!0),await l.from("notifications").insert([{user_id:g,title:"Viewing Scheduled",message:"A viewing has been ".concat(p?"updated":"scheduled"," for you. Please check your scheduled viewings."),type:"viewing_scheduled",action_url:"/dashboard/scheduled-viewings",entity_id:E,entity_type:"property"}]),setTimeout(()=>{u.push("/sales-ops/scheduled-viewings")},2e3)}catch(e){console.error("Error saving viewing:",e),w(e.message||"Failed to save viewing. Please try again.")}finally{f(!1)}},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return v?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)(n(),{href:"/sales-ops/scheduled-viewings",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[(0,t.jsx)(o.x_l,{className:"mr-2 h-4 w-4"}),"Back to Scheduled Viewings"]}),(0,t.jsx)("h1",{className:"mt-2 text-2xl font-bold text-gray-900",children:p?"Edit Viewing Appointment":"Schedule New Viewing"})]}),N?(0,t.jsxs)(c.Z,{className:"p-6 text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:(0,t.jsx)(o.FJM,{className:"h-6 w-6 text-green-600"})}),(0,t.jsxs)("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:["Viewing ",p?"Updated":"Scheduled"," Successfully"]}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["The viewing has been ",p?"updated":"scheduled"," and the customer has been notified."]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(m.Z,{variant:"primary",onClick:()=>u.push("/sales-ops/scheduled-viewings"),children:"Go to Scheduled Viewings"})})]}):(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(c.Z,{children:(0,t.jsxs)("form",{onSubmit:handleSubmit,children:[(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Viewing Details"}),j&&(0,t.jsx)("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(o.G5m,{className:"h-5 w-5 text-red-400 mr-2"}),(0,t.jsx)("span",{children:j})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"property",className:"block text-sm font-medium text-gray-700 mb-1",children:["Property ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),V||P?(0,t.jsxs)("div",{className:"flex items-center bg-gray-50 p-3 rounded-md",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,t.jsx)("img",{className:"h-10 w-10 rounded-md object-cover",src:(null==V?void 0:null===(e=V.property)||void 0===e?void 0:e.featured_image)||(null==P?void 0:P.featured_image)||"https://via.placeholder.com/100?text=No+Image",alt:""})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null==V?void 0:null===(r=V.property)||void 0===r?void 0:r.title)||(null==P?void 0:P.title)}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,t.jsx)(o.Nh4,{className:"mr-1 h-3 w-3"}),(null==V?void 0:null===(s=V.property)||void 0===s?void 0:s.location)||(null==P?void 0:P.location)]})]})]}):(0,t.jsxs)("select",{id:"property",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",value:E,onChange:e=>F(e.target.value),required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select a property"}),A.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.title," - ",e.location]},e.id))]})]}),V&&V.preferred_dates&&V.preferred_times&&(0,t.jsx)("div",{className:"mb-4 bg-yellow-50 p-4 rounded-md",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(o.DAO,{className:"h-5 w-5 text-yellow-400"})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Customer Preferences"}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-yellow-700",children:[(0,t.jsxs)("p",{className:"mb-1",children:[(0,t.jsx)("strong",{children:"Preferred dates:"})," ",Array.isArray(V.preferred_dates)&&V.preferred_dates.map(e=>formatDate(e)).join(", ")]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Preferred times:"})," ",Array.isArray(V.preferred_times)&&V.preferred_times.join(", ")]})]})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(o.IiJ,{className:"h-5 w-5 text-gray-400"})}),(0,t.jsx)("input",{type:"date",id:"date",className:"focus:ring-primary focus:border-primary block w-full pl-10 sm:text-sm border-gray-300 rounded-md",min:$,value:I,onChange:e=>T(e.target.value),required:!0})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{htmlFor:"time",className:"block text-sm font-medium text-gray-700 mb-1",children:["Time ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(o.qyc,{className:"h-5 w-5 text-gray-400"})}),(0,t.jsxs)("select",{id:"time",className:"focus:ring-primary focus:border-primary block w-full pl-10 sm:text-sm border-gray-300 rounded-md",value:L,onChange:e=>B(e.target.value),required:!0,children:[(0,t.jsx)("option",{value:"",children:"Select a time"}),(0,t.jsx)("option",{value:"09:00",children:"9:00 AM"}),(0,t.jsx)("option",{value:"10:00",children:"10:00 AM"}),(0,t.jsx)("option",{value:"11:00",children:"11:00 AM"}),(0,t.jsx)("option",{value:"12:00",children:"12:00 PM"}),(0,t.jsx)("option",{value:"13:00",children:"1:00 PM"}),(0,t.jsx)("option",{value:"14:00",children:"2:00 PM"}),(0,t.jsx)("option",{value:"15:00",children:"3:00 PM"}),(0,t.jsx)("option",{value:"16:00",children:"4:00 PM"}),(0,t.jsx)("option",{value:"17:00",children:"5:00 PM"}),(0,t.jsx)("option",{value:"18:00",children:"6:00 PM"})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,t.jsxs)("select",{id:"status",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",value:U,onChange:e=>J(e.target.value),children:[(0,t.jsx)("option",{value:"pending",children:"Pending"}),(0,t.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,t.jsx)("option",{value:"completed",children:"Completed"}),(0,t.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Notes (Visible to customer)"}),(0,t.jsx)("textarea",{id:"notes",rows:3,className:"shadow-sm focus:ring-primary focus:border-primary block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Instructions for the customer...",value:O,onChange:e=>z(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"privateNotes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Private Notes (Only visible to sales team)"}),(0,t.jsx)("textarea",{id:"privateNotes",rows:3,className:"shadow-sm focus:ring-primary focus:border-primary block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Internal notes about this viewing...",value:G,onChange:e=>R(e.target.value)})]})]})]}),(0,t.jsx)("div",{className:"px-6 py-3 bg-gray-50 text-right sm:px-6 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)(m.Z,{type:"button",variant:"light",onClick:()=>u.back(),children:"Cancel"}),(0,t.jsx)(m.Z,{type:"submit",variant:"primary",leftIcon:(0,t.jsx)(o.TvB,{}),loading:y,children:y?"Saving...":"Save Viewing"})]})})]})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c.Z,{children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Customer Information"}),_?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center",children:(0,t.jsx)(o.Xws,{className:"h-5 w-5 text-primary-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:_.name}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:_.email})]})]}),_.phone&&(0,t.jsxs)("div",{className:"mt-4 text-sm text-gray-500",children:[(0,t.jsx)("div",{className:"font-medium text-gray-700",children:"Phone"}),(0,t.jsx)("div",{children:_.phone})]}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-100",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(m.Z,{variant:"outline",size:"sm",onClick:()=>u.push("/sales-ops/customers/".concat(_.id)),children:"View Profile"}),(0,t.jsx)(m.Z,{variant:"outline",size:"sm",onClick:()=>u.push("/sales-ops/messages?user=".concat(_.id)),children:"Send Message"})]})})]}):(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Customer information not available"})})]})}),q&&(0,t.jsx)(c.Z,{className:"mt-6",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Property Request"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Title"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-gray-900",children:q.title})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Property Type"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-gray-900",children:q.property_type})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Location"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-gray-900",children:q.location})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Budget"}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-gray-900",children:[q.min_price.toLocaleString()," - ",q.max_price.toLocaleString()," EGP"]})]}),(0,t.jsx)("div",{className:"pt-4 border-t border-gray-100",children:(0,t.jsx)(m.Z,{variant:"outline",size:"sm",fullWidth:!0,onClick:()=>u.push("/sales-ops/requests/".concat(q.id)),children:"View Full Request"})})]})]})})]})]})]})}},4734:function(e,r,s){"use strict";s.d(r,{Z:function(){return Button}});var t=s(7437);s(2265);var a=s(1396),i=s.n(a);function LoadingSpinner(e){let{size:r="medium",color:s="primary",className:a=""}=e;return(0,t.jsx)("div",{className:"flex justify-center items-center ".concat(a),children:(0,t.jsx)("div",{className:"\n          rounded-full\n          animate-spin\n          ".concat({small:"h-4 w-4 border-2",medium:"h-8 w-8 border-2",large:"h-12 w-12 border-3"}[r],"\n          ").concat({primary:"border-primary-300 border-t-primary",white:"border-gray-200 border-t-white",gray:"border-gray-200 border-t-gray-600"}[s],"\n        ")})})}function Button(e){let{children:r,variant:s="primary",size:a="md",fullWidth:l=!1,href:n,loading:d=!1,outline:o=!1,rounded:c=!0,glass:m=!1,animation:u="none",className:x="",leftIcon:h,rightIcon:g,...p}=e,v=p.disabled?"opacity-60 cursor-not-allowed":"transform active:scale-[0.98] transition-transform",b="\n    inline-flex items-center justify-center\n    font-medium\n    transition-all duration-200\n    focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\n    ".concat({primary:o?"border-2 border-primary-500 text-primary-600 hover:bg-primary-50 active:bg-primary-100":"bg-primary-600 hover:bg-primary-700 text-white shadow-sm",secondary:o?"border-2 border-gray-400 text-gray-700 hover:bg-gray-50 active:bg-gray-100":"bg-gray-600 hover:bg-gray-700 text-white shadow-sm",success:o?"border-2 border-green-500 text-green-600 hover:bg-green-50 active:bg-green-100":"bg-green-600 hover:bg-green-700 text-white shadow-sm",danger:o?"border-2 border-red-500 text-red-600 hover:bg-red-50 active:bg-red-100":"bg-red-600 hover:bg-red-700 text-white shadow-sm",warning:o?"border-2 border-amber-500 text-amber-600 hover:bg-amber-50 active:bg-amber-100":"bg-amber-500 hover:bg-amber-600 text-white shadow-sm",info:o?"border-2 border-blue-400 text-blue-500 hover:bg-blue-50 active:bg-blue-100":"bg-blue-500 hover:bg-blue-600 text-white shadow-sm",light:o?"border-2 border-gray-200 text-gray-600 hover:bg-gray-50 active:bg-gray-100":"bg-gray-100 hover:bg-gray-200 text-gray-800",dark:o?"border-2 border-gray-700 text-gray-800 hover:bg-gray-800 hover:text-white":"bg-gray-800 hover:bg-gray-900 text-white shadow-sm",outline:"border-2 border-gray-300 text-gray-700 hover:border-primary-500 hover:text-primary-600 bg-white",gradient:"bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white shadow-sm"}[s],"\n    ").concat({xs:"text-xs px-2.5 py-1.5 gap-1",sm:"text-sm px-3 py-2 gap-1.5",md:"text-base px-4 py-2.5 gap-2",lg:"text-lg px-5 py-3 gap-2",xl:"text-xl px-6 py-3.5 gap-2.5"}[a],"\n    ").concat(l?"w-full":"","\n    ").concat(c?"rounded-full":"rounded-lg","\n    ").concat(m?"backdrop-blur-sm bg-opacity-80 shadow-sm":"","\n    ").concat({none:"",pulse:"animate-pulse",bounce:"animate-bounce"}[u],"\n    ").concat(v,"\n    ").concat(x,"\n  ");return n?(0,t.jsxs)(i(),{href:n,className:b,children:[h&&(0,t.jsx)("span",{className:"flex items-center",children:h}),r,g&&(0,t.jsx)("span",{className:"flex items-center",children:g})]}):(0,t.jsxs)("button",{className:b,disabled:d||p.disabled,...p,children:[d?(0,t.jsx)(LoadingSpinner,{size:"small",color:o?"primary":"white"}):h?(0,t.jsx)("span",{className:"flex items-center",children:h}):null,(0,t.jsx)("span",{children:r}),g&&!d&&(0,t.jsx)("span",{className:"flex items-center",children:g})]})}},2595:function(e,r,s){"use strict";s.d(r,{Z:function(){return Card}});var t=s(7437);function Card(e){let{children:r,className:s="",padding:a="small",shadow:i="small",rounded:l="medium",border:n=!1,hover:d=!1,clickable:o=!1}=e;return(0,t.jsx)("div",{className:"\n        bg-white\n        ".concat({none:"p-0",xs:"p-2",small:"p-3",medium:"p-4",large:"p-5"}[a],"\n        ").concat({none:"",small:"shadow-sm",medium:"shadow",large:"shadow-lg"}[i],"\n        ").concat({none:"rounded-none",small:"rounded-md",medium:"rounded-lg",large:"rounded-xl"}[l],"\n        ").concat(n?"border border-gray-100":"","\n        ").concat(d?"transition-all duration-200 hover:shadow-md hover:translate-y-[-1px]":"","\n        ").concat(o?"cursor-pointer active:scale-[0.99] active:shadow-inner transition-transform":"","\n        ").concat(s,"\n      "),children:r})}s(2265)},7436:function(e,r,s){"use strict";s.d(r,{$:function(){return useSupabase}}),s(7437);let useSupabase=()=>{throw Error("useSupabase has been deprecated. Use the backend API endpoints instead.")}},4033:function(e,r,s){e.exports=s(94)}},function(e){e.O(0,[2420,2438,2971,2472,1744],function(){return e(e.s=2278)}),_N_E=e.O()}]);