(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6141],{7368:function(e,s,r){Promise.resolve().then(r.bind(r,5700))},5700:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return PropertiesManagement}});var t=r(7437),a=r(2265),l=r(1396),i=r.n(l),n=r(4033),o=r(5243),c=r(3159),d=r(2080);function PropertiesManagement(){(0,n.useRouter)();let e=(0,n.useSearchParams)(),{session:s}=(0,o.a)(),[r,l]=(0,a.useState)([]),[m,x]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),[u,g]=(0,a.useState)(0),[f,y]=(0,a.useState)(1),[b]=(0,a.useState)(10),[v,j]=(0,a.useState)({location:"",property_type:"",min_price:"",max_price:"",available:e.get("available")||""}),[N,w]=(0,a.useState)("created_at"),[k,_]=(0,a.useState)("desc"),[C,P]=(0,a.useState)(!1),[S,M]=(0,a.useState)([]),[A,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let fetchProperties=async()=>{if(null==s?void 0:s.access_token){x(!0);try{let e={search:h,location:v.location,property_type:v.property_type,min_price:v.min_price,max_price:v.max_price,available:v.available,sortField:N,sortDirection:k,page:f,limit:b},r=await d.ZP.getProperties(s.access_token,e);if(l(r.properties||[]),g(r.count||0),r.properties&&r.properties.length>0){let e=[...new Set(r.properties.map(e=>e.location))].sort();M(e)}}catch(e){console.error("Error fetching properties:",e)}finally{x(!1)}}};fetchProperties()},[null==s?void 0:s.access_token,h,v,N,k,f,b]);let handleSort=e=>{N===e?_("asc"===k?"desc":"asc"):(w(e),_("desc"))},handleFilterChange=e=>{let{name:s,value:r}=e.target;j(e=>({...e,[s]:r})),y(1)},handleAvailabilityToggle=async(e,t)=>{if(null==s?void 0:s.access_token){F(!0);try{await d.ZP.togglePropertyAvailability(s.access_token,e,t),l(r.map(s=>s.id===e?{...s,available:!t}:s))}catch(e){console.error("Error updating property availability:",e)}finally{F(!1)}}},handleDelete=async e=>{if(confirm("Are you sure you want to delete this property? This action cannot be undone.")&&(null==s?void 0:s.access_token)){F(!0);try{await d.ZP.deleteProperty(s.access_token,e),l(r.filter(s=>s.id!==e)),g(u-1)}catch(e){console.error("Error deleting property:",e)}finally{F(!1)}}},formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(e);return(null==s?void 0:s.access_token)?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"sm:flex sm:items-center sm:justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Properties Management"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Add, edit, and manage property listings."})]}),(0,t.jsx)("div",{className:"mt-4 sm:mt-0",children:(0,t.jsxs)(i(),{href:"/sales-ops/properties/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,t.jsx)(c.wEH,{className:"mr-2 -ml-1 h-5 w-5"}),"Add Property"]})})]}),(0,t.jsxs)("div",{className:"mb-6 bg-white rounded-lg shadow p-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between space-y-3 md:space-y-0 mb-4",children:[(0,t.jsxs)("div",{className:"w-full md:w-1/3 relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)(c.U41,{className:"h-5 w-5 text-gray-400"})}),(0,t.jsx)("input",{type:"text",value:h,onChange:e=>{p(e.target.value),y(1)},className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Search properties..."})]}),(0,t.jsxs)("div",{className:"w-full md:w-auto flex space-x-2",children:[(0,t.jsxs)("button",{onClick:()=>P(!C),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,t.jsx)(c.ulB,{className:"mr-2 h-4 w-4"}),C?"Hide Filters":"Show Filters"]}),(0,t.jsx)("div",{children:(0,t.jsxs)("button",{onClick:()=>handleSort("price"),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary ".concat("price"===N?"bg-gray-100":""),children:["Price","price"===N&&("asc"===k?(0,t.jsx)(c.ZF,{className:"ml-1 h-4 w-4 text-gray-500"}):(0,t.jsx)(c.r_,{className:"ml-1 h-4 w-4 text-gray-500"}))]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("button",{onClick:()=>handleSort("created_at"),className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary ".concat("created_at"===N?"bg-gray-100":""),children:["Date Added","created_at"===N&&("asc"===k?(0,t.jsx)(c.ZF,{className:"ml-1 h-4 w-4 text-gray-500"}):(0,t.jsx)(c.r_,{className:"ml-1 h-4 w-4 text-gray-500"}))]})})]})]}),C&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-gray-200",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700",children:"Location"}),(0,t.jsxs)("select",{id:"location",name:"location",value:v.location,onChange:handleFilterChange,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[(0,t.jsx)("option",{value:"",children:"All Locations"}),S.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"property_type",className:"block text-sm font-medium text-gray-700",children:"Property Type"}),(0,t.jsxs)("select",{id:"property_type",name:"property_type",value:v.property_type,onChange:handleFilterChange,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[(0,t.jsx)("option",{value:"",children:"All Types"}),(0,t.jsx)("option",{value:"Apartment",children:"Apartment"}),(0,t.jsx)("option",{value:"Villa",children:"Villa"}),(0,t.jsx)("option",{value:"Townhouse",children:"Townhouse"}),(0,t.jsx)("option",{value:"Penthouse",children:"Penthouse"}),(0,t.jsx)("option",{value:"Chalet",children:"Chalet"}),(0,t.jsx)("option",{value:"Duplex",children:"Duplex"}),(0,t.jsx)("option",{value:"Office",children:"Office"}),(0,t.jsx)("option",{value:"Shop",children:"Shop"}),(0,t.jsx)("option",{value:"Land",children:"Land"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"price_range",className:"block text-sm font-medium text-gray-700",children:"Price Range (EGP)"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[(0,t.jsx)("input",{type:"number",name:"min_price",placeholder:"Min",value:v.min_price,onChange:handleFilterChange,className:"block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md"}),(0,t.jsx)("input",{type:"number",name:"max_price",placeholder:"Max",value:v.max_price,onChange:handleFilterChange,className:"block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"available",className:"block text-sm font-medium text-gray-700",children:"Availability"}),(0,t.jsxs)("select",{id:"available",name:"available",value:v.available,onChange:handleFilterChange,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"true",children:"Available"}),(0,t.jsx)("option",{value:"false",children:"Unavailable"})]})]})]})]}),A&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg",children:[(0,t.jsx)(c.fCD,{className:"animate-spin h-8 w-8 text-primary mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-center text-gray-700",children:"Processing..."})]})}),m?(0,t.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):r.length>0?(0,t.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[(0,t.jsx)("ul",{className:"divide-y divide-gray-200",children:r.map(e=>(0,t.jsx)("li",{children:(0,t.jsx)("div",{className:"px-4 py-4 sm:px-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-16 w-16 bg-gray-200 rounded-md overflow-hidden",children:e.image_urls&&e.image_urls.length>0?(0,t.jsx)("img",{src:e.image_urls[0],alt:e.title,className:"h-full w-full object-cover"}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,t.jsx)(c.m17,{className:"h-8 w-8 text-gray-400"})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,t.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,t.jsx)(c.Nh4,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.location})]}),(0,t.jsxs)("div",{className:"mt-1 text-sm text-gray-500",children:[(0,t.jsxs)("span",{className:"inline-flex items-center",children:[(0,t.jsx)(c.f0S,{className:"mr-1 h-4 w-4"}),e.bedrooms," beds"]}),(0,t.jsxs)("span",{className:"ml-3 inline-flex items-center",children:[(0,t.jsx)(c.MvV,{className:"mr-1 h-4 w-4"}),e.bathrooms," baths"]}),(0,t.jsxs)("span",{className:"ml-3 inline-flex items-center",children:[(0,t.jsx)(c.BxQ,{className:"mr-1 h-4 w-4"}),e.area_size," m\xb2"]})]})]})]}),(0,t.jsxs)("div",{className:"ml-6 flex flex-col items-end",children:[(0,t.jsx)("div",{className:"text-lg font-medium text-gray-900",children:formatCurrency(e.price)}),(0,t.jsxs)("div",{className:"mt-1 flex items-center",children:[(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.available?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.available?"Available":"Unavailable"}),(0,t.jsx)("button",{onClick:()=>handleAvailabilityToggle(e.id,e.available),className:"ml-2 text-gray-400 hover:text-gray-500",title:e.available?"Mark as unavailable":"Mark as available",disabled:A,children:e.available?(0,t.jsx)(c.NCu,{className:"h-5 w-5 text-green-500"}):(0,t.jsx)(c.uYB,{className:"h-5 w-5 text-gray-400"})})]}),(0,t.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,t.jsxs)(i(),{href:"/properties/".concat(e.id),className:"inline-flex items-center px-2 py-1 text-xs text-blue-600 hover:text-blue-800",children:[(0,t.jsx)(c.dSq,{className:"mr-1 h-3 w-3"}),"View"]}),(0,t.jsxs)(i(),{href:"/sales-ops/properties/".concat(e.id,"/edit"),className:"inline-flex items-center px-2 py-1 text-xs text-green-600 hover:text-green-800",children:[(0,t.jsx)(c.fmQ,{className:"mr-1 h-3 w-3"}),"Edit"]}),(0,t.jsxs)("button",{onClick:()=>handleDelete(e.id),className:"inline-flex items-center px-2 py-1 text-xs text-red-600 hover:text-red-800",disabled:A,children:[(0,t.jsx)(c.Xm5,{className:"mr-1 h-3 w-3"}),"Delete"]})]})]})]})})},e.id))}),u>b&&(0,t.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,t.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,t.jsx)("button",{onClick:()=>y(Math.max(1,f-1)),disabled:1===f,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 ".concat(1===f?"opacity-50 cursor-not-allowed":""),children:"Previous"}),(0,t.jsx)("button",{onClick:()=>y(Math.min(Math.ceil(u/b),f+1)),disabled:f>=Math.ceil(u/b),className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 ".concat(f>=Math.ceil(u/b)?"opacity-50 cursor-not-allowed":""),children:"Next"})]}),(0,t.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,t.jsx)("span",{className:"font-medium",children:(f-1)*b+1})," to"," ",(0,t.jsx)("span",{className:"font-medium",children:Math.min(f*b,u)})," ","of ",(0,t.jsx)("span",{className:"font-medium",children:u})," results"]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,t.jsxs)("button",{onClick:()=>y(Math.max(1,f-1)),disabled:1===f,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 ".concat(1===f?"opacity-50 cursor-not-allowed":""),children:[(0,t.jsx)("span",{className:"sr-only",children:"Previous"}),(0,t.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),[...Array(Math.min(5,Math.ceil(u/b)))].map((e,s)=>{let r=s+1;return(0,t.jsx)("button",{onClick:()=>y(r),className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium ".concat(f===r?"bg-primary text-white hover:bg-primary-dark z-10":"text-gray-700 hover:bg-gray-50"),children:r},s)}),(0,t.jsxs)("button",{onClick:()=>y(Math.min(Math.ceil(u/b),f+1)),disabled:f>=Math.ceil(u/b),className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 ".concat(f>=Math.ceil(u/b)?"opacity-50 cursor-not-allowed":""),children:[(0,t.jsx)("span",{className:"sr-only",children:"Next"}),(0,t.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})})]})]})]}):(0,t.jsxs)("div",{className:"bg-white text-center py-10 px-6 shadow sm:rounded-lg",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No properties found"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new property listing."}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)(i(),{href:"/sales-ops/properties/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,t.jsx)(c.wEH,{className:"-ml-1 mr-2 h-5 w-5","aria-hidden":"true"}),"Add New Property"]})})]})]}):(0,t.jsxs)("div",{className:"bg-white text-center py-10 px-6 shadow sm:rounded-lg",children:[(0,t.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Authentication Required"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"You need to be logged in to manage properties."}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(i(),{href:"/login",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Login"})})]})}},4033:function(e,s,r){e.exports=r(94)}},function(e){e.O(0,[2420,2438,1207,2971,2472,1744],function(){return e(e.s=7368)}),_N_E=e.O()}]);