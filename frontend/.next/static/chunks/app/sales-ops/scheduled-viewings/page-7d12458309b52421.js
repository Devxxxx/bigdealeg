(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6120],{4478:function(e,t,s){Promise.resolve().then(s.bind(s,2196))},2196:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ScheduledViewings}});var a=s(7437),l=s(2265),i=s(5243),r=s(2749),n=s(5925),o=s(3159),d=s(1396),c=s.n(d),m=s(8920),x=s(4734),u=s(1393),p=s(8611);function ProposeViewingSlotsModal(e){let{isOpen:t,onClose:s,viewingId:n,propertyTitle:o}=e,{user:d,session:c}=(0,i.a)(),[h,g]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1),[v,j]=(0,l.useState)(null),[w,N]=(0,l.useState)([""]),[b,S]=(0,l.useState)([""]),[k,_]=(0,l.useState)(""),resetForm=()=>{N([""]),S([""]),_(""),y(!1),j(null)},addDate=()=>{N([...w,""])},removeDate=e=>{if(1===w.length)return;let t=[...w];t.splice(e,1),N(t)},updateDate=(e,t)=>{let s=[...w];s[e]=t,N(s)},addTime=()=>{S([...b,""])},removeTime=e=>{if(1===b.length)return;let t=[...b];t.splice(e,1),S(t)},updateTime=(e,t)=>{let s=[...b];s[e]=t,S(s)},validateForm=()=>w.some(e=>!e.trim())?(j("All date fields must be filled"),!1):b.some(e=>!e.trim())?(j("All time fields must be filled"),!1):new Set(w).size!==w.length?(j("Please remove duplicate dates"),!1):new Set(b).size===b.length||(j("Please remove duplicate times"),!1),handleSubmit=async()=>{if(!(null==c?void 0:c.access_token)){j("Authentication error. Please try logging in again.");return}if(validateForm())try{g(!0),j(null),await r.ZP.proposeViewingSlots(c.access_token,n,{proposed_dates:w,proposed_times:b,private_notes:k}),y(!0)}catch(e){console.error("Error proposing viewing slots:",e),j("Failed to propose viewing slots. Please try again.")}finally{g(!1)}};return(0,a.jsx)(u.M,{children:t&&(0,a.jsx)(p.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:s}),(0,a.jsxs)(p.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,a.jsxs)("div",{className:"bg-primary-50 px-4 py-3 sm:px-6 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-primary-900",children:"Propose Viewing Slots"}),(0,a.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500",onClick:()=>{s(),setTimeout(resetForm,300)},children:(0,a.jsx)(m.q5L,{className:"h-6 w-6"})})]}),(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:f?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,a.jsx)(m.UgA,{className:"h-6 w-6 text-green-600"})}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Viewing Slots Proposed"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["You have successfully proposed viewing slots for ",o,". The customer will be notified and can now select their preferred slot."]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:["Propose viewing slots for ",o]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Suggest multiple dates and times for the customer to choose from."}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Dates"}),w.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsxs)("div",{className:"relative flex-grow rounded-md shadow-sm",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.vlc,{className:"text-gray-400"})}),(0,a.jsx)("input",{type:"date",className:"block w-full pl-10 sm:text-sm border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",value:e,onChange:e=>updateDate(t,e.target.value),min:new Date().toISOString().split("T")[0]})]}),w.length>1&&(0,a.jsx)("button",{type:"button",className:"ml-2 p-2 text-gray-400 hover:text-red-500",onClick:()=>removeDate(t),children:(0,a.jsx)(m.ego,{})}),t===w.length-1&&(0,a.jsx)("button",{type:"button",className:"ml-2 p-2 text-gray-400 hover:text-green-500",onClick:addDate,children:(0,a.jsx)(m.OvN,{})})]},t))]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Times"}),b.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsxs)("div",{className:"relative flex-grow rounded-md shadow-sm",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.TCC,{className:"text-gray-400"})}),(0,a.jsx)("input",{type:"time",className:"block w-full pl-10 sm:text-sm border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",value:e,onChange:e=>updateTime(t,e.target.value)})]}),b.length>1&&(0,a.jsx)("button",{type:"button",className:"ml-2 p-2 text-gray-400 hover:text-red-500",onClick:()=>removeTime(t),children:(0,a.jsx)(m.ego,{})}),t===b.length-1&&(0,a.jsx)("button",{type:"button",className:"ml-2 p-2 text-gray-400 hover:text-green-500",onClick:addTime,children:(0,a.jsx)(m.OvN,{})})]},t))]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Private Notes (optional)"}),(0,a.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.IC0,{className:"text-gray-400"})}),(0,a.jsx)("textarea",{rows:3,className:"block w-full pl-10 sm:text-sm border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",placeholder:"Notes for internal use only (not shown to customer)...",value:k,onChange:e=>_(e.target.value)})]})]})]}),v&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:v})]})}),(0,a.jsx)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:f?(0,a.jsx)(x.Z,{variant:"primary",onClick:()=>{s(),setTimeout(resetForm,300)},children:"Done"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Z,{variant:"primary",onClick:handleSubmit,loading:h,children:"Send to Customer"}),(0,a.jsx)(x.Z,{variant:"light",onClick:s,className:"mr-2",children:"Cancel"})]})})]})]})})})}function ScheduledViewings(){var e,t,s,d,m,x,u;let{session:p}=(0,i.a)(),[h,g]=(0,l.useState)([]),[f,y]=(0,l.useState)(!0),[v,j]=(0,l.useState)(""),[w,N]=(0,l.useState)("all"),[b,S]=(0,l.useState)("all"),[k,_]=(0,l.useState)(null),[C,D]=(0,l.useState)(!1),[T,P]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let fetchViewings=async()=>{try{if(y(!0),!(null==p?void 0:p.access_token)){console.error("No access token available");return}let e=await (0,r.U4)(p.access_token,{viewAll:!0,sortBy:"viewing_date",sortDirection:"asc"});console.log("Scheduled viewings response:",e),g(e.viewings||[])}catch(e){console.error("Error fetching viewings:",e),n.toast.error("Failed to load scheduled viewings")}finally{y(!1)}};fetchViewings()},[p]);let openViewingModal=e=>{_(e),D(!0)},openProposeModal=e=>{_(e),P(!0)},updateViewingStatus=async(e,t)=>{try{if(!(null==p?void 0:p.access_token))throw Error("No access token available");"confirmed"===t?await (0,r.G9)(p.access_token,e,{}):"completed"===t?await (0,r.Jt)(p.access_token,e):"cancelled"===t?await (0,r.G)(p.access_token,e):await (0,r.pz)(p.access_token,e,{status:t}),g(h.map(s=>s.id===e?{...s,status:t}:s)),(null==k?void 0:k.id)===e&&_({...k,status:t}),n.toast.success("Viewing status updated to ".concat(t))}catch(e){console.error("Error updating viewing status:",e),n.toast.error("Failed to update viewing status")}},formatDate=e=>{let t=new Date(e);return t.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})},formatTime=e=>{let t=new Date(e);return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},getStatusBadge=e=>{switch(e){case"requested":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,a.jsx)(o.qyc,{className:"mr-1 h-3 w-3"}),"Requested"]});case"options_sent":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)(o.qyc,{className:"mr-1 h-3 w-3"}),"Options Sent"]});case"slot_selected":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[(0,a.jsx)(o.qyc,{className:"mr-1 h-3 w-3"}),"Slot Selected"]});case"confirmed":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,a.jsx)(o.l_A,{className:"mr-1 h-3 w-3"}),"Confirmed"]});case"completed":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)(o.iCz,{className:"mr-1 h-3 w-3"}),"Completed"]});case"cancelled":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,a.jsx)(o.j5f,{className:"mr-1 h-3 w-3"}),"Cancelled"]});default:return(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e})}},isToday=e=>{let t=new Date,s=new Date(e);return s.toDateString()===t.toDateString()},isPast=e=>{let t=new Date,s=new Date(e);return s<t},V=h.filter(e=>{if("all"!==w&&e.status!==w)return!1;if("all"!==b){let t=new Date,s=new Date(e.viewing_date);if("today"===b){if(s.toDateString()!==t.toDateString())return!1}else if("upcoming"===b){if(s<t)return!1}else if("past"===b&&s>t)return!1}if(v){let t=v.toLowerCase();return e.property.title.toLowerCase().includes(t)||e.property.location.toLowerCase().includes(t)||e.profile.name.toLowerCase().includes(t)}return!0});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,a.jsxs)("div",{className:"p-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,a.jsx)(o.IiJ,{className:"mr-3 text-primary"}),"Scheduled Viewings"]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Manage and track property viewing appointments"})]}),(0,a.jsx)("div",{children:(0,a.jsxs)(c(),{href:"/sales-ops/schedule-viewing",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(o.IiJ,{className:"mr-2 -ml-1 h-4 w-4"}),"New Viewing"]})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4",children:[(0,a.jsxs)("div",{className:"relative flex-grow",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(o.U41,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Search property, location, or customer...",value:v,onChange:e=>j(e.target.value)})]}),(0,a.jsxs)("div",{className:"relative w-full md:w-48",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(o.ulB,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsxs)("select",{className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",value:w,onChange:e=>N(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"All Statuses"}),(0,a.jsx)("option",{value:"requested",children:"Requested"}),(0,a.jsx)("option",{value:"options_sent",children:"Options Sent"}),(0,a.jsx)("option",{value:"slot_selected",children:"Slot Selected"}),(0,a.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,a.jsx)("option",{value:"completed",children:"Completed"}),(0,a.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,a.jsxs)("div",{className:"relative w-full md:w-48",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(o.IiJ,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsxs)("select",{className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",value:b,onChange:e=>S(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"All Dates"}),(0,a.jsx)("option",{value:"today",children:"Today"}),(0,a.jsx)("option",{value:"upcoming",children:"Upcoming"}),(0,a.jsx)("option",{value:"past",children:"Past"})]})]})]})})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:f?(0,a.jsx)("div",{className:"flex justify-center items-center p-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):0===V.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 text-4xl mb-4",children:"\uD83D\uDDD3️"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No viewings found"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:v||"all"!==w||"all"!==b?"Try adjusting your search or filters":"No property viewings have been scheduled yet"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Property"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:V.map(e=>{var t,s,l,i,r,n;return(0,a.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(isToday(e.viewing_date)?"bg-blue-50":""),children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,a.jsx)("img",{className:"h-10 w-10 rounded-md object-cover",src:(null===(t=e.property)||void 0===t?void 0:t.featured_image)||"https://via.placeholder.com/100?text=No+Image",alt:""})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(s=e.property)||void 0===s?void 0:s.title)||"Unnamed Property"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,a.jsx)(o.Nh4,{className:"mr-1 h-3 w-3"}),(null===(l=e.property)||void 0===l?void 0:l.location)||"No location"]})]})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(i=e.profile)||void 0===i?void 0:i.name)||"Unknown User"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,a.jsx)(o.SRX,{className:"mr-1 h-3 w-3"}),(null===(r=e.profile)||void 0===r?void 0:r.email)||"No email"]}),(null===(n=e.profile)||void 0===n?void 0:n.phone)&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,a.jsx)(o.I7T,{className:"mr-1 h-3 w-3"}),e.profile.phone]})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:formatDate(e.viewing_date)}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:formatTime(e.viewing_date)}),isToday(e.viewing_date)&&(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Today"}),isPast(e.viewing_date)&&!isToday(e.viewing_date)&&(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Past"})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:getStatusBadge(e.status)}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>openViewingModal(e),className:"text-primary hover:text-primary/80 mr-2",title:"View Details",children:(0,a.jsx)(o.dSq,{className:"h-5 w-5"})}),"requested"===e.status&&(0,a.jsx)("button",{onClick:()=>openProposeModal(e),className:"text-blue-600 hover:text-blue-900 mr-2",title:"Propose Times",children:(0,a.jsx)(o.qyc,{className:"h-5 w-5"})}),"slot_selected"===e.status&&(0,a.jsx)("button",{onClick:()=>updateViewingStatus(e.id,"confirmed"),className:"text-green-600 hover:text-green-900 mr-2",title:"Confirm Viewing",children:(0,a.jsx)(o.l_A,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:()=>"confirmed"===e.status?updateViewingStatus(e.id,"completed"):null,className:"".concat("confirmed"===e.status?"text-blue-600 hover:text-blue-900":"text-gray-300"," mr-2"),disabled:"confirmed"!==e.status,title:"Mark Completed",children:(0,a.jsx)(o.iCz,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:()=>["requested","options_sent","slot_selected","confirmed"].includes(e.status)?updateViewingStatus(e.id,"cancelled"):null,className:"".concat(["requested","options_sent","slot_selected","confirmed"].includes(e.status)?"text-red-600 hover:text-red-900":"text-gray-300"),disabled:!["requested","options_sent","slot_selected","confirmed"].includes(e.status),title:"Cancel Viewing",children:(0,a.jsx)(o.aHS,{className:"h-5 w-5"})})]})]},e.id)})})]})})}),C&&k&&(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto z-50",children:(0,a.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:()=>D(!1),children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,a.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,a.jsx)("div",{className:"sm:flex sm:items-start",children:(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Viewing Details"}),(0,a.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900",children:"Property Information"}),(0,a.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-14 w-14",children:(0,a.jsx)("img",{className:"h-14 w-14 rounded-md object-cover",src:(null===(e=k.property)||void 0===e?void 0:e.featured_image)||"https://via.placeholder.com/100?text=No+Image",alt:""})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(t=k.property)||void 0===t?void 0:t.title)||"Unnamed Property"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center",children:[(0,a.jsx)(o.Nh4,{className:"mr-1 h-3 w-3"}),(null===(s=k.property)||void 0===s?void 0:s.location)||"No location"]}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("a",{href:"/properties/".concat(k.property_id),className:"text-xs text-primary hover:text-primary/80",target:"_blank",rel:"noopener noreferrer",children:"View Property"})})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900",children:"Customer Information"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[(0,a.jsx)(o.Xws,{className:"mr-2 h-4 w-4 text-gray-400"}),(null===(d=k.profile)||void 0===d?void 0:d.name)||"Unknown User"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center mt-1",children:[(0,a.jsx)(o.SRX,{className:"mr-2 h-4 w-4 text-gray-400"}),(null===(m=k.profile)||void 0===m?void 0:m.email)||"No email"]}),(null===(x=k.profile)||void 0===x?void 0:x.phone)&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 flex items-center mt-1",children:[(0,a.jsx)(o.I7T,{className:"mr-2 h-4 w-4 text-gray-400"}),k.profile.phone]})]})]}),(0,a.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,a.jsx)("h4",{className:"text-md font-medium text-gray-900",children:"Appointment Details"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500",children:"Date"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:formatDate(k.viewing_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500",children:"Time"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:formatTime(k.viewing_date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500",children:"Status"}),(0,a.jsx)("div",{className:"text-sm text-gray-900",children:getStatusBadge(k.status)})]})]}),"options_sent"===k.status&&k.proposed_dates&&k.proposed_times&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 rounded-md",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-blue-800 mb-2",children:"Proposed Times"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,a.jsxs)("p",{className:"mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Dates:"})," ",Array.isArray(k.proposed_dates)&&k.proposed_dates.map(e=>new Date(e).toLocaleDateString()).join(", ")]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Times:"})," ",Array.isArray(k.proposed_times)&&k.proposed_times.join(", ")]})]})]}),"slot_selected"===k.status&&k.selected_date&&k.selected_time&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-purple-50 rounded-md",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-purple-800 mb-2",children:"Selected Time"}),(0,a.jsxs)("div",{className:"text-sm text-purple-700",children:[(0,a.jsxs)("p",{className:"mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Date:"})," ",new Date(k.selected_date).toLocaleDateString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Time:"})," ",k.selected_time]})]})]}),k.notes&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-500",children:"Notes"}),(0,a.jsx)("div",{className:"text-sm text-gray-900 mt-1 bg-gray-50 p-2 rounded",children:k.notes})]})]})]})})}),(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,a.jsx)("button",{type:"button",onClick:()=>D(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",children:"Close"}),"requested"===k.status&&(0,a.jsxs)("button",{type:"button",onClick:()=>{D(!1),openProposeModal(k)},className:"ml-3 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",children:[(0,a.jsx)(o.qyc,{className:"mr-2 h-4 w-4"}),"Propose Times"]}),"slot_selected"===k.status&&(0,a.jsxs)("button",{type:"button",onClick:()=>{updateViewingStatus(k.id,"confirmed"),D(!1)},className:"ml-3 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm",children:[(0,a.jsx)(o.l_A,{className:"mr-2 h-4 w-4"}),"Confirm Viewing"]}),"confirmed"===k.status&&(0,a.jsxs)("button",{type:"button",onClick:()=>{updateViewingStatus(k.id,"completed"),D(!1)},className:"ml-3 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",children:[(0,a.jsx)(o.iCz,{className:"mr-2 h-4 w-4"}),"Mark Completed"]}),["requested","options_sent","slot_selected","confirmed"].includes(k.status)&&(0,a.jsxs)("button",{type:"button",onClick:()=>{updateViewingStatus(k.id,"cancelled"),D(!1)},className:"ml-3 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",children:[(0,a.jsx)(o.aHS,{className:"mr-2 h-4 w-4"}),"Cancel Viewing"]})]})]})]})}),k&&(0,a.jsx)(ProposeViewingSlotsModal,{isOpen:T,onClose:()=>P(!1),viewingId:k.id,propertyTitle:(null===(u=k.property)||void 0===u?void 0:u.title)||"Property"})]})}}},function(e){e.O(0,[2420,2438,8920,8611,7592,1907,2971,2472,1744],function(){return e(e.s=4478)}),_N_E=e.O()}]);