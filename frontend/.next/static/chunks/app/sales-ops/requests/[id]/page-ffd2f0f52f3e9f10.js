(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{3550:function(e,s,t){Promise.resolve().then(t.bind(t,4273))},4273:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return RequestDetail}});var a=t(7437),r=t(2265),i=t(4033),l=t(1396),n=t.n(l),m=t(5243),c=t(2080),d=t(3159);function RequestDetails(e){let{request:s}=e,formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(e);return(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,a.jsx)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s.title||"Property Request #".concat(s.id)}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Property requirements and specifications"})]})}),(0,a.jsx)("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:(0,a.jsxs)("dl",{className:"sm:divide-y sm:divide-gray-200",children:[(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.m17,{className:"mr-2 h-4 w-4 text-gray-400"}),"Property Type"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.property_type})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.Nh4,{className:"mr-2 h-4 w-4 text-gray-400"}),"Location"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.location})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.l80,{className:"mr-2 h-4 w-4 text-gray-400"}),"Price Range"]}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:[formatCurrency(s.min_price)," - ",formatCurrency(s.max_price)]})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.f0S,{className:"mr-2 h-4 w-4 text-gray-400"}),"Bedrooms"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.bedrooms})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.MvV,{className:"mr-2 h-4 w-4 text-gray-400"}),"Bathrooms"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.bathrooms})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.BxQ,{className:"mr-2 h-4 w-4 text-gray-400"}),"Area Size"]}),(0,a.jsxs)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:[s.area_size," m\xb2"]})]}),s.additional_features&&(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Additional Features"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.additional_features})]}),s.custom_fields&&Object.keys(s.custom_fields).length>0&&(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Custom Fields"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:(0,a.jsx)("ul",{className:"border border-gray-200 rounded-md divide-y divide-gray-200",children:Object.entries(s.custom_fields).map(e=>{let[s,t]=e;return(0,a.jsxs)("li",{className:"pl-3 pr-4 py-3 flex items-center justify-between text-sm",children:[(0,a.jsx)("div",{className:"w-0 flex-1 flex items-center",children:(0,a.jsxs)("span",{className:"ml-2 flex-1 w-0 truncate font-medium",children:[s,":"]})}),(0,a.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,a.jsx)("span",{className:"font-normal",children:(null==t?void 0:t.toString())||"N/A"})})]},s)})})})]})]})})]})}function MatchedProperties(e){let{matchedProperties:s,requestId:t}=e,formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",minimumFractionDigits:0}).format(e);return(0,a.jsxs)("div",{className:"bg-white shadow sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Matched Properties"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Properties that match the customer's requirements"})]}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:s.length})," matches found"]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200",children:s.length>0?(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("li",{className:"px-4 py-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-16 w-16 bg-gray-100 rounded-md overflow-hidden",children:e.image_urls&&e.image_urls.length>0?(0,a.jsx)("img",{src:e.image_urls[0],alt:e.title,className:"h-full w-full object-cover"}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,a.jsx)(d.m17,{className:"h-8 w-8 text-gray-400"})})}),(0,a.jsxs)("div",{className:"ml-4 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900",children:e.title}),(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,a.jsx)(d.qvk,{className:"mr-1 h-3 w-3"}),e.matchPercentage,"% Match"]})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[(0,a.jsx)(d.Nh4,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{children:e.location})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center text-sm text-gray-500",children:[(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[(0,a.jsx)(d.f0S,{className:"mr-1 h-4 w-4 text-gray-400"}),e.bedrooms]}),(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[(0,a.jsx)(d.MvV,{className:"mr-1 h-4 w-4 text-gray-400"}),e.bathrooms]}),(0,a.jsxs)("span",{className:"mr-2 inline-flex items-center",children:[(0,a.jsx)(d.BxQ,{className:"mr-1 h-4 w-4 text-gray-400"}),e.area_size," m\xb2"]}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:formatCurrency(e.price)})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end space-x-3",children:[(0,a.jsxs)(n(),{href:"/properties/".concat(e.id),className:"inline-flex items-center px-2.5 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(d.CkN,{className:"mr-1 h-3 w-3"}),"View Property"]}),(0,a.jsxs)(n(),{href:"/sales-ops/schedule-viewing?property=".concat(e.id,"&request=").concat(t),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(d.IiJ,{className:"mr-1 h-3 w-3"}),"Schedule Viewing"]})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)(d.m17,{className:"mx-auto h-12 w-12 text-gray-300"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No matching properties"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"There are no properties that match this customer's requirements."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(n(),{href:"/sales-ops/properties/new",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Add New Property"})})]})})]})}function RequestStatusHistory(e){let{statusHistory:s,formatDate:t}=e;return 0===s.length?(0,a.jsx)("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Status History"}),(0,a.jsx)("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:(0,a.jsx)("p",{children:"No status updates have been recorded yet."})})]})}):(0,a.jsx)("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Status History"}),(0,a.jsx)("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:(0,a.jsx)("p",{children:"History of status changes for this property request."})}),(0,a.jsx)("div",{className:"mt-4 flow-root",children:(0,a.jsx)("ul",{className:"-mb-8",children:s.map((e,r)=>(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"relative pb-8",children:[r!==s.length-1?(0,a.jsx)("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}):null,(0,a.jsxs)("div",{className:"relative flex space-x-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)("span",{className:"h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white\n                          ".concat("pending"===e.new_status?"bg-yellow-100":"active"===e.new_status?"bg-green-100":"bg-gray-100"),children:(0,a.jsx)("svg",{className:"h-5 w-5 \n                            ".concat("pending"===e.new_status?"text-yellow-600":"active"===e.new_status?"text-green-600":"text-gray-600"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1 pt-1.5 flex justify-between space-x-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Status changed to"," ",(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.new_status.charAt(0).toUpperCase()+e.new_status.slice(1)}),e.old_status&&(0,a.jsxs)(a.Fragment,{children:[" ","from"," ",(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.old_status.charAt(0).toUpperCase()+e.old_status.slice(1)})]})]}),e.notes&&(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:[e.is_private&&(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 mr-2",children:"Private"}),e.notes]})]}),(0,a.jsx)("div",{className:"text-right text-sm whitespace-nowrap text-gray-500",children:(0,a.jsx)("time",{dateTime:e.created_at,children:t(e.created_at)})})]})]})]})},e.id))})})]})})}function StatusUpdateForm(e){let{request:s,newStatus:t,setNewStatus:r,statusNote:i,setStatusNote:l,isPrivateNote:n,setIsPrivateNote:m,handleStatusUpdate:c,isUpdatingStatus:o,updateError:x}=e;return(0,a.jsx)("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Update Request Status"}),(0,a.jsx)("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:(0,a.jsx)("p",{children:"Change the status of this property request and add notes for the customer or your team."})}),(0,a.jsxs)("form",{onSubmit:c,className:"mt-5",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,a.jsxs)("select",{id:"status",value:t,onChange:e=>r(e.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:[(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"closed",children:"Closed"})]})]}),(0,a.jsxs)("div",{className:"sm:col-span-6",children:[(0,a.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700",children:"Status Notes"}),(0,a.jsx)("textarea",{id:"notes",rows:3,value:i,onChange:e=>l(e.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Add notes about this status change..."})]}),(0,a.jsx)("div",{className:"sm:col-span-6",children:(0,a.jsxs)("div",{className:"relative flex items-start",children:[(0,a.jsx)("div",{className:"flex items-center h-5",children:(0,a.jsx)("input",{id:"private-note",name:"private-note",type:"checkbox",checked:n,onChange:e=>m(e.target.checked),className:"focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded"})}),(0,a.jsxs)("div",{className:"ml-3 text-sm",children:[(0,a.jsx)("label",{htmlFor:"private-note",className:"font-medium text-gray-700",children:"Private Note"}),(0,a.jsx)("p",{className:"text-gray-500",children:"This note will only be visible to the sales team, not the customer."})]})]})})]}),x&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border-l-4 border-red-400 p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(d.G5m,{className:"h-5 w-5 text-red-400"})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:x})})]})}),(0,a.jsx)("div",{className:"mt-5",children:(0,a.jsx)("button",{type:"submit",disabled:o,className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Updating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.TvB,{className:"-ml-1 mr-2 h-4 w-4"}),"Update Status"]})})})]})]})})}function CustomerInfo(e){let{user:s}=e;return s?(0,a.jsxs)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Customer Information"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Contact and personal details"})]}),(0,a.jsx)("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:(0,a.jsxs)("dl",{className:"sm:divide-y sm:divide-gray-200",children:[(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.Xws,{className:"mr-2 h-4 w-4 text-gray-400"}),"Full name"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.name})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.SRX,{className:"mr-2 h-4 w-4 text-gray-400"}),"Email address"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:(0,a.jsx)("a",{href:"mailto:".concat(s.email),className:"text-primary hover:text-primary-dark",children:s.email})})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsxs)("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[(0,a.jsx)(d.I7T,{className:"mr-2 h-4 w-4 text-gray-400"}),"Phone number"]}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:(0,a.jsx)("a",{href:"tel:".concat(s.phone),className:"text-primary hover:text-primary-dark",children:s.phone})})]}),(0,a.jsxs)("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Role"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s.role.charAt(0).toUpperCase()+s.role.slice(1)})]})]})})]}):(0,a.jsx)("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Customer Information"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Loading customer details..."})]})})}function ScheduledViewings(e){let{viewings:s,loadingViewings:t,formatDate:r,requestId:i,userId:l}=e;return t?(0,a.jsx)("div",{className:"bg-white shadow sm:rounded-lg",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Scheduled Viewings"}),(0,a.jsx)("div",{className:"mt-4 flex justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})})]})}):(0,a.jsxs)("div",{className:"bg-white shadow sm:rounded-lg",children:[(0,a.jsxs)("div",{className:"px-4 py-5 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Scheduled Viewings"}),(0,a.jsx)("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"Property viewings for this customer"})]}),(0,a.jsxs)(n(),{href:"/sales-ops/schedule-viewing?request=".concat(i,"&user=").concat(l),className:"inline-flex items-center px-2.5 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(d.IiJ,{className:"mr-1 h-3 w-3"}),"Schedule Viewing"]})]}),(0,a.jsx)("div",{className:"border-t border-gray-200",children:s.length>0?(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:s.map(e=>{var s,t;return(0,a.jsx)("li",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.m17,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("span",{className:"ml-1 text-sm font-medium text-gray-900",children:(null===(s=e.property)||void 0===s?void 0:s.title)||"Unknown Property"}),(0,a.jsxs)("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                          ".concat("confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"completed"===e.status?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:["confirmed"===e.status&&(0,a.jsx)(d.FJM,{className:"mr-1 h-3 w-3"}),"cancelled"===e.status&&(0,a.jsx)(d.G5m,{className:"mr-1 h-3 w-3"}),"pending"===e.status&&(0,a.jsx)(d.a4m,{className:"mr-1 h-3 w-3"}),e.status.charAt(0).toUpperCase()+e.status.slice(1)]})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,a.jsx)(d.Nh4,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),(0,a.jsx)("p",{children:(null===(t=e.property)||void 0===t?void 0:t.location)||"Unknown Location"})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.IiJ,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),(0,a.jsx)("p",{children:e.viewing_date?r(e.viewing_date):"Date TBD"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.qyc,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),(0,a.jsx)("p",{children:e.viewing_time||"Time TBD"})]})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-500",children:[(0,a.jsx)("p",{className:"font-medium",children:"Notes:"}),(0,a.jsx)("p",{children:e.notes})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)(n(),{href:"/sales-ops/viewings/".concat(e.id),className:"text-sm text-primary hover:text-primary-dark",children:"View details â†’"})})]})},e.id)})}):(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)(d.IiJ,{className:"mx-auto h-12 w-12 text-gray-300"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No viewings scheduled"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"This customer hasn't scheduled any property viewings yet."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)(n(),{href:"/sales-ops/schedule-viewing?request=".concat(i,"&user=").concat(l),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(d.IiJ,{className:"mr-2 -ml-1 h-5 w-5"}),"Schedule Viewing"]})})]})})]})}function RequestDetail(e){let{params:s}=e,{id:t}=s,{user:l,session:o}=(0,m.a)(),x=(0,i.useRouter)(),[h,u]=(0,r.useState)(null),[p,g]=(0,r.useState)([]),[y,f]=(0,r.useState)([]),[j,N]=(0,r.useState)(!0),[w,v]=(0,r.useState)(null),[b,k]=(0,r.useState)(!1),[S,_]=(0,r.useState)(""),[q,C]=(0,r.useState)(""),[P,T]=(0,r.useState)(!1),[D,E]=(0,r.useState)(""),[R,U]=(0,r.useState)([]),[A,F]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let fetchRequestData=async()=>{if(!(null==o?void 0:o.access_token)){console.log("No access token available, please log in");return}N(!0);try{let e=await (0,c.Hf)(o.access_token,t);u(e.request),_(e.request.status);let s=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/property-requests/").concat(t,"/status-history"),{method:"GET",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"}});if(s.ok){let e=await s.json();f(e.statusHistory||[])}else console.error("Error fetching status history:",await s.json()),f([]);let a=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/property-requests/").concat(t,"/matched-properties"),{method:"GET",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();g(e.properties||[])}else console.error("Error fetching matched properties:",await a.json()),g([]);let r=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/users/").concat(e.request.user_id),{method:"GET",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"}});if(r.ok){let e=await r.json();v(e.user||null)}else console.error("Error fetching user data:",await r.json()),v(null);let i=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/scheduled-viewings?userId=").concat(e.request.user_id),{method:"GET",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"}});if(i.ok){let e=await i.json();U(e.viewings||[])}else console.error("Error fetching scheduled viewings:",await i.json()),U([]);F(!1)}catch(e){console.error("Error fetching request data:",e),x.push("/sales-ops/requests")}finally{N(!1)}};fetchRequestData()},[t,x,o]);let handleStatusUpdate=async e=>{e.preventDefault(),k(!0),E("");try{let e=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/property-requests/").concat(t,"/status-update"),{method:"POST",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"},body:JSON.stringify({status:S,notes:q,isPrivate:P})});if(!e.ok){var s;let t=await e.json();throw Error((null===(s=t.error)||void 0===s?void 0:s.message)||"Failed to update status")}await e.json(),u({...h,status:S});let a=await fetch("".concat("bigdealegypt.up.railway.app/api","/sales-ops/property-requests/").concat(t,"/status-history"),{method:"GET",headers:{Authorization:"Bearer ".concat(o.access_token),"Content-Type":"application/json"}});if(a.ok){let e=await a.json();f(e.statusHistory||[])}C(""),T(!1),k(!1)}catch(e){console.error("Error updating status:",e),E("Failed to update status: "+e.message),k(!1)}},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return j?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):h?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)(n(),{href:"/sales-ops/requests",className:"inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[(0,a.jsx)(d.x_l,{className:"mr-2 h-4 w-4"}),"Back to Requests"]}),(0,a.jsx)("h1",{className:"mt-2 text-2xl font-bold text-gray-900",children:"Request Details"}),(0,a.jsxs)("div",{className:"mt-1 flex flex-col sm:flex-row sm:flex-wrap sm:mt-0 sm:space-x-6",children:[(0,a.jsx)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium \n                ".concat("pending"===h.status?"bg-yellow-100 text-yellow-800":"active"===h.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:h.status.charAt(0).toUpperCase()+h.status.slice(1)})}),(0,a.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:["Created on ",formatDate(h.created_at)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsx)(RequestDetails,{request:h}),(0,a.jsx)(StatusUpdateForm,{request:h,newStatus:S,setNewStatus:_,statusNote:q,setStatusNote:C,isPrivateNote:P,setIsPrivateNote:T,handleStatusUpdate:handleStatusUpdate,isUpdatingStatus:b,updateError:D}),(0,a.jsx)(RequestStatusHistory,{statusHistory:y,formatDate:formatDate}),(0,a.jsx)(MatchedProperties,{matchedProperties:p,requestId:t})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(CustomerInfo,{user:w}),(0,a.jsx)(ScheduledViewings,{viewings:R,loadingViewings:A,formatDate:formatDate,requestId:t,userId:null==w?void 0:w.id})]})]})]}):(0,a.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,a.jsx)(d.G5m,{className:"h-6 w-6 text-red-600"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Request not found"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"The property request you're looking for doesn't exist or you don't have access to it."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsxs)(n(),{href:"/sales-ops/requests",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,a.jsx)(d.x_l,{className:"mr-2 -ml-1 h-5 w-5"}),"Back to Requests"]})})]})}},4033:function(e,s,t){e.exports=t(94)}},function(e){e.O(0,[2420,2438,1207,2971,2472,1744],function(){return e(e.s=3550)}),_N_E=e.O()}]);