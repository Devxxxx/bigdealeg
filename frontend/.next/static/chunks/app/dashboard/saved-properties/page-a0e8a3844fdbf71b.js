(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7704],{7813:function(e,r,t){Promise.resolve().then(t.bind(t,5655))},5655:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return SavedProperties}});var s=t(7437),a=t(2265),o=t(4033),i=t(7140),n=t(5243),l=t(3159);function SavedProperties(){let{user:e}=(0,n.a)(),{savedProperties:r,loading:t,fetchSavedProperties:c,toggleSaved:d,unsaveProperty:u}=(0,i.c)();(0,o.useRouter)();let[p,h]=(0,a.useState)(""),[m,v]=(0,a.useState)("all"),[g,f]=(0,a.useState)("date_saved"),[y,x]=(0,a.useState)([]),[w,j]=(0,a.useState)([]);(0,a.useEffect)(()=>{c()},[c]),(0,a.useEffect)(()=>{if(r&&r.length>0){let e=r.filter(e=>e.is_favorite).map(e=>e.property_id);x(e);let t=r.map(r=>{let t=r.properties;return{id:t.id,title:t.title,description:t.description,price:t.price,location:t.location,bedrooms:t.bedrooms,bathrooms:t.bathrooms,area_size:t.area_size,property_type:t.property_type,featured_image:t.featured_image,date_saved:r.created_at,is_favorite:e.includes(t.id)}});j(t)}else j([])},[r]);let toggleFavorite=async e=>{y.includes(e)?x(y.filter(r=>r!==e)):x([...y,e]),j(w.map(r=>r.id===e?{...r,is_favorite:!r.is_favorite}:r))},removeSavedProperty=async e=>{if(confirm("Are you sure you want to remove this property from your saved list?"))try{await u(e)}catch(e){console.error("Error removing saved property:",e)}},b=w.filter(e=>{let r=""===p||e.title.toLowerCase().includes(p.toLowerCase())||e.location.toLowerCase().includes(p.toLowerCase())||e.property_type.toLowerCase().includes(p.toLowerCase()),t="all"===m||e.property_type===m;return r&&t}),formatCurrency=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",maximumFractionDigits:0}).format(e);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[(0,s.jsx)(l.$0H,{className:"mr-3 text-primary"}),"Saved Properties"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"View and manage your saved properties"})]})}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4",children:[(0,s.jsxs)("div",{className:"relative flex-grow",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(l.U41,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsx)("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",placeholder:"Search saved properties...",value:p,onChange:e=>h(e.target.value)})]}),(0,s.jsxs)("div",{className:"relative w-full md:w-48",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(l.ulB,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsxs)("select",{className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",value:m,onChange:e=>v(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Types"}),(0,s.jsx)("option",{value:"apartment",children:"Apartments"}),(0,s.jsx)("option",{value:"villa",children:"Villas"}),(0,s.jsx)("option",{value:"townhouse",children:"Townhouses"}),(0,s.jsx)("option",{value:"office",children:"Offices"}),(0,s.jsx)("option",{value:"commercial",children:"Commercial"})]})]}),(0,s.jsxs)("div",{className:"relative w-full md:w-48",children:[(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(l.r_,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsxs)("select",{className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary focus:border-primary sm:text-sm",value:g,onChange:e=>f(e.target.value),children:[(0,s.jsx)("option",{value:"date_saved",children:"Date Saved"}),(0,s.jsx)("option",{value:"price_asc",children:"Price (Low to High)"}),(0,s.jsx)("option",{value:"price_desc",children:"Price (High to Low)"}),(0,s.jsx)("option",{value:"area_desc",children:"Area (Largest First)"})]})]})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm divide-y divide-gray-200",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsxs)("h2",{className:"text-lg font-medium text-gray-900",children:["Your Saved Properties",(0,s.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full",children:b.length})]})}),t?(0,s.jsxs)("div",{className:"flex justify-center items-center p-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"}),(0,s.jsx)("span",{className:"ml-3 text-sm text-gray-500",children:"Loading properties..."})]}):0===b.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[(0,s.jsx)(l.m17,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No saved properties"}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:p||"all"!==m?"Try adjusting your search or filter":"Browse properties and save them to view them here"}),(0,s.jsxs)("a",{href:"/properties",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,s.jsx)(l.U41,{className:"mr-2 h-4 w-4"}),"Browse Properties"]})]}):(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:b.map(e=>(0,s.jsxs)("div",{className:"group bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all",children:[(0,s.jsxs)("div",{className:"aspect-w-16 aspect-h-9 bg-gray-200 relative",children:[(0,s.jsx)("img",{src:e.featured_image||"https://via.placeholder.com/800x450?text=No+Image",alt:e.title,className:"w-full h-full object-cover"}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>toggleFavorite(e.id),className:"p-2 bg-white rounded-full shadow-md hover:bg-gray-100 focus:outline-none",title:y.includes(e.id)?"Remove from favorites":"Add to favorites",children:y.includes(e.id)?(0,s.jsx)(l.QJe,{className:"h-4 w-4 text-yellow-500"}):(0,s.jsx)(l.jJN,{className:"h-4 w-4 text-gray-500"})}),(0,s.jsx)("button",{onClick:()=>removeSavedProperty(e.id),className:"p-2 bg-white rounded-full shadow-md hover:bg-gray-100 focus:outline-none",title:"Remove from saved",children:(0,s.jsx)(l.Xm5,{className:"h-4 w-4 text-red-500"})})]}),(0,s.jsx)("div",{className:"absolute bottom-2 left-2",children:(0,s.jsx)("span",{className:"inline-block bg-gray-800 bg-opacity-75 text-white px-2 py-1 text-xs rounded-md",children:e.property_type})})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 group-hover:text-primary",children:e.title}),(0,s.jsx)("p",{className:"text-lg font-bold text-primary",children:formatCurrency(e.price)})]}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[(0,s.jsx)(l.Nh4,{className:"mr-1 text-gray-400"}),e.location]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-between text-sm text-gray-500",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.f0S,{className:"mr-1"}),(0,s.jsxs)("span",{children:[e.bedrooms," beds"]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.MvV,{className:"mr-1"}),(0,s.jsxs)("span",{children:[e.bathrooms," baths"]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.BxQ,{className:"mr-1"}),(0,s.jsxs)("span",{children:[e.area_size," m\xb2"]})]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3 sm:px-6 flex justify-between",children:[(0,s.jsxs)("a",{href:"/properties/".concat(e.id),className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,s.jsx)(l.dSq,{className:"mr-2 h-4 w-4"}),"View Details"]}),(0,s.jsxs)("button",{className:"inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:[(0,s.jsx)(l.Lrt,{className:"mr-2 h-4 w-4"}),"Share"]})]})]},e.id))})]})})]})}},5243:function(e,r,t){"use strict";t.d(r,{a:function(){return useAuth}});var s=t(4523);function useAuth(){var e;let r=(0,s.useAuth)(),t=(null===(e=r.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,t)=>{try{return await r.signIn(e,t),{error:null}}catch(e){return{error:e}}},signUp=async(e,t,s)=>{try{return await r.signUp(e,t,s),{error:null}}catch(e){return{error:e}}};return{...r,role:t,signIn,signUp}}},7140:function(e,r,t){"use strict";t.d(r,{c:function(){return useSavedProperties}});var s=t(2265),a=t(5243),o=t(8324),i=t(5925);function useSavedProperties(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,[r,t]=(0,s.useState)([]),[n,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),{user:h,session:m}=(0,a.a)(),v=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!h||!(null==m?void 0:m.access_token)){t([]),d(!1);return}d(!0),p(null);try{let r=await o.ZP.getSavedProperties(m.access_token,e);t(r.data)}catch(e){console.error("Error fetching saved properties:",e),p(e.message||"Failed to load saved properties"),i.toast.error("Failed to load saved properties")}finally{d(!1)}},[h,m]),g=(0,s.useCallback)(async()=>{if(!e||!h||!(null==m?void 0:m.access_token)){l(!1);return}try{let r=await o.ZP.isPropertySaved(m.access_token,e);l(r)}catch(e){console.error("Error checking if property is saved:",e),l(!1)}},[e,h,m]),f=(0,s.useCallback)(async t=>{if(!h||!(null==m?void 0:m.access_token))return i.toast.error("You must be logged in to save properties"),!1;let s=t||e;if(!s)return i.toast.error("Property ID is required"),!1;try{return await o.ZP.saveProperty(m.access_token,s),e&&e===s&&l(!0),r.length>0&&v(),i.toast.success("Property saved successfully"),!0}catch(r){if(console.error("Error saving property:",r),r.message&&r.message.includes("already saved"))return e&&e===s&&l(!0),!0;return i.toast.error(r.message||"Failed to save property"),!1}},[h,m,e,r.length,v]),y=(0,s.useCallback)(async r=>{if(!h||!(null==m?void 0:m.access_token))return i.toast.error("You must be logged in to unsave properties"),!1;let s=r||e;if(!s)return i.toast.error("Property ID is required"),!1;try{return await o.ZP.unsaveProperty(m.access_token,s),e&&e===s&&l(!1),t(e=>e.filter(e=>e.property_id!==s)),i.toast.success("Property removed from saved list"),!0}catch(r){if(console.error("Error unsaving property:",r),r.message&&r.message.includes("not saved"))return e&&e===s&&l(!1),!0;return i.toast.error(r.message||"Failed to remove property from saved list"),!1}},[h,m,e]),x=(0,s.useCallback)(async r=>{let t=r||e;if(!t)return!1;if(e===t)return n?y(t):f(t);try{let e=await o.ZP.isPropertySaved(null==m?void 0:m.access_token,t);return e?y(t):f(t)}catch(e){return console.error("Error toggling saved status:",e),!1}},[n,e,f,null==m?void 0:m.access_token,y]),w=(0,s.useCallback)(async()=>{if(!h||!(null==m?void 0:m.access_token))return i.toast.error("You must be logged in to clear saved properties"),!1;try{return await o.ZP.deleteAllSavedProperties(m.access_token),t([]),e&&l(!1),i.toast.success("All saved properties cleared"),!0}catch(e){return console.error("Error clearing saved properties:",e),i.toast.error(e.message||"Failed to clear saved properties"),!1}},[h,m,e]);return(0,s.useEffect)(()=>{e&&g()},[e,g]),{savedProperties:r,isSaved:n,loading:c,error:u,fetchSavedProperties:v,saveProperty:f,unsaveProperty:y,toggleSaved:x,clearAllSavedProperties:w}}},8324:function(e,r,t){"use strict";let s="bigdealegypt.up.railway.app/api",getSavedProperties=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a="".concat(s,"/saved-properties"),o=new URLSearchParams;r.page&&o.append("page",r.page),r.limit&&o.append("limit",r.limit),o.append("_t",Date.now()),a+="?".concat(o.toString());let i=await fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"},credentials:"include"});if(!i.ok){var t;let e=await i.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch saved properties")}return await i.json()}catch(e){throw console.error("Get saved properties error:",e),e}},isPropertySaved=async(e,r)=>{try{let a=await fetch("".concat(s,"/saved-properties/check/").concat(r),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to check if property is saved")}let o=await a.json();return o.isSaved}catch(e){return console.error("Check if property is saved error:",e),!1}},saveProperty=async(e,r)=>{try{let a=await fetch("".concat(s,"/saved-properties/").concat(r),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},credentials:"include"});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to save property")}return await a.json()}catch(e){throw console.error("Save property error:",e),e}},unsaveProperty=async(e,r)=>{try{let a=await fetch("".concat(s,"/saved-properties/").concat(r),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to unsave property")}return await a.json()}catch(e){throw console.error("Unsave property error:",e),e}},deleteAllSavedProperties=async e=>{try{let t=await fetch("".concat(s,"/saved-properties"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to delete all saved properties")}return await t.json()}catch(e){throw console.error("Delete all saved properties error:",e),e}};r.ZP={getSavedProperties,isPropertySaved,saveProperty,unsaveProperty,deleteAllSavedProperties}},4523:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return AuthProvider},default:function(){return c},useAuth:function(){return useAuth}});var s=t(7437),a=t(2265);let o="bigdealegypt.up.railway.app/api",signIn=async(e,r)=>{try{let s=await fetch("".concat(o,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r}),credentials:"include"});if(!s.ok){var t;let e=await s.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Authentication failed")}return await s.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,r,t)=>{try{let a=await fetch("".concat(o,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r,name:t})});if(!a.ok){var s;let e=await a.json();throw Error((null===(s=e.error)||void 0===s?void 0:s.message)||"Registration failed")}return await a.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let r=await fetch("".concat(o,"/auth/signout"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await r.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let t=await fetch("".concat(o,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to retrieve session")}return await t.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let r=await fetch("".concat(o,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await r.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,r)=>{try{let s=await fetch("".concat(o,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(r)}});if(!s.ok){var t;let e=await s.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to get user profile")}return await s.json()}catch(e){throw console.error("Get user profile error:",e),e}};var i={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},n=t(4033);let l=(0,a.createContext)(void 0),AuthProvider=e=>{let{children:r}=e,[t,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,p]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),v=(0,n.useRouter)();(0,a.useEffect)(()=>{if(c){let e=new Date(c.expires_at).getTime(),r=Date.now(),t=e-r;if(t<3e5){refreshSession();return}let s=setTimeout(()=>{refreshSession()},t-3e5);return()=>clearTimeout(s)}},[c]),(0,a.useEffect)(()=>{let initAuth=async()=>{p(!0),m(null);try{let e=localStorage.getItem("access_token");if(!e){p(!1);return}let r=await i.getSession(e);(null==r?void 0:r.user)&&(null==r?void 0:r.session)?(o(r.user),d(r.session),localStorage.setItem("access_token",r.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),m("Authentication error. Please login again.")}finally{p(!1)}};initAuth()},[]);let signIn=async(e,r)=>{p(!0),m(null);try{let t=await i.signIn(e,r);(null==t?void 0:t.user)&&(null==t?void 0:t.session)&&(o(t.user),d(t.session),localStorage.setItem("access_token",t.session.access_token),v.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),m(e instanceof Error?e.message:"Authentication failed"),e}finally{p(!1)}},signUp=async(e,r,t)=>{p(!0),m(null);try{let s=await i.signUp(e,r,t);(null==s?void 0:s.user)&&v.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),m(e instanceof Error?e.message:"Registration failed"),e}finally{p(!1)}},signOut=async()=>{p(!0);try{await i.signOut(),o(null),d(null),localStorage.removeItem("access_token"),v.push("/")}catch(e){console.error("Sign out error:",e),o(null),d(null),localStorage.removeItem("access_token"),v.push("/")}finally{p(!1)}},refreshSession=async()=>{if(!u)try{let e=await i.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(o(e.user),d(e.session),localStorage.setItem("access_token",e.session.access_token)):(o(null),d(null),localStorage.removeItem("access_token"),v.push("/login"))}catch(e){console.error("Session refresh error:",e),o(null),d(null),localStorage.removeItem("access_token"),v.push("/login")}};return(0,s.jsx)(l.Provider,{value:{user:t,session:c,loading:u,error:h,isAuthenticated:!!t,signIn,signUp,signOut,refreshSession},children:r})},useAuth=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var c=l}},function(e){e.O(0,[2420,9202,2971,2472,1744],function(){return e(e.s=7813)}),_N_E=e.O()}]);