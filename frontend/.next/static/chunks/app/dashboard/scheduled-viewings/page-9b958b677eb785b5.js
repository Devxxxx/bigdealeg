(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[981],{1262:function(e,t,s){Promise.resolve().then(s.bind(s,8147))},8147:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ScheduledViewings}});var a=s(7437),l=s(2265),i=s(1396),r=s.n(i),n=s(5243),c=s(2749);function useScheduledViewings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{filter:t="all",additionalFilters:s={}}=e,[a,i]=(0,l.useState)([]),[r,d]=(0,l.useState)(!0),[o,m]=(0,l.useState)(null),[x,u]=(0,l.useState)(!1),{user:h,session:p}=(0,n.a)(),g=JSON.stringify(s),f=(0,l.useCallback)(async()=>{if(!h||!(null==p?void 0:p.access_token)){d(!1);return}d(!0),m(null);try{let e={...JSON.parse(g),role:null==h?void 0:h.role},{viewings:t}=await c.ZP.getScheduledViewings(p.access_token,e);console.log("Scheduled viewings data received:",t),i(t||[]),u(!0),t?console.log("Received ".concat(t.length," viewings from API")):console.log("No viewings data received or data is empty")}catch(e){console.error("Error fetching scheduled viewings:",e),m("Failed to load scheduled viewings")}finally{d(!1)}},[null==h?void 0:h.id,null==p?void 0:p.access_token,g]);(0,l.useEffect)(()=>{f()},[f]);let y=a.filter(e=>{if("all"===t||"pending"===e.status&&"upcoming"===t)return!0;if(!e.viewing_date)return"upcoming"===t;let s=new Date(e.viewing_date),a=new Date;return(a.setHours(0,0,0,0),"upcoming"===t)?s>=a:"past"!==t||s<a}),v=y.reduce((e,t)=>{if("pending"===t.status&&!t.viewing_date){let s="Pending Confirmation";return e[s]||(e[s]=[]),e[s].push(t),e}let s=formatDateForGrouping(t.viewing_date);return e[s]||(e[s]=[]),e[s].push(t),e},{}),cancelViewing=async(e,t)=>{if(!(null==p?void 0:p.access_token))throw Error("You must be logged in to cancel a viewing");try{let s=await c.ZP.cancelScheduledViewing(p.access_token,e,{cancellation_reason:t});return i(t=>t.map(t=>t.id===e?{...t,status:"cancelled"}:t)),s}catch(e){throw console.error("Error cancelling viewing:",e),e}},createViewing=async e=>{if(!(null==p?void 0:p.access_token))throw Error("You must be logged in to schedule a viewing");try{let t=await c.ZP.createScheduledViewing(p.access_token,e);return i(e=>[t,...e]),t}catch(e){throw console.error("Error creating viewing:",e),e}};function formatDateForGrouping(e){if(!e)return"Pending Confirmation";let t=new Date(e),s=new Date,a=new Date(s);return(a.setDate(a.getDate()+1),s.setHours(0,0,0,0),a.setHours(0,0,0,0),t.setHours(0,0,0,0),t.getTime()===s.getTime())?"Today":t.getTime()===a.getTime()?"Tomorrow":t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}return{viewings:y,groupedViewings:v,loading:r,error:o,hasData:a.length>0,hasInitiallyLoaded:x,refreshViewings:f,cancelViewing,createViewing}}var d=s(8920),o=s(2595),m=s(4734),x=s(1393),u=s(8611);function SelectViewingSlotModal(e){let{isOpen:t,onClose:s,viewingId:i,propertyTitle:r,proposedDates:o,proposedTimes:h}=e,{user:p,session:g}=(0,n.a)(),[f,y]=(0,l.useState)(!1),[v,j]=(0,l.useState)(!1),[b,N]=(0,l.useState)(null),[w,C]=(0,l.useState)(""),[S,k]=(0,l.useState)(""),[_,P]=(0,l.useState)(""),A=o.map(e=>({value:e,label:new Date(e).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})})),D=h.map(e=>{let[t,s]=e.split(":"),a=parseInt(t,10),l="".concat(a%12||12,":").concat(s," ").concat(a>=12?"PM":"AM");return{value:e,label:l}}),resetForm=()=>{C(""),k(""),P(""),j(!1),N(null)},validateForm=()=>w?!!S||(N("Please select a time"),!1):(N("Please select a date"),!1),handleSubmit=async()=>{if(!(null==g?void 0:g.access_token)){N("Authentication error. Please try logging in again.");return}if(validateForm())try{y(!0),N(null),await c.ZP.selectViewingSlot(g.access_token,i,{selected_date:w,selected_time:S,notes:_}),j(!0)}catch(e){console.error("Error selecting viewing slot:",e),N("Failed to select viewing slot. Please try again.")}finally{y(!1)}};return(0,a.jsx)(x.M,{children:t&&(0,a.jsx)(u.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:s}),(0,a.jsxs)(u.E.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,a.jsxs)("div",{className:"bg-primary-50 px-4 py-3 sm:px-6 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-primary-900",children:"Select Viewing Time"}),(0,a.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500",onClick:()=>{s(),setTimeout(resetForm,300)},children:(0,a.jsx)(d.q5L,{className:"h-6 w-6"})})]}),(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:v?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,a.jsx)(d.UgA,{className:"h-6 w-6 text-green-600"})}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Viewing Time Selected"}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["You have successfully selected a viewing time for ",r,". Our sales team will confirm your appointment shortly."]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:["Select your preferred viewing time for ",r]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Please choose from the available slots below. Our sales team will confirm your selected time."}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Dates"}),(0,a.jsx)("div",{className:"space-y-2",children:A.map(e=>(0,a.jsxs)("div",{className:"flex items-center p-3 rounded-lg border cursor-pointer transition-colors ".concat(w===e.value?"bg-primary-50 border-primary-200":"bg-white border-gray-200 hover:bg-gray-50"),onClick:()=>C(e.value),children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-5 w-5 rounded-full border flex items-center justify-center ".concat(w===e.value?"bg-primary-600 border-primary-600":"border-gray-300"),children:w===e.value&&(0,a.jsx)(d.UgA,{className:"h-3 w-3 text-white"})}),(0,a.jsxs)("div",{className:"ml-3 flex items-center",children:[(0,a.jsx)(d.vlc,{className:"mr-2 text-gray-400"}),(0,a.jsx)("span",{className:"text-gray-700",children:e.label})]})]},e.value))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Times"}),(0,a.jsx)("div",{className:"space-y-2",children:D.map(e=>(0,a.jsxs)("div",{className:"flex items-center p-3 rounded-lg border cursor-pointer transition-colors ".concat(S===e.value?"bg-primary-50 border-primary-200":"bg-white border-gray-200 hover:bg-gray-50"),onClick:()=>k(e.value),children:[(0,a.jsx)("div",{className:"flex-shrink-0 h-5 w-5 rounded-full border flex items-center justify-center ".concat(S===e.value?"bg-primary-600 border-primary-600":"border-gray-300"),children:S===e.value&&(0,a.jsx)(d.UgA,{className:"h-3 w-3 text-white"})}),(0,a.jsxs)("div",{className:"ml-3 flex items-center",children:[(0,a.jsx)(d.TCC,{className:"mr-2 text-gray-400"}),(0,a.jsx)("span",{className:"text-gray-700",children:e.label})]})]},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),(0,a.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(d.IC0,{className:"text-gray-400"})}),(0,a.jsx)("textarea",{rows:3,className:"block w-full pl-10 sm:text-sm border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",placeholder:"Any additional information or questions...",value:_,onChange:e=>P(e.target.value)})]})]})]}),b&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:b})]})}),(0,a.jsx)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:v?(0,a.jsx)(m.Z,{variant:"primary",onClick:()=>{s(),setTimeout(resetForm,300)},children:"Done"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Z,{variant:"primary",onClick:handleSubmit,loading:f,children:"Confirm Selection"}),(0,a.jsx)(m.Z,{variant:"light",onClick:s,className:"mr-2",children:"Cancel"})]})})]})]})})})}var h=s(907);function ScheduledViewings(){var e;let[t,s]=(0,l.useState)("all"),[i,c]=(0,l.useState)([]),[x,u]=(0,l.useState)(!1),[p,g]=(0,l.useState)(null),[f,y]=(0,l.useState)(!1),[v,j]=(0,l.useState)(null),{isAuthenticated:b,loading:N}=(0,n.a)(),{groupedViewings:w,loading:C,error:S,cancelViewing:k,hasInitiallyLoaded:_}=useScheduledViewings({filter:t}),toggleExpanded=e=>{c(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},openSelectSlotModal=e=>{g(e),u(!0)},openCancelModal=e=>{j(e),y(!0)},formatDate=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),getStatusBadge=e=>{switch(e){case"confirmed":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[(0,a.jsx)(d._rq,{className:"mr-1 h-3 w-3"}),"Confirmed"]});case"cancelled":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[(0,a.jsx)(d.$Rx,{className:"mr-1 h-3 w-3"}),"Cancelled"]});case"requested":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,a.jsx)(d.bcx,{className:"mr-1 h-3 w-3"}),"Requested"]});case"options_sent":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)(d.H33,{className:"mr-1 h-3 w-3"}),"Select Time"]});case"slot_selected":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[(0,a.jsx)(d.TCC,{className:"mr-1 h-3 w-3"}),"Time Selected"]});case"completed":return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,a.jsx)(d._rq,{className:"mr-1 h-3 w-3"}),"Completed"]});default:return(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[(0,a.jsx)(d.H33,{className:"mr-1 h-3 w-3"}),e||"Unknown"]})}},isPastDate=e=>{if(!e)return!1;let t=new Date(e),s=new Date;return s.setHours(0,0,0,0),t<s};return N?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsxs)("div",{className:"relative h-16 w-16 flex items-center justify-center",children:[(0,a.jsx)(d.dAq,{className:"animate-spin text-primary-500 h-10 w-10"}),(0,a.jsx)("p",{className:"mt-16 text-sm text-gray-500",children:"Loading authentication..."})]})}):!b&&_?(0,a.jsx)("div",{className:"opacity-100 transition-opacity duration-500",children:(0,a.jsxs)(o.Z,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"mx-auto h-20 w-20 rounded-full bg-primary-50 flex items-center justify-center mb-4",children:(0,a.jsx)(d.fzv,{className:"h-10 w-10 text-primary-500"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Authentication Required"}),(0,a.jsx)("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:"You need to be logged in to view your scheduled property viewings."}),(0,a.jsx)(m.Z,{variant:"gradient",href:"/login",children:"Log In"})]})}):(0,a.jsxs)("div",{className:"opacity-100 transition-opacity duration-500",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Scheduled Viewings"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your property viewing appointments"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(m.Z,{variant:"all"===t?"primary":"light",size:"sm",onClick:()=>s("all"),disabled:C,children:"All"}),(0,a.jsx)(m.Z,{variant:"upcoming"===t?"primary":"light",size:"sm",onClick:()=>s("upcoming"),disabled:C,children:"Upcoming"}),(0,a.jsx)(m.Z,{variant:"past"===t?"primary":"light",size:"sm",onClick:()=>s("past"),disabled:C,children:"Past"})]})]}),C&&!_?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsxs)("div",{className:"relative h-16 w-16 flex items-center justify-center",children:[(0,a.jsx)(d.dAq,{className:"animate-spin text-primary-500 h-10 w-10"}),(0,a.jsx)("p",{className:"mt-16 text-sm text-gray-500",children:"Loading your scheduled viewings..."})]})}):S?(0,a.jsxs)(o.Z,{className:"py-8 text-center",children:[(0,a.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-red-50 flex items-center justify-center mb-4",children:(0,a.jsx)(d.bcx,{className:"h-8 w-8 text-red-500"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Unable to load viewings"}),(0,a.jsx)("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:S}),(0,a.jsx)(m.Z,{variant:"primary",onClick:()=>window.location.reload(),children:"Retry"})]}):Object.entries(w).length>0?(0,a.jsx)("div",{className:"space-y-6",children:Object.entries(w).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"opacity-100 transform translate-y-0 transition-all duration-300",children:[(0,a.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center",children:[(0,a.jsx)(d.vlc,{className:"mr-2 text-primary-500"}),t,"Today"===t&&(0,a.jsx)("span",{className:"ml-2 text-xs font-medium py-0.5 px-2 rounded-full bg-blue-100 text-blue-700",children:"Today"}),"Tomorrow"===t&&(0,a.jsx)("span",{className:"ml-2 text-xs font-medium py-0.5 px-2 rounded-full bg-purple-100 text-purple-700",children:"Tomorrow"}),"Pending Confirmation"===t&&(0,a.jsx)("span",{className:"ml-2 text-xs font-medium py-0.5 px-2 rounded-full bg-yellow-100 text-yellow-700",children:"Awaiting Confirmation"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:s.map(e=>{var t,s,l,n,c,x,u,h,p;return(0,a.jsxs)(o.Z,{className:"overflow-hidden transition-all duration-300 \n                      ".concat(isPastDate(e.viewing_date)?"bg-gray-50":"bg-white"," \n                      ").concat("cancelled"===e.status?"border-red-200":""),padding:"none",hover:!0,children:[(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mr-3",children:(null===(t=e.property)||void 0===t?void 0:t.title)||"Property Viewing"}),getStatusBadge(e.status)]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-1 mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.i63,{className:"text-primary-500 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:(null===(s=e.property)||void 0===s?void 0:s.location)||"Location unavailable"})]}),(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.TCC,{className:"text-primary-500 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:e.viewing_time||"Time not set"})]}),(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.m6D,{className:"text-primary-500 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:(null===(l=e.property)||void 0===l?void 0:l.property_type)||"Property type unavailable"})]}),(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.fzv,{className:"text-primary-500 mr-2 flex-shrink-0"}),(0,a.jsx)("span",{children:"Sales Agent Assigned"})]})]}),"cancelled"===e.status&&(0,a.jsx)("div",{className:"bg-red-50 text-red-800 p-2 rounded-md text-sm mt-2",children:"This viewing has been cancelled. Please contact our team for assistance."}),"confirmed"===e.status&&!isPastDate(e.viewing_date)&&(0,a.jsx)("div",{className:"bg-green-50 text-green-800 p-2 rounded-md text-sm mt-2",children:"Your viewing is confirmed. We look forward to meeting you!"}),"requested"===e.status&&(0,a.jsx)("div",{className:"bg-gray-50 text-gray-800 p-2 rounded-md text-sm mt-2",children:"Thank you for requesting this viewing. Our sales team will propose available time slots soon."}),"options_sent"===e.status&&(0,a.jsxs)("div",{className:"bg-blue-50 text-blue-800 p-2 rounded-md text-sm mt-2",children:[(0,a.jsx)("p",{children:"Our sales team has proposed available time slots. Please select your preferred time."}),(0,a.jsx)("button",{onClick:()=>openSelectSlotModal(e),className:"mt-1 text-blue-700 hover:text-blue-900 font-medium text-sm",children:"Select a time slot"})]}),"slot_selected"===e.status&&(0,a.jsx)("div",{className:"bg-purple-50 text-purple-800 p-2 rounded-md text-sm mt-2",children:(0,a.jsx)("p",{children:"Thank you for selecting your preferred time slot. Our sales team will confirm your appointment shortly."})})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 flex sm:flex-col items-center sm:items-end justify-between sm:justify-start",children:[(0,a.jsxs)("div",{className:"flex items-center bg-primary-50 text-primary-700 px-2 py-1 rounded-full text-sm font-medium",children:[(0,a.jsx)(d.vlc,{className:"mr-1"}),e.viewing_date?formatDate(e.viewing_date):"Date pending"]}),(0,a.jsx)("button",{onClick:()=>toggleExpanded(e.id),className:"ml-4 sm:ml-0 sm:mt-3 text-primary-600 hover:text-primary-800 text-sm flex items-center",children:i.includes(e.id)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.rH8,{className:"mr-1"}),"Hide Details"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.bTu,{className:"mr-1"}),"Show Details"]})})]})]}),i.includes(e.id)&&(0,a.jsx)("div",{className:"mt-4 overflow-hidden",children:(0,a.jsxs)("div",{className:"border-t border-gray-100 pt-4",children:[e.notes&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Property Details"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[(0,a.jsx)("div",{className:"text-gray-600",children:"Type:"}),(0,a.jsx)("div",{className:"font-medium",children:(null===(n=e.property)||void 0===n?void 0:n.property_type)||"N/A"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Bedrooms:"}),(0,a.jsx)("div",{className:"font-medium",children:(null===(c=e.property)||void 0===c?void 0:c.bedrooms)||"N/A"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Bathrooms:"}),(0,a.jsx)("div",{className:"font-medium",children:(null===(x=e.property)||void 0===x?void 0:x.bathrooms)||"N/A"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Area:"}),(0,a.jsx)("div",{className:"font-medium",children:(null===(u=e.property)||void 0===u?void 0:u.area_size)?"".concat(e.property.area_size," m\xb2"):"N/A"}),(0,a.jsx)("div",{className:"text-gray-600",children:"Price:"}),(0,a.jsx)("div",{className:"font-medium",children:(null===(h=e.property)||void 0===h?void 0:h.price)?"".concat(e.property.price.toLocaleString()," EGP"):"N/A"})]}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)(r(),{href:"/properties/".concat(null===(p=e.property)||void 0===p?void 0:p.id),className:"inline-flex items-center text-primary-600 hover:text-primary-800 text-sm",children:["View Property Listing",(0,a.jsx)(d.AlO,{className:"ml-1 h-3 w-3"})]})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-1",children:"Contact Information"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-3 rounded-md",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.tUt,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{children:"Sales Team: +20 123 456 7890"})]}),(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsx)(d.Imn,{className:"h-4 w-4 mr-2"}),(0,a.jsx)("span",{children:"viewings@bigdealegy.com"})]})]}),(0,a.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-2",children:[(0,a.jsx)(m.Z,{variant:"outline",size:"sm",leftIcon:(0,a.jsx)(d.tUt,{}),disabled:"cancelled"===e.status,className:"w-full",children:"Call"}),(0,a.jsx)(m.Z,{variant:"outline",size:"sm",leftIcon:(0,a.jsx)(d.vlc,{}),disabled:"cancelled"===e.status,className:"w-full",children:"Reschedule"})]})]})]})]}),"options_sent"===e.status&&e.proposed_dates&&e.proposed_times&&(0,a.jsxs)("div",{className:"mt-4 bg-blue-50 p-3 rounded-md",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Available Time Slots"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,a.jsxs)("p",{className:"mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Available dates:"})," ",Array.isArray(e.proposed_dates)&&e.proposed_dates.map(e=>new Date(e).toLocaleDateString()).join(", ")]}),(0,a.jsxs)("p",{className:"mb-3",children:[(0,a.jsx)("span",{className:"font-medium",children:"Available times:"})," ",Array.isArray(e.proposed_times)&&e.proposed_times.join(", ")]}),(0,a.jsx)("button",{onClick:()=>openSelectSlotModal(e),className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 transition-colors",children:"Select Time Slot"})]})]}),"slot_selected"===e.status&&e.selected_date&&e.selected_time&&(0,a.jsxs)("div",{className:"mt-4 bg-purple-50 p-3 rounded-md",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Your Selected Time"}),(0,a.jsxs)("div",{className:"text-sm text-purple-700",children:[(0,a.jsxs)("p",{className:"mb-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Selected date:"})," ",new Date(e.selected_date).toLocaleDateString()]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Selected time:"})," ",e.selected_time]})]})]})]})})]}),(0,a.jsxs)("div",{className:"px-5 py-3 bg-gray-50 border-t border-gray-100 flex justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full mr-2 ".concat("confirmed"===e.status?"bg-green-500":"pending"===e.status?"bg-amber-500":"cancelled"===e.status?"bg-red-500":"bg-gray-500")}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"confirmed"===e.status?"Confirmed":"requested"===e.status?"Request Submitted":"options_sent"===e.status?"Select Available Time":"slot_selected"===e.status?"Awaiting Confirmation":"cancelled"===e.status?"Cancelled":"completed"===e.status?"Completed":"Unknown Status"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(r(),{href:"/dashboard/scheduled-viewings/".concat(e.id),className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md text-primary-700 bg-primary-50 hover:bg-primary-100 transition-colors",children:"View Details"}),"options_sent"===e.status&&(0,a.jsx)("button",{onClick:()=>openSelectSlotModal(e),className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 transition-colors",children:"Select Time"}),("requested"===e.status||"options_sent"===e.status)&&(0,a.jsx)("button",{onClick:()=>openCancelModal(e),className:"inline-flex items-center px-3 py-1 text-xs font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100 transition-colors",children:"Cancel"})]})]})]},e.id)})})]},t)})}):(0,a.jsx)("div",{className:"opacity-100 scale-100 transition-all duration-300",children:(0,a.jsxs)(o.Z,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"mx-auto h-20 w-20 rounded-full bg-primary-50 flex items-center justify-center mb-4",children:(0,a.jsx)(d.vlc,{className:"h-10 w-10 text-primary-500"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No viewings scheduled"}),(0,a.jsxs)("p",{className:"text-gray-500 max-w-md mx-auto mb-6",children:["You don't have any ","all"!==t?t:""," property viewings scheduled."]}),(0,a.jsx)(m.Z,{variant:"gradient",href:"/dashboard/property-requests",leftIcon:(0,a.jsx)(d.m6D,{}),children:"Browse Property Requests"})]})}),(0,a.jsx)(h.Z,{isOpen:f,onClose:()=>y(!1),viewingId:null==v?void 0:v.id,onSuccess:()=>{y(!1),j(null)}}),p&&(0,a.jsx)(SelectViewingSlotModal,{isOpen:x,onClose:()=>u(!1),viewingId:p.id,propertyTitle:(null===(e=p.property)||void 0===e?void 0:e.title)||"Property",proposedDates:p.proposed_dates||[],proposedTimes:p.proposed_times||[]})]})}},2595:function(e,t,s){"use strict";s.d(t,{Z:function(){return Card}});var a=s(7437);function Card(e){let{children:t,className:s="",padding:l="small",shadow:i="small",rounded:r="medium",border:n=!1,hover:c=!1,clickable:d=!1}=e;return(0,a.jsx)("div",{className:"\n        bg-white\n        ".concat({none:"p-0",xs:"p-2",small:"p-3",medium:"p-4",large:"p-5"}[l],"\n        ").concat({none:"",small:"shadow-sm",medium:"shadow",large:"shadow-lg"}[i],"\n        ").concat({none:"rounded-none",small:"rounded-md",medium:"rounded-lg",large:"rounded-xl"}[r],"\n        ").concat(n?"border border-gray-100":"","\n        ").concat(c?"transition-all duration-200 hover:shadow-md hover:translate-y-[-1px]":"","\n        ").concat(d?"cursor-pointer active:scale-[0.99] active:shadow-inner transition-transform":"","\n        ").concat(s,"\n      "),children:t})}s(2265)},907:function(e,t,s){"use strict";s.d(t,{Z:function(){return CancelViewingModal}});var a=s(7437),l=s(2265),i=s(8920),r=s(4734),n=s(5243),c=s(2749);function CancelViewingModal(e){let{isOpen:t,onClose:s,viewingId:d,onSuccess:o}=e,[m,x]=(0,l.useState)(!1),[u,h]=(0,l.useState)(null),[p,g]=(0,l.useState)(""),[f,y]=(0,l.useState)(!1),{session:v}=(0,n.a)(),handleCancel=async()=>{if(d&&(null==v?void 0:v.access_token)){x(!0),h(null);try{await c.ZP.cancelScheduledViewing(v.access_token,d,{cancellation_reason:p}),y(!0),setTimeout(()=>{o&&o()},2e3)}catch(e){console.error("Error cancelling viewing:",e),h("Failed to cancel viewing. Please try again.")}finally{x(!1)}}};return t?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:s}),(0,a.jsxs)("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:[(0,a.jsxs)("div",{className:"bg-red-50 px-4 py-3 sm:px-6 flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-red-900 flex items-center",children:[(0,a.jsx)(i.bcx,{className:"mr-2 h-5 w-5 text-red-600"}),"Cancel Viewing Appointment"]}),(0,a.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500",onClick:s,children:(0,a.jsx)(i.q5L,{className:"h-6 w-6"})})]}),(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:f?(0,a.jsxs)("div",{className:"text-center py-6",children:[(0,a.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,a.jsx)(i.UgA,{className:"h-6 w-6 text-green-600"})}),(0,a.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Viewing Cancelled"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Your viewing appointment has been successfully cancelled. If you change your mind, you can always request a new viewing."})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Are you sure you want to cancel this viewing appointment? This action cannot be undone."}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{htmlFor:"reason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for cancellation (optional)"}),(0,a.jsx)("textarea",{id:"reason",className:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 rounded-md",placeholder:"Please let us know why you're cancelling...",rows:3,value:p,onChange:e=>g(e.target.value)})]}),u&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:u})]})}),(0,a.jsx)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:f?(0,a.jsx)(r.Z,{variant:"primary",onClick:s,children:"Done"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{variant:"danger",onClick:handleCancel,loading:m,children:m?"Cancelling...":"Confirm Cancellation"}),(0,a.jsx)(r.Z,{variant:"light",onClick:s,className:"mr-2",children:"Back"})]})})]})]})}):null}},4033:function(e,t,s){e.exports=s(94)},1393:function(e,t,s){"use strict";s.d(t,{M:function(){return AnimatePresence}});var a=s(7437),l=s(2265),i=s(781),r=s(961),n=s(538),c=s(8243),d=s(5968);let PopChildMeasure=class PopChildMeasure extends l.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,s=e instanceof HTMLElement&&e.offsetWidth||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}};function PopChild({children:e,isPresent:t,anchorX:s}){let i=(0,l.useId)(),r=(0,l.useRef)(null),n=(0,l.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=(0,l.useContext)(d._);return(0,l.useInsertionEffect)(()=>{let{width:e,height:a,top:l,left:d,right:o}=n.current;if(t||!r.current||!e||!a)return;let m="left"===s?`left: ${d}`:`right: ${o}`;r.current.dataset.motionPopId=i;let x=document.createElement("style");return c&&(x.nonce=c),document.head.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${a}px !important;
            ${m}px !important;
            top: ${l}px !important;
          }
        `),()=>{document.head.removeChild(x)}},[t]),(0,a.jsx)(PopChildMeasure,{isPresent:t,childRef:r,sizeRef:n,children:l.cloneElement(e,{ref:r})})}let PresenceChild=({children:e,initial:t,isPresent:s,onExitComplete:i,custom:n,presenceAffectsLayout:d,mode:o,anchorX:m})=>{let x=(0,r.h)(newChildrenMap),u=(0,l.useId)(),h=!0,p=(0,l.useMemo)(()=>(h=!1,{id:u,initial:t,isPresent:s,custom:n,onExitComplete:e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;i&&i()},register:e=>(x.set(e,!1),()=>x.delete(e))}),[s,x,i]);return d&&h&&(p={...p}),(0,l.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[s]),l.useEffect(()=>{s||x.size||!i||i()},[s]),"popLayout"===o&&(e=(0,a.jsx)(PopChild,{isPresent:s,anchorX:m,children:e})),(0,a.jsx)(c.O.Provider,{value:p,children:e})};function newChildrenMap(){return new Map}var o=s(7196);let getChildKey=e=>e.key||"";function onlyElements(e){let t=[];return l.Children.forEach(e,e=>{(0,l.isValidElement)(e)&&t.push(e)}),t}let AnimatePresence=({children:e,custom:t,initial:s=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:m="sync",propagate:x=!1,anchorX:u="left"})=>{let[h,p]=(0,o.oO)(x),g=(0,l.useMemo)(()=>onlyElements(e),[e]),f=x&&!h?[]:g.map(getChildKey),y=(0,l.useRef)(!0),v=(0,l.useRef)(g),j=(0,r.h)(()=>new Map),[b,N]=(0,l.useState)(g),[w,C]=(0,l.useState)(g);(0,n.L)(()=>{y.current=!1,v.current=g;for(let e=0;e<w.length;e++){let t=getChildKey(w[e]);f.includes(t)?j.delete(t):!0!==j.get(t)&&j.set(t,!1)}},[w,f.length,f.join("-")]);let S=[];if(g!==b){let e=[...g];for(let t=0;t<w.length;t++){let s=w[t],a=getChildKey(s);f.includes(a)||(e.splice(t,0,s),S.push(s))}return"wait"===m&&S.length&&(e=S),C(onlyElements(e)),N(g),null}let{forceRender:k}=(0,l.useContext)(i.p);return(0,a.jsx)(a.Fragment,{children:w.map(e=>{let l=getChildKey(e),i=(!x||!!h)&&(g===w||f.includes(l));return(0,a.jsx)(PresenceChild,{isPresent:i,initial:(!y.current||!!s)&&void 0,custom:t,presenceAffectsLayout:d,mode:m,onExitComplete:i?void 0:()=>{if(!j.has(l))return;j.set(l,!0);let e=!0;j.forEach(t=>{t||(e=!1)}),e&&(k?.(),C(v.current),x&&p?.(),c&&c())},anchorX:u,children:e},l)})})}}},function(e){e.O(0,[2438,8920,8611,1907,2971,2472,1744],function(){return e(e.s=1262)}),_N_E=e.O()}]);