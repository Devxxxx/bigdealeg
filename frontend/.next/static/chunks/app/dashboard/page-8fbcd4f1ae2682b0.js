(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{4272:function(e,s,r){Promise.resolve().then(r.bind(r,7836))},7836:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return DashboardHome}});var t=r(7437),a=r(2265),i=r(1396),n=r.n(i),o=r(8920),l=r(5243);let getDashboardData=async e=>{try{let r=await fetch("".concat("bigdealegypt.up.railway.app/api","/customer/dashboard"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!r.ok){var s;let e=await r.json();throw Error((null===(s=e.error)||void 0===s?void 0:s.message)||"Failed to fetch dashboard data")}return await r.json()}catch(e){throw console.error("Get dashboard data error:",e),e}};var c={getDashboardData};function useDashboardData(){let[e,s]=(0,a.useState)({propertyRequests:{total:0,newCount:0,inProgressCount:0,matchedCount:0,statusText:"Loading..."},scheduledViewings:{total:0,upcomingCount:0,statusText:"Loading..."},availableProperties:{total:0,matchingCount:0,statusText:"Loading..."},recentPropertyRequests:[],upcomingViewings:[],savedProperties:[]}),[r,t]=(0,a.useState)(!0),[i,n]=(0,a.useState)(null),{user:o,session:d}=(0,l.a)();return(0,a.useEffect)(()=>{let fetchDashboardData=async()=>{if(!o||!(null==d?void 0:d.access_token)){t(!1);return}t(!0);try{let e=await c.getDashboardData(d.access_token);s(e)}catch(e){console.error("Error fetching dashboard data:",e),n(e.message||"Failed to load dashboard data")}finally{t(!1)}};fetchDashboardData()},[o,null==d?void 0:d.access_token]),{stats:e,loading:r,error:i}}let ActionCard=e=>{let{icon:s,title:r,href:a}=e;return(0,t.jsxs)(n(),{href:a,className:"flex items-center justify-center flex-col bg-white hover:bg-gray-50 rounded-xl border border-gray-200 p-4 sm:p-6 transition-colors shadow-sm hover:shadow-md",children:[(0,t.jsx)("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-primary-100 rounded-full flex items-center justify-center text-primary-600 mb-2 sm:mb-3",children:s}),(0,t.jsx)("span",{className:"text-gray-900 font-medium text-center text-sm sm:text-base",children:r})]})},QuickLinkCard=e=>{let{title:s,count:r,icon:a,href:i,linkText:o,bgColor:l="bg-gray-50"}=e;return(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all",children:[(0,t.jsx)("div",{className:"p-4 sm:p-5",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900",children:s}),(0,t.jsx)("div",{className:"mt-1 text-sm text-gray-500",children:r})]}),(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg flex items-center justify-center ".concat(l),children:a})]})}),(0,t.jsx)("div",{className:"border-t border-gray-200 px-4 sm:px-5 py-3 bg-gray-50",children:(0,t.jsxs)(n(),{href:i,className:"text-sm text-primary-600 hover:text-primary-700 font-medium flex items-center",children:[o,(0,t.jsx)("svg",{className:"ml-1 h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})},TabButton=e=>{let{active:s,children:r,onClick:a}=e;return(0,t.jsx)("button",{className:"px-3 py-2 text-sm font-medium rounded-md ".concat(s?"bg-primary-50 text-primary-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),onClick:a,children:r})};function DashboardHome(){var e,s,r,i;let{stats:c,loading:d,error:u}=useDashboardData(),{user:h}=(0,l.a)(),[m,g]=a.useState("all");return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-heading-2",children:"Dashboard"}),(0,t.jsxs)("p",{className:"text-subtitle mt-1",children:["Welcome back, ",(null==h?void 0:h.name)||"User"]})]}),(0,t.jsxs)(n(),{href:"/dashboard/property-requests/new",className:"btn-primary flex items-center",children:[(0,t.jsx)(o.OvN,{className:"mr-1.5"}),"New Request"]})]}),(0,t.jsxs)("div",{className:"grid-responsive-3 mb-8",children:[(0,t.jsx)(QuickLinkCard,{title:"Property Requests",count:c.propertyRequests.statusText,icon:(0,t.jsx)(o.tHe,{className:"h-5 w-5 text-primary-600"}),href:"/dashboard/property-requests",linkText:"Manage requests",bgColor:"bg-primary-100"}),(0,t.jsx)(QuickLinkCard,{title:"Upcoming Viewings",count:c.scheduledViewings.statusText,icon:(0,t.jsx)(o.vlc,{className:"h-5 w-5 text-secondary-600"}),href:"/dashboard/scheduled-viewings",linkText:"View all viewings",bgColor:"bg-secondary-100"}),(0,t.jsx)(QuickLinkCard,{title:"Available Properties",count:c.availableProperties.statusText,icon:(0,t.jsx)(o.m6D,{className:"h-5 w-5 text-accent-600"}),href:"/properties",linkText:"Browse properties",bgColor:"bg-accent-100"})]}),(0,t.jsx)("h2",{className:"text-heading-3 mb-4",children:"Quick Actions"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 md:gap-4 mb-8",children:[(0,t.jsx)(ActionCard,{icon:(0,t.jsx)(o.OvN,{className:"h-5 w-5"}),title:"New Request",href:"/dashboard/property-requests/new"}),(0,t.jsx)(ActionCard,{icon:(0,t.jsx)(o.jRj,{className:"h-5 w-5"}),title:"Find Property",href:"/properties"}),(0,t.jsx)(ActionCard,{icon:(0,t.jsx)(o.TCC,{className:"h-5 w-5"}),title:"My Viewings",href:"/dashboard/scheduled-viewings"}),(0,t.jsx)(ActionCard,{icon:(0,t.jsx)(o.vWP,{className:"h-5 w-5"}),title:"Notifications",href:"/dashboard/notifications"})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-heading-3",children:"Activity"}),(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[(0,t.jsx)(TabButton,{active:"all"===m,onClick:()=>g("all"),children:"All"}),(0,t.jsx)(TabButton,{active:"requests"===m,onClick:()=>g("requests"),children:"Requests"}),(0,t.jsx)(TabButton,{active:"viewings"===m,onClick:()=>g("viewings"),children:"Viewings"})]})]}),("all"===m||"requests"===m)&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Property Requests"}),(0,t.jsx)(n(),{href:"/dashboard/property-requests",className:"text-sm text-primary-600 hover:text-primary-700",children:"View all"})]}),d?(0,t.jsx)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:(0,t.jsx)("div",{className:"animate-pulse flex space-x-4",children:(0,t.jsxs)("div",{className:"flex-1 space-y-4 py-1",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})}):c.recentPropertyRequests.length>0?(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm",children:(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:c.recentPropertyRequests.map(e=>(0,t.jsx)("div",{className:"p-4 hover:bg-gray-50",children:(0,t.jsxs)(n(),{href:"/dashboard/property-requests/".concat(e.id),className:"block",children:[(0,t.jsxs)("h3",{className:"font-medium text-gray-900",children:[e.property_type," in ",e.location]}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center text-sm text-gray-500 gap-2",children:[(0,t.jsxs)("span",{children:["Budget: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",maximumFractionDigits:0}).format(e.max_price||0)]}),(0,t.jsx)("span",{className:"hidden sm:inline-block",children:"|"}),(0,t.jsxs)("span",{children:["Size: ",e.min_area||0," - ",e.max_area||"Any"," m\xb2"]})]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("new"===e.status||"pending"===e.status?"bg-blue-100 text-blue-800":"in_progress"===e.status||"active"===e.status?"bg-yellow-100 text-yellow-800":"matched"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"new"===e.status||"pending"===e.status?"New":"in_progress"===e.status||"active"===e.status?"In Progress":"matched"===e.status?"Properties Found":e.status.charAt(0).toUpperCase()+e.status.slice(1)})})]})},e.id))})}):(0,t.jsx)("div",{className:"bg-gray-100 rounded-xl h-48 flex items-center justify-center border border-dashed border-gray-300",children:(0,t.jsxs)("div",{className:"text-center p-6",children:[(0,t.jsx)("div",{className:"mb-2 text-gray-500",children:"Your recent property requests will appear here"}),(0,t.jsxs)(n(),{href:"/dashboard/property-requests/new",className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm",children:[(0,t.jsx)(o.OvN,{className:"mr-1.5"}),"Create New Request"]})]})})]}),("all"===m||"viewings"===m)&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Upcoming Viewings"}),(0,t.jsx)(n(),{href:"/dashboard/scheduled-viewings",className:"text-sm text-primary-600 hover:text-primary-700",children:"View all"})]}),d?(0,t.jsx)("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:(0,t.jsx)("div",{className:"animate-pulse flex space-x-4",children:(0,t.jsxs)("div",{className:"flex-1 space-y-4 py-1",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})})}):c.upcomingViewings.length>0?(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm",children:(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:c.upcomingViewings.map(e=>(0,t.jsx)("div",{className:"p-4 hover:bg-gray-50",children:(0,t.jsxs)(n(),{href:"/dashboard/scheduled-viewings/".concat(e.id),className:"block",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900",children:e.property_title||"Property Viewing"}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap items-center text-sm text-gray-500 gap-2",children:[(0,t.jsx)("span",{children:new Date(e.viewing_date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,t.jsx)("span",{className:"hidden sm:inline-block",children:"|"}),(0,t.jsx)("span",{children:new Date(e.viewing_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat("scheduled"===e.status||"pending"===e.status?"bg-blue-100 text-blue-800":"confirmed"===e.status?"bg-green-100 text-green-800":"cancelled"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"scheduled"===e.status||"pending"===e.status?"Scheduled":"confirmed"===e.status?"Confirmed":"cancelled"===e.status?"Canceled":e.status.charAt(0).toUpperCase()+e.status.slice(1)})})]})},e.id))})}):(0,t.jsx)("div",{className:"bg-gray-100 rounded-xl h-48 flex items-center justify-center border border-dashed border-gray-300",children:(0,t.jsxs)("div",{className:"text-center p-6",children:[(0,t.jsx)("div",{className:"mb-2 text-gray-500",children:"No upcoming viewings scheduled"}),(0,t.jsxs)(n(),{href:"/properties",className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm",children:[(0,t.jsx)(o.jRj,{className:"mr-1.5"}),"Find Properties"]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-heading-3",children:"Insights"}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-4 sm:p-6 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-secondary-100 rounded-full flex items-center justify-center text-secondary-600",children:(0,t.jsx)(o.orK,{className:"h-4 w-4"})}),(0,t.jsx)("h3",{className:"text-base font-medium text-gray-900",children:"Current Market Trends"})]}),d?(0,t.jsxs)("div",{className:"animate-pulse space-y-3",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}):(0,t.jsxs)("div",{className:"space-y-3 text-sm text-gray-600",children:[(0,t.jsxs)("p",{children:["Based on your location preferences, property prices in ",(null===(s=c.recentPropertyRequests)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.location)||"New Cairo"," have",Math.random()>.5?"increased":"stabilized"," recently. The average price per square meter is now",new Intl.NumberFormat("en-US",{style:"currency",currency:"EGP",maximumFractionDigits:0}).format(18500+Math.floor(2e3*Math.random())),"."]}),(0,t.jsxs)("p",{children:[c.availableProperties.matchingCount," properties match your latest search criteria. This represents",Math.round(c.availableProperties.matchingCount/c.availableProperties.total*100)||5,"% of the current market inventory."]}),(0,t.jsxs)("p",{children:["Properties like ",(null===(i=c.recentPropertyRequests)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.property_type)||"Apartments"," in your preferred locations typically receive ",3+Math.floor(5*Math.random())," viewing requests per week, so we recommend scheduling viewings promptly."]})]})]})]})]})}},5243:function(e,s,r){"use strict";r.d(s,{a:function(){return useAuth}});var t=r(4523);function useAuth(){var e;let s=(0,t.useAuth)(),r=(null===(e=s.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,r)=>{try{return await s.signIn(e,r),{error:null}}catch(e){return{error:e}}},signUp=async(e,r,t)=>{try{return await s.signUp(e,r,t),{error:null}}catch(e){return{error:e}}};return{...s,role:r,signIn,signUp}}},4523:function(e,s,r){"use strict";r.r(s),r.d(s,{AuthProvider:function(){return AuthProvider},default:function(){return c},useAuth:function(){return useAuth}});var t=r(7437),a=r(2265);let i="bigdealegypt.up.railway.app/api",signIn=async(e,s)=>{try{let t=await fetch("".concat(i,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s}),credentials:"include"});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Authentication failed")}return await t.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,s,r)=>{try{let a=await fetch("".concat(i,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s,name:r})});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Registration failed")}return await a.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let s=await fetch("".concat(i,"/auth/signout"),{method:"POST",credentials:"include"});if(!s.ok){var e;let r=await s.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await s.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let r=await fetch("".concat(i,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var s;let e=await r.json();throw Error((null===(s=e.error)||void 0===s?void 0:s.message)||"Failed to retrieve session")}return await r.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let s=await fetch("".concat(i,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!s.ok){var e;let r=await s.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await s.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,s)=>{try{let t=await fetch("".concat(i,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(s)}});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to get user profile")}return await t.json()}catch(e){throw console.error("Get user profile error:",e),e}};var n={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},o=r(4033);let l=(0,a.createContext)(void 0),AuthProvider=e=>{let{children:s}=e,[r,i]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),[m,g]=(0,a.useState)(null),x=(0,o.useRouter)();(0,a.useEffect)(()=>{if(c){let e=new Date(c.expires_at).getTime(),s=Date.now(),r=e-s;if(r<3e5){refreshSession();return}let t=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(t)}},[c]),(0,a.useEffect)(()=>{let initAuth=async()=>{h(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){h(!1);return}let s=await n.getSession(e);(null==s?void 0:s.user)&&(null==s?void 0:s.session)?(i(s.user),d(s.session),localStorage.setItem("access_token",s.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{h(!1)}};initAuth()},[]);let signIn=async(e,s)=>{h(!0),g(null);try{let r=await n.signIn(e,s);(null==r?void 0:r.user)&&(null==r?void 0:r.session)&&(i(r.user),d(r.session),localStorage.setItem("access_token",r.session.access_token),x.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{h(!1)}},signUp=async(e,s,r)=>{h(!0),g(null);try{let t=await n.signUp(e,s,r);(null==t?void 0:t.user)&&x.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{h(!1)}},signOut=async()=>{h(!0);try{await n.signOut(),i(null),d(null),localStorage.removeItem("access_token"),x.push("/")}catch(e){console.error("Sign out error:",e),i(null),d(null),localStorage.removeItem("access_token"),x.push("/")}finally{h(!1)}},refreshSession=async()=>{if(!u)try{let e=await n.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(i(e.user),d(e.session),localStorage.setItem("access_token",e.session.access_token)):(i(null),d(null),localStorage.removeItem("access_token"),x.push("/login"))}catch(e){console.error("Session refresh error:",e),i(null),d(null),localStorage.removeItem("access_token"),x.push("/login")}};return(0,t.jsx)(l.Provider,{value:{user:r,session:c,loading:u,error:m,isAuthenticated:!!r,signIn,signUp,signOut,refreshSession},children:s})},useAuth=()=>{let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var c=l},4033:function(e,s,r){e.exports=r(94)}},function(e){e.O(0,[2438,8920,2971,2472,1744],function(){return e(e.s=4272)}),_N_E=e.O()}]);