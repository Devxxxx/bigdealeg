(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7865],{2208:function(e,t,s){Promise.resolve().then(s.bind(s,5815))},5815:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PropertyRequestsPage}});var r=s(7437),a=s(2265),l=s(1396),n=s.n(l),i=s(4033),c=s(8920),o=s(6081),d=s(7460);let StatusBadge=e=>{let{status:t}=e;return(0,r.jsx)("span",{className:"px-2.5 py-0.5 text-xs font-medium rounded-full ".concat({active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",completed:"bg-blue-100 text-blue-800",cancelled:"bg-red-100 text-red-800"}[t.toLowerCase()]||"bg-gray-100 text-gray-800"),children:t})},formatPriceRange=(e,t)=>{let formatPrice=e=>e?e.toLocaleString("en-US"):"";return e&&t?"".concat(formatPrice(e)," - ").concat(formatPrice(t)," EGP"):e?"".concat(formatPrice(e),"+ EGP"):t?"Up to ".concat(formatPrice(t)," EGP"):"Price not specified"},formatDate=e=>{if(!e)return"";try{return(0,d.Z)(new Date(e),{addSuffix:!0})}catch(t){return console.error("Date formatting error:",t),e}},PropertyRequestCard=e=>{let{request:t}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:t.title}),(0,r.jsx)(StatusBadge,{status:t.status})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(c.i63,{className:"mr-2 text-gray-400 flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:t.location})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(c.m6D,{className:"mr-2 text-gray-400 flex-shrink-0"}),(0,r.jsx)("span",{children:t.property_type})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(c.oQC,{className:"mr-2 text-gray-400 flex-shrink-0"}),(0,r.jsx)("span",{children:formatPriceRange(t.min_price,t.max_price)})]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-600",children:[(0,r.jsx)(c.TCC,{className:"mr-2 text-gray-400 flex-shrink-0"}),(0,r.jsx)("span",{children:formatDate(t.created_at)})]})]}),(0,r.jsxs)("div",{className:"mt-3 text-sm",children:[(0,r.jsx)("span",{className:"text-primary-600 font-medium",children:t.match_count||0})," properties matched",t.new_matches>0&&(0,r.jsxs)("span",{className:"ml-2 bg-primary-100 text-primary-700 px-2 py-0.5 rounded-full text-xs",children:[t.new_matches," new"]})]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-200 py-3 px-4 flex justify-between bg-gray-50",children:[(0,r.jsx)(n(),{href:"/dashboard/property-requests/".concat(t.id),className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"View Details"}),(0,r.jsx)(n(),{href:"/dashboard/property-requests/".concat(t.id,"/edit"),className:"text-sm text-gray-600 hover:text-gray-900",children:"Edit Request"})]})]})},EmptyState=e=>{let{searchQuery:t,onCreateNew:s}=e;return(0,r.jsxs)("div",{className:"bg-white p-8 rounded-xl border border-gray-200 text-center",children:[(0,r.jsx)("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)(c.jRj,{className:"text-gray-400 w-6 h-6"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No requests found"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:t?'No property requests matched your search "'.concat(t,'"'):"You haven't created any property requests yet."}),(0,r.jsxs)("button",{onClick:s,className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:[(0,r.jsx)(c.OvN,{className:"mr-2"}),"Create New Request"]})]})},ErrorState=e=>{let{error:t,onRetry:s}=e;return(0,r.jsxs)("div",{className:"bg-white p-8 rounded-xl border border-gray-200 text-center",children:[(0,r.jsx)("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)(c.bcx,{className:"text-red-500 w-6 h-6"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error loading requests"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:t}),(0,r.jsx)("button",{onClick:s,className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:"Retry"})]})};function PropertyRequestsPage(){let{requests:e,loading:t,error:s,fetchRequests:l,updateFilters:d,filters:m}=(0,o.m)({loadOnMount:!0}),[x,u]=(0,a.useState)(""),[p,y]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!1),[b,N]=(0,a.useState)("All");(0,i.usePathname)();let v=(null==e?void 0:e.filter(e=>(!x||!!e.title.toLowerCase().includes(x.toLowerCase()))&&("All"===b||e.status===b.toLowerCase())))||[];return(0,a.useEffect)(()=>{let handleClickOutside=e=>{p&&!e.target.closest(".filters-dropdown")&&y(!1),h&&!e.target.closest(".date-dropdown")&&g(!1),f&&!e.target.closest(".status-dropdown")&&j(!1)};return document.addEventListener("mousedown",handleClickOutside),()=>document.removeEventListener("mousedown",handleClickOutside)},[p,h,f]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Property Requests"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your property requirements and track matches"})]}),(0,r.jsx)("div",{className:"mt-4 sm:mt-0",children:(0,r.jsxs)(n(),{href:"/dashboard/property-requests/new",className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors",children:[(0,r.jsx)(c.OvN,{className:"mr-1.5"}),"New Request"]})})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(c.jRj,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{type:"text",placeholder:"Search requests...",className:"block w-full border border-gray-300 rounded-lg py-2 pl-10 pr-3 placeholder-gray-500 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500",value:x,onChange:e=>u(e.target.value)})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("div",{className:"relative filters-dropdown",children:[(0,r.jsxs)("button",{type:"button",className:"inline-flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 min-w-[100px]",onClick:()=>{y(!p),g(!1),j(!1)},children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.Ihx,{className:"mr-2 text-gray-500"}),"Filters"]}),(0,r.jsx)(c.bTu,{className:"ml-2 text-gray-500"})]}),p&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 mb-2",children:"Filter by"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:"Property Type"}),(0,r.jsxs)("select",{className:"w-full border border-gray-300 rounded-lg py-1.5 px-3 text-sm",children:[(0,r.jsx)("option",{children:"Any"}),(0,r.jsx)("option",{children:"Apartment"}),(0,r.jsx)("option",{children:"Villa"}),(0,r.jsx)("option",{children:"Office"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:"Price Range"}),(0,r.jsxs)("select",{className:"w-full border border-gray-300 rounded-lg py-1.5 px-3 text-sm",children:[(0,r.jsx)("option",{children:"Any"}),(0,r.jsx)("option",{children:"Under 1M"}),(0,r.jsx)("option",{children:"1M - 3M"}),(0,r.jsx)("option",{children:"3M - 5M"}),(0,r.jsx)("option",{children:"Over 5M"})]})]})]}),(0,r.jsx)("div",{className:"mt-3 flex justify-end",children:(0,r.jsx)("button",{type:"button",className:"bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium py-1.5 px-3 rounded-lg",children:"Apply"})})]})})]}),(0,r.jsxs)("div",{className:"relative date-dropdown",children:[(0,r.jsxs)("button",{type:"button",className:"inline-flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 min-w-[100px]",onClick:()=>{g(!h),y(!1),j(!1)},children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(c.vlc,{className:"mr-2 text-gray-500"}),"Date"]}),(0,r.jsx)(c.bTu,{className:"ml-2 text-gray-500"})]}),h&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:(0,r.jsx)("div",{className:"p-3",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"date",className:"h-4 w-4 text-primary-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"All time"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"date",className:"h-4 w-4 text-primary-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Last 7 days"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"date",className:"h-4 w-4 text-primary-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Last 30 days"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"date",className:"h-4 w-4 text-primary-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Last 3 months"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"date",className:"h-4 w-4 text-primary-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Custom range"})]})]})})})]}),(0,r.jsxs)("div",{className:"relative status-dropdown",children:[(0,r.jsxs)("button",{type:"button",className:"inline-flex items-center justify-between bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 min-w-[100px]",onClick:()=>{j(!f),y(!1),g(!1)},children:[(0,r.jsx)("div",{className:"flex items-center",children:"Status"}),(0,r.jsx)(c.bTu,{className:"ml-2 text-gray-500"})]}),f&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:(0,r.jsx)("div",{className:"p-3",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"status",className:"h-4 w-4 text-primary-600",checked:"All"===b,onChange:()=>{N("All"),d({status:void 0})}}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"All"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"status",className:"h-4 w-4 text-primary-600",checked:"Active"===b,onChange:()=>{N("Active"),d({status:"active"})}}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Active"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"status",className:"h-4 w-4 text-primary-600",checked:"Pending"===b,onChange:()=>{N("Pending"),d({status:"pending"})}}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Pending"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"status",className:"h-4 w-4 text-primary-600",checked:"Completed"===b,onChange:()=>{N("Completed"),d({status:"completed"})}}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Completed"})]}),(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"radio",name:"status",className:"h-4 w-4 text-primary-600",checked:"Cancelled"===b,onChange:()=>{N("Cancelled"),d({status:"cancelled"})}}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Cancelled"})]})]})})})]})]})]})}),t?(0,r.jsxs)("div",{className:"flex justify-center items-center p-12",children:[(0,r.jsx)(c.dAq,{className:"animate-spin h-8 w-8 text-primary-600 mr-2"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Loading property requests..."})]}):s?(0,r.jsx)(ErrorState,{error:s,onRetry:l}):0===v.length?(0,r.jsx)(EmptyState,{searchQuery:x,onCreateNew:()=>{window.location.href="/dashboard/property-requests/new"}}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:v.map(e=>(0,r.jsx)(PropertyRequestCard,{request:e},e.id))})]})}},6081:function(e,t,s){"use strict";s.d(t,{m:function(){return usePropertyRequests}});var r=s(2265),a=s(5243),l=s(4389);function usePropertyRequests(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,s]=(0,r.useState)([]),[n,i]=(0,r.useState)(null),[c,o]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(e.filters||{}),[p,y]=(0,r.useState)({page:1,limit:10,totalPages:1,totalCount:0}),[h,g]=(0,r.useState)([]),{user:f,session:j}=(0,a.a)(),b=(0,r.useCallback)(async()=>{if(f&&(null==j?void 0:j.access_token)){o(!0),m(null);try{let e=await l.ZP.getPropertyRequests(j.access_token,{...x,page:p.page,limit:p.limit,role:null==f?void 0:f.role});console.log("Property requests result:",e),s(e.requests||[]),y({...p,totalPages:e.totalPages||1,totalCount:e.totalCount||0})}catch(e){console.error("Error fetching property requests:",e),m(e.message||"Failed to fetch property requests")}finally{o(!1)}}},[f,j,x,p.page,p.limit]),N=(0,r.useCallback)(async e=>{if(f&&(null==j?void 0:j.access_token)&&e){o(!0),m(null);try{let t=await l.ZP.getPropertyRequestById(j.access_token,e);return i(t),t}catch(e){return console.error("Error fetching property request:",e),m(e.message||"Failed to fetch property request"),null}finally{o(!1)}}},[f,j]),v=(0,r.useCallback)(async e=>{if(!f||!(null==j?void 0:j.access_token))return null;o(!0),m(null);try{let t=await l.ZP.createPropertyRequest(j.access_token,e);return t}catch(e){return console.error("Error creating property request:",e),m(e.message||"Failed to create property request"),null}finally{o(!1)}},[f,j]),w=(0,r.useCallback)(async(e,t)=>{if(!f||!(null==j?void 0:j.access_token)||!e)return null;o(!0),m(null);try{let r=await l.ZP.updatePropertyRequest(j.access_token,e,t);return n&&n.id===e&&i(r),s(t=>t.map(t=>t.id===e?{...t,...r}:t)),r}catch(e){return console.error("Error updating property request:",e),m(e.message||"Failed to update property request"),null}finally{o(!1)}},[f,j,n]),k=(0,r.useCallback)(async e=>{if(!f||!(null==j?void 0:j.access_token)||!e)return!1;o(!0),m(null);try{return await l.ZP.deletePropertyRequest(j.access_token,e),s(t=>t.filter(t=>t.id!==e)),n&&n.id===e&&i(null),!0}catch(e){return console.error("Error deleting property request:",e),m(e.message||"Failed to delete property request"),!1}finally{o(!1)}},[f,j,n]),q=(0,r.useCallback)(async()=>{if(f&&(null==j?void 0:j.access_token)){o(!0),m(null);try{let e=await l.ZP.getPropertyRequestFields(j.access_token);return g(e||[]),e}catch(e){return console.error("Error fetching property request fields:",e),m(e.message||"Failed to fetch property request fields"),[]}finally{o(!1)}}},[f,j]),C=(0,r.useCallback)(async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!f||!(null==j?void 0:j.access_token)||!e||!t)return null;o(!0),m(null);try{let a=await l.ZP.assignPropertyRequest(j.access_token,e,t,r);return n&&n.id===e&&i({...n,assigned_to:t,assigned_to_profile:a.assigned_to_profile}),s(s=>s.map(s=>s.id===e?{...s,assigned_to:t,assigned_to_profile:a.assigned_to_profile}:s)),a}catch(e){return console.error("Error assigning property request:",e),m(e.message||"Failed to assign property request"),null}finally{o(!1)}},[f,j,n]),P=(0,r.useCallback)(async(e,t)=>{if(!f||!(null==j?void 0:j.access_token)||!e||!t.status)return null;o(!0),m(null);try{let r=await l.ZP.addStatusUpdate(j.access_token,e,t);return n&&n.id===e&&i({...n,status:t.status,status_history:[r.history,...n.status_history||[]]}),s(s=>s.map(s=>s.id===e?{...s,status:t.status}:s)),r}catch(e){return console.error("Error updating property request status:",e),m(e.message||"Failed to update property request status"),null}finally{o(!1)}},[f,j,n]),_=(0,r.useCallback)(e=>{u(t=>({...t,...e})),y(e=>({...e,page:1}))},[]),E=(0,r.useCallback)(e=>{y(t=>({...t,...e}))},[]);return(0,r.useEffect)(()=>{e.loadOnMount&&b()},[e.loadOnMount,b]),(0,r.useEffect)(()=>{q()},[q]),{requests:t,currentRequest:n,loading:c,error:d,filters:x,pagination:p,fields:h,fetchRequests:b,fetchRequestById:N,createRequest:v,updateRequest:w,deleteRequest:k,fetchFields:q,assignRequest:C,addStatusUpdate:P,updateFilters:_,updatePagination:E,setCurrentRequest:i}}}},function(e){e.O(0,[2438,8920,2870,6453,2971,2472,1744],function(){return e(e.s=2208)}),_N_E=e.O()}]);