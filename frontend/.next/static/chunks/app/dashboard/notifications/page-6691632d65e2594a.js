(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1258],{5229:function(e,t,r){Promise.resolve().then(r.bind(r,7863))},7863:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Notifications}});var a=r(7437),s=r(2265),n=r(5243),i=r(8611),o=r(7436),l=r(2595),c=r(4734),d=r(8920),u=r(1396),m=r.n(u);function Notifications(){let{user:e}=(0,n.a)(),{supabase:t}=(0,o.$)(),[r,u]=(0,s.useState)(!0),[h,g]=(0,s.useState)([]),[y,f]=(0,s.useState)("all");(0,s.useEffect)(()=>{let fetchNotifications=async()=>{if(e){u(!0);try{let{data:r,error:a}=await t.from("notifications").select("id").limit(1);if(a){console.error("Error checking for notifications table:",a),u(!1);return}let s=t.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});"unread"===y?s=s.eq("is_read",!1):"property"===y?s=s.eq("related_entity_type","property"):"viewing"===y?s=s.eq("related_entity_type","viewing"):"system"===y&&(s=s.eq("type","system"));let{data:n,error:i}=await s;if(i)throw i;g(n||[])}catch(e){console.error("Error fetching notifications:",e)}finally{u(!1)}}};fetchNotifications()},[t,e,y]);let markAsRead=async e=>{try{let{error:r}=await t.from("notifications").update({is_read:!0}).eq("id",e);if(r)throw r;g(h.map(t=>t.id===e?{...t,is_read:!0}:t))}catch(e){console.error("Error marking notification as read:",e)}},markAllAsRead=async()=>{try{let{error:r}=await t.from("notifications").update({is_read:!0}).eq("user_id",e.id).eq("is_read",!1);if(r)throw r;g(h.map(e=>({...e,is_read:!0})))}catch(e){console.error("Error marking all notifications as read:",e)}},deleteNotification=async e=>{try{let{error:r}=await t.from("notifications").delete().eq("id",e);if(r)throw r;g(h.filter(t=>t.id!==e))}catch(e){console.error("Error deleting notification:",e)}},formatDate=e=>{let t=new Date(e),r=new Date,a=r.getTime()-t.getTime();if(a<864e5){if(a<36e5){let e=Math.floor(a/6e4);return"".concat(e," ").concat(1===e?"minute":"minutes"," ago")}let e=Math.floor(a/36e5);return"".concat(e," ").concat(1===e?"hour":"hours"," ago")}if(a<6048e5){let e=Math.floor(a/864e5);return"".concat(e," ").concat(1===e?"day":"days"," ago")}return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},getNotificationIcon=(e,t)=>{switch(e){case"system":default:return(0,a.jsx)(d.vWP,{className:"h-4 w-4 text-gray-500"});case"alert":return(0,a.jsx)(d.bcx,{className:"h-4 w-4 text-red-500"});case"success":return(0,a.jsx)(d._rq,{className:"h-4 w-4 text-green-500"});case"update":if("property"===t)return(0,a.jsx)(d.m6D,{className:"h-4 w-4 text-primary-500"});if("viewing"===t)return(0,a.jsx)(d.vlc,{className:"h-4 w-4 text-blue-500"});if("request"===t)return(0,a.jsx)(d.j4u,{className:"h-4 w-4 text-purple-500"});return(0,a.jsx)(d.TCC,{className:"h-4 w-4 text-yellow-500"});case"message":return(0,a.jsx)(d.IC0,{className:"h-4 w-4 text-blue-500"})}},getNotificationLink=e=>{if(!e.related_entity_id||!e.related_entity_type)return"#";switch(e.related_entity_type){case"property":return"/properties/".concat(e.related_entity_id);case"viewing":return"/dashboard/scheduled-viewings/".concat(e.related_entity_id);case"request":return"/dashboard/property-requests/".concat(e.related_entity_id);default:return"#"}},x=h.filter(e=>!e.is_read).length;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Notifications"}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:"Stay updated on your property requests, viewings, and system alerts"})]}),x>0&&(0,a.jsx)(c.Z,{variant:"outline",size:"sm",leftIcon:(0,a.jsx)(d.UgA,{}),onClick:markAllAsRead,children:"Mark all as read"})]}),(0,a.jsxs)("div",{className:"flex mb-3 overflow-x-auto pb-1",children:[(0,a.jsx)("button",{onClick:()=>f("all"),className:"px-3 py-1 text-xs font-medium rounded-full mr-2 ".concat("all"===y?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"All"}),(0,a.jsxs)("button",{onClick:()=>f("unread"),className:"px-3 py-1 text-xs font-medium rounded-full mr-2 flex items-center ".concat("unread"===y?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Unread",x>0&&(0,a.jsx)("span",{className:"ml-1 bg-primary-700 text-white rounded-full h-4 w-4 flex items-center justify-center text-xs",children:x})]}),(0,a.jsxs)("button",{onClick:()=>f("property"),className:"px-3 py-1 text-xs font-medium rounded-full mr-2 flex items-center ".concat("property"===y?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,a.jsx)(d.m6D,{className:"mr-1 h-3 w-3"}),"Properties"]}),(0,a.jsxs)("button",{onClick:()=>f("viewing"),className:"px-3 py-1 text-xs font-medium rounded-full mr-2 flex items-center ".concat("viewing"===y?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,a.jsx)(d.vlc,{className:"mr-1 h-3 w-3"}),"Viewings"]}),(0,a.jsxs)("button",{onClick:()=>f("system"),className:"px-3 py-1 text-xs font-medium rounded-full flex items-center ".concat("system"===y?"bg-primary-100 text-primary-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,a.jsx)(d.nbt,{className:"mr-1 h-3 w-3"}),"System"]})]}),(0,a.jsx)(l.Z,{children:r?(0,a.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,a.jsxs)("div",{className:"relative h-10 w-10",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 bottom-0 border-t-3 border-primary-500 border-solid rounded-full animate-spin"}),(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 bottom-0 border-t-3 border-primary-200 border-solid rounded-full opacity-20"})]})}):h.length>0?(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:h.map(e=>(0,a.jsx)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"p-3 hover:bg-gray-50 transition-colors ".concat(e.is_read?"":"bg-blue-50"),children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"p-1.5 rounded-full mr-3 flex-shrink-0 ".concat("alert"===e.type?"bg-red-100":"success"===e.type?"bg-green-100":"update"===e.type&&"property"===e.related_entity_type?"bg-primary-100":"update"===e.type&&"viewing"===e.related_entity_type?"bg-blue-100":"update"===e.type&&"request"===e.related_entity_type?"bg-purple-100":"message"===e.type?"bg-blue-100":"bg-gray-100"),children:getNotificationIcon(e.type,e.related_entity_type)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsx)(m(),{href:getNotificationLink(e),className:"text-sm font-medium ".concat(e.is_read?"text-gray-700":"text-gray-900"),children:e.title}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:formatDate(e.created_at)})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:e.message}),(0,a.jsxs)("div",{className:"flex justify-end mt-2",children:[!e.is_read&&(0,a.jsxs)("button",{onClick:()=>markAsRead(e.id),className:"text-xs text-primary-600 hover:text-primary-800 mr-3 flex items-center",children:[(0,a.jsx)(d.UgA,{className:"h-3 w-3 mr-1"}),"Mark as read"]}),e.related_entity_id&&e.related_entity_type&&(0,a.jsxs)(m(),{href:getNotificationLink(e),className:"text-xs text-primary-600 hover:text-primary-800 mr-3 flex items-center",children:[(0,a.jsx)(d.rDJ,{className:"h-3 w-3 mr-1"}),"View details"]}),(0,a.jsxs)("button",{onClick:()=>deleteNotification(e.id),className:"text-xs text-red-600 hover:text-red-800 flex items-center",children:[(0,a.jsx)(d.q5L,{className:"h-3 w-3 mr-1"}),"Remove"]})]})]})]})},e.id))}):(0,a.jsxs)("div",{className:"text-center py-10",children:[(0,a.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,a.jsx)(d.vWP,{className:"h-7 w-7 text-gray-400"})}),(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900 mb-1",children:"No notifications"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 max-w-sm mx-auto mb-4",children:"all"!==y?"No notifications match your selected filter.":"You don't have any notifications yet. New notifications will appear here."}),"all"!==y&&(0,a.jsx)(c.Z,{variant:"outline",size:"xs",onClick:()=>f("all"),children:"View all notifications"})]})}),!r&&h.length>0&&(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsxs)(m(),{href:"/dashboard/settings",className:"text-xs text-primary-600 hover:text-primary-800 flex items-center justify-center",children:[(0,a.jsx)(d.nbt,{className:"h-3 w-3 mr-1"}),"Manage notification settings"]})})]})}},4734:function(e,t,r){"use strict";r.d(t,{Z:function(){return Button}});var a=r(7437);r(2265);var s=r(1396),n=r.n(s);function LoadingSpinner(e){let{size:t="medium",color:r="primary",className:s=""}=e;return(0,a.jsx)("div",{className:"flex justify-center items-center ".concat(s),children:(0,a.jsx)("div",{className:"\n          rounded-full\n          animate-spin\n          ".concat({small:"h-4 w-4 border-2",medium:"h-8 w-8 border-2",large:"h-12 w-12 border-3"}[t],"\n          ").concat({primary:"border-primary-300 border-t-primary",white:"border-gray-200 border-t-white",gray:"border-gray-200 border-t-gray-600"}[r],"\n        ")})})}function Button(e){let{children:t,variant:r="primary",size:s="md",fullWidth:i=!1,href:o,loading:l=!1,outline:c=!1,rounded:d=!0,glass:u=!1,animation:m="none",className:h="",leftIcon:g,rightIcon:y,...f}=e,x=f.disabled?"opacity-60 cursor-not-allowed":"transform active:scale-[0.98] transition-transform",p="\n    inline-flex items-center justify-center\n    font-medium\n    transition-all duration-200\n    focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\n    ".concat({primary:c?"border-2 border-primary-500 text-primary-600 hover:bg-primary-50 active:bg-primary-100":"bg-primary-600 hover:bg-primary-700 text-white shadow-sm",secondary:c?"border-2 border-gray-400 text-gray-700 hover:bg-gray-50 active:bg-gray-100":"bg-gray-600 hover:bg-gray-700 text-white shadow-sm",success:c?"border-2 border-green-500 text-green-600 hover:bg-green-50 active:bg-green-100":"bg-green-600 hover:bg-green-700 text-white shadow-sm",danger:c?"border-2 border-red-500 text-red-600 hover:bg-red-50 active:bg-red-100":"bg-red-600 hover:bg-red-700 text-white shadow-sm",warning:c?"border-2 border-amber-500 text-amber-600 hover:bg-amber-50 active:bg-amber-100":"bg-amber-500 hover:bg-amber-600 text-white shadow-sm",info:c?"border-2 border-blue-400 text-blue-500 hover:bg-blue-50 active:bg-blue-100":"bg-blue-500 hover:bg-blue-600 text-white shadow-sm",light:c?"border-2 border-gray-200 text-gray-600 hover:bg-gray-50 active:bg-gray-100":"bg-gray-100 hover:bg-gray-200 text-gray-800",dark:c?"border-2 border-gray-700 text-gray-800 hover:bg-gray-800 hover:text-white":"bg-gray-800 hover:bg-gray-900 text-white shadow-sm",outline:"border-2 border-gray-300 text-gray-700 hover:border-primary-500 hover:text-primary-600 bg-white",gradient:"bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white shadow-sm"}[r],"\n    ").concat({xs:"text-xs px-2.5 py-1.5 gap-1",sm:"text-sm px-3 py-2 gap-1.5",md:"text-base px-4 py-2.5 gap-2",lg:"text-lg px-5 py-3 gap-2",xl:"text-xl px-6 py-3.5 gap-2.5"}[s],"\n    ").concat(i?"w-full":"","\n    ").concat(d?"rounded-full":"rounded-lg","\n    ").concat(u?"backdrop-blur-sm bg-opacity-80 shadow-sm":"","\n    ").concat({none:"",pulse:"animate-pulse",bounce:"animate-bounce"}[m],"\n    ").concat(x,"\n    ").concat(h,"\n  ");return o?(0,a.jsxs)(n(),{href:o,className:p,children:[g&&(0,a.jsx)("span",{className:"flex items-center",children:g}),t,y&&(0,a.jsx)("span",{className:"flex items-center",children:y})]}):(0,a.jsxs)("button",{className:p,disabled:l||f.disabled,...f,children:[l?(0,a.jsx)(LoadingSpinner,{size:"small",color:c?"primary":"white"}):g?(0,a.jsx)("span",{className:"flex items-center",children:g}):null,(0,a.jsx)("span",{children:t}),y&&!l&&(0,a.jsx)("span",{className:"flex items-center",children:y})]})}},2595:function(e,t,r){"use strict";r.d(t,{Z:function(){return Card}});var a=r(7437);function Card(e){let{children:t,className:r="",padding:s="small",shadow:n="small",rounded:i="medium",border:o=!1,hover:l=!1,clickable:c=!1}=e;return(0,a.jsx)("div",{className:"\n        bg-white\n        ".concat({none:"p-0",xs:"p-2",small:"p-3",medium:"p-4",large:"p-5"}[s],"\n        ").concat({none:"",small:"shadow-sm",medium:"shadow",large:"shadow-lg"}[n],"\n        ").concat({none:"rounded-none",small:"rounded-md",medium:"rounded-lg",large:"rounded-xl"}[i],"\n        ").concat(o?"border border-gray-100":"","\n        ").concat(l?"transition-all duration-200 hover:shadow-md hover:translate-y-[-1px]":"","\n        ").concat(c?"cursor-pointer active:scale-[0.99] active:shadow-inner transition-transform":"","\n        ").concat(r,"\n      "),children:t})}r(2265)},7436:function(e,t,r){"use strict";r.d(t,{$:function(){return useSupabase}}),r(7437);let useSupabase=()=>{throw Error("useSupabase has been deprecated. Use the backend API endpoints instead.")}},5243:function(e,t,r){"use strict";r.d(t,{a:function(){return useAuth}});var a=r(4523);function useAuth(){var e;let t=(0,a.useAuth)(),r=(null===(e=t.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,r)=>{try{return await t.signIn(e,r),{error:null}}catch(e){return{error:e}}},signUp=async(e,r,a)=>{try{return await t.signUp(e,r,a),{error:null}}catch(e){return{error:e}}};return{...t,role:r,signIn,signUp}}},4523:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},default:function(){return c},useAuth:function(){return useAuth}});var a=r(7437),s=r(2265);let n="bigdealegypt.up.railway.app/api",signIn=async(e,t)=>{try{let a=await fetch("".concat(n,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Authentication failed")}return await a.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,t,r)=>{try{let s=await fetch("".concat(n,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t,name:r})});if(!s.ok){var a;let e=await s.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Registration failed")}return await s.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let t=await fetch("".concat(n,"/auth/signout"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await t.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let r=await fetch("".concat(n,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var t;let e=await r.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to retrieve session")}return await r.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let t=await fetch("".concat(n,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!t.ok){var e;let r=await t.json();throw Error((null===(e=r.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await t.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,t)=>{try{let a=await fetch("".concat(n,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(t)}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to get user profile")}return await a.json()}catch(e){throw console.error("Get user profile error:",e),e}};var i={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},o=r(4033);let l=(0,s.createContext)(void 0),AuthProvider=e=>{let{children:t}=e,[r,n]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0),[h,g]=(0,s.useState)(null),y=(0,o.useRouter)();(0,s.useEffect)(()=>{if(c){let e=new Date(c.expires_at).getTime(),t=Date.now(),r=e-t;if(r<3e5){refreshSession();return}let a=setTimeout(()=>{refreshSession()},r-3e5);return()=>clearTimeout(a)}},[c]),(0,s.useEffect)(()=>{let initAuth=async()=>{m(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){m(!1);return}let t=await i.getSession(e);(null==t?void 0:t.user)&&(null==t?void 0:t.session)?(n(t.user),d(t.session),localStorage.setItem("access_token",t.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{m(!1)}};initAuth()},[]);let signIn=async(e,t)=>{m(!0),g(null);try{let r=await i.signIn(e,t);(null==r?void 0:r.user)&&(null==r?void 0:r.session)&&(n(r.user),d(r.session),localStorage.setItem("access_token",r.session.access_token),y.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{m(!1)}},signUp=async(e,t,r)=>{m(!0),g(null);try{let a=await i.signUp(e,t,r);(null==a?void 0:a.user)&&y.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{m(!1)}},signOut=async()=>{m(!0);try{await i.signOut(),n(null),d(null),localStorage.removeItem("access_token"),y.push("/")}catch(e){console.error("Sign out error:",e),n(null),d(null),localStorage.removeItem("access_token"),y.push("/")}finally{m(!1)}},refreshSession=async()=>{if(!u)try{let e=await i.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(n(e.user),d(e.session),localStorage.setItem("access_token",e.session.access_token)):(n(null),d(null),localStorage.removeItem("access_token"),y.push("/login"))}catch(e){console.error("Session refresh error:",e),n(null),d(null),localStorage.removeItem("access_token"),y.push("/login")}};return(0,a.jsx)(l.Provider,{value:{user:r,session:c,loading:u,error:h,isAuthenticated:!!r,signIn,signUp,signOut,refreshSession},children:t})},useAuth=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var c=l},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[2438,8920,8611,2971,2472,1744],function(){return e(e.s=5229)}),_N_E=e.O()}]);