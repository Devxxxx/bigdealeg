(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9091],{9633:function(e,t,i){Promise.resolve().then(i.bind(i,171))},171:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return AdminLayout}});var a=i(7437);i(2265);var r=i(8133),s=i(4999);function AdminLayout(e){let{children:t}=e;return(0,a.jsx)(s.Z,{allowedRoles:["admin"],children:(0,a.jsx)(r.Z,{sidebarType:"admin",children:t})})}},4999:function(e,t,i){"use strict";i.d(t,{Z:function(){return ProtectedRoute}});var a=i(7437),r=i(2265),s=i(4033),l=i(5243);let checkAuthorization=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["customer","sales_ops","admin"];try{let a=new URLSearchParams;t&&t.length&&a.append("roles",t.join(","));let r=await fetch("".concat("bigdealegypt.up.railway.app/api","/protected-route/check-authorization?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok){var i;let e=await r.json();throw Error((null===(i=e.error)||void 0===i?void 0:i.message)||"Authorization check failed")}return await r.json()}catch(e){throw console.error("Check authorization error:",e),e}};var n={checkAuthorization};let o=r.memo(()=>(0,a.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center bg-white z-50",children:[(0,a.jsxs)("div",{className:"w-16 h-16 mb-4 relative",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full border-4 border-primary-100 rounded-full"}),(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full border-4 border-primary-600 rounded-full animate-spin border-t-transparent"})]}),(0,a.jsx)("p",{className:"text-gray-600 animate-pulse",children:"Loading..."})]})),d=r.memo(()=>{let e=(0,s.useRouter)();return(0,r.useEffect)(()=>{let t=setTimeout(()=>{e.replace("/login")},2e3);return()=>clearTimeout(t)},[e]),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-red-600 px-6 py-8 text-white",children:[(0,a.jsx)("div",{className:"mx-auto w-16 h-16 flex items-center justify-center bg-white bg-opacity-20 rounded-full mb-4",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z",clipRule:"evenodd"})})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-center",children:"Access Denied"})]}),(0,a.jsx)("div",{className:"px-6 py-8",children:(0,a.jsx)("p",{className:"text-gray-600 mb-6 text-center",children:"You don't have permission to access this page. Redirecting to login page..."})})]})})});function ProtectedRoute(e){let{children:t,allowedRoles:i=["customer","sales_ops","admin"]}=e,[c,u]=(0,r.useState)("loading"),h=(0,s.useRouter)(),{user:m,session:f}=(0,l.a)();return((0,r.useEffect)(()=>{let checkAuthorization=async()=>{try{if(!m||!(null==f?void 0:f.access_token)){u("unauthenticated"),setTimeout(()=>{h.replace("/login")},100);return}let{authState:e}=await n.checkAuthorization(f.access_token,i);"authorized"===e?u("authorized"):u("unauthorized")}catch(e){console.error("Authorization check failed:",e),e instanceof Error&&(e.message.includes("Access denied")||e.message.includes("role not allowed"))?u("unauthorized"):(u("unauthenticated"),setTimeout(()=>{h.replace("/login")},100))}};checkAuthorization()},[i,h,m,f]),"loading"===c)?(0,a.jsx)(o,{}):"unauthorized"===c?(0,a.jsx)(d,{}):"unauthenticated"===c?(0,a.jsx)(o,{}):(0,a.jsx)(a.Fragment,{children:t})}},8133:function(e,t,i){"use strict";i.d(t,{Z:function(){return UniversalLayout}});var a=i(7437),r=i(2265),s=i(6114),l=i(9557),n=i(4033),o=i(5243);function UniversalLayout(e){let{children:t,sidebarType:i="customer"}=e,{user:d}=(0,o.a)(),[c,u]=(0,r.useState)(!1),[h,m]=(0,r.useState)(!1),[f,x]=(0,r.useState)(!0),g=(0,n.usePathname)();(0,r.useEffect)(()=>{m(!1)},[g]),(0,r.useEffect)(()=>{let handleResize=()=>{let e=window.innerWidth>=1024;x(e),e?m(!1):u(!0)};return handleResize(),window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[]);let toggleMobileSidebar=()=>{m(!h)};return d?(0,a.jsxs)("div",{className:"flex h-screen overflow-hidden bg-gray-50",children:[(0,a.jsx)("div",{className:"hidden lg:block fixed inset-y-0 left-0 z-20 transition-all duration-300",style:{width:c?"5rem":"16rem"},children:(0,a.jsx)(l.Z,{isCollapsed:c,toggleSidebar:()=>{u(!c)},sidebarType:i})}),h&&(0,a.jsx)("div",{className:"lg:hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-20 transition-opacity duration-300",onClick:toggleMobileSidebar}),(0,a.jsx)("div",{className:"lg:hidden fixed inset-y-0 left-0 z-30 transform transition-transform duration-300 ease-in-out ".concat(h?"translate-x-0":"-translate-x-full"),style:{width:"16rem"},children:(0,a.jsx)(l.Z,{isCollapsed:!1,toggleSidebar:toggleMobileSidebar,sidebarType:i})}),(0,a.jsx)("div",{className:"flex-1 flex flex-col w-full transition-all duration-300",children:(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-screen",style:{marginLeft:f?c?"5rem":"16rem":"0"},children:[(0,a.jsx)(s.Z,{toggleSidebar:toggleMobileSidebar,isSidebarCollapsed:c}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:t})})]})})]}):(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[(0,a.jsx)(s.Z,{toggleSidebar:toggleMobileSidebar,isSidebarCollapsed:!1}),(0,a.jsx)("main",{className:"flex-1",children:t})]})}}},function(e){e.O(0,[2438,8920,6114,9557,2971,2472,1744],function(){return e(e.s=9633)}),_N_E=e.O()}]);