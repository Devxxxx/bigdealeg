(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5988],{7401:function(e,r,t){Promise.resolve().then(t.bind(t,8085))},8085:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return AuthLayout}});var n=t(7437);t(2265);var o=t(508);function AuthLayout(e){let{children:r}=e;return(0,n.jsx)(o.Z,{children:r})}},508:function(e,r,t){"use strict";t.d(r,{Z:function(){return PublicRoute}});var n=t(7437),o=t(2265),s=t(4033),i=t(5243);let LoadingSpinner=()=>(0,n.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})});function PublicRoute(e){let{children:r}=e,{isAuthenticated:t,loading:a,role:u}=(0,i.a)(),l=(0,s.useRouter)(),c=(0,s.useSearchParams)(),h=null==c?void 0:c.get("redirect");return((0,o.useEffect)(()=>{if(!a&&t){if(h){l.push(h);return}"admin"===u?l.push("/admin"):"sales_ops"===u?l.push("/sales-ops"):l.push("/dashboard")}},[a,t,u,l,h]),a)?(0,n.jsx)(LoadingSpinner,{}):t?null:(0,n.jsx)(n.Fragment,{children:r})}},5243:function(e,r,t){"use strict";t.d(r,{a:function(){return useAuth}});var n=t(4523);function useAuth(){var e;let r=(0,n.useAuth)(),t=(null===(e=r.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,t)=>{try{return await r.signIn(e,t),{error:null}}catch(e){return{error:e}}},signUp=async(e,t,n)=>{try{return await r.signUp(e,t,n),{error:null}}catch(e){return{error:e}}};return{...r,role:t,signIn,signUp}}},4523:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return AuthProvider},default:function(){return l},useAuth:function(){return useAuth}});var n=t(7437),o=t(2265);let s="bigdealegypt.up.railway.app/api",signIn=async(e,r)=>{try{let n=await fetch("".concat(s,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r}),credentials:"include"});if(!n.ok){var t;let e=await n.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Authentication failed")}return await n.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,r,t)=>{try{let o=await fetch("".concat(s,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r,name:t})});if(!o.ok){var n;let e=await o.json();throw Error((null===(n=e.error)||void 0===n?void 0:n.message)||"Registration failed")}return await o.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let r=await fetch("".concat(s,"/auth/signout"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await r.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let t=await fetch("".concat(s,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to retrieve session")}return await t.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let r=await fetch("".concat(s,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await r.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,r)=>{try{let n=await fetch("".concat(s,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(r)}});if(!n.ok){var t;let e=await n.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to get user profile")}return await n.json()}catch(e){throw console.error("Get user profile error:",e),e}};var i={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},a=t(4033);let u=(0,o.createContext)(void 0),AuthProvider=e=>{let{children:r}=e,[t,s]=(0,o.useState)(null),[l,c]=(0,o.useState)(null),[h,f]=(0,o.useState)(!0),[d,g]=(0,o.useState)(null),v=(0,a.useRouter)();(0,o.useEffect)(()=>{if(l){let e=new Date(l.expires_at).getTime(),r=Date.now(),t=e-r;if(t<3e5){refreshSession();return}let n=setTimeout(()=>{refreshSession()},t-3e5);return()=>clearTimeout(n)}},[l]),(0,o.useEffect)(()=>{let initAuth=async()=>{f(!0),g(null);try{let e=localStorage.getItem("access_token");if(!e){f(!1);return}let r=await i.getSession(e);(null==r?void 0:r.user)&&(null==r?void 0:r.session)?(s(r.user),c(r.session),localStorage.setItem("access_token",r.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),g("Authentication error. Please login again.")}finally{f(!1)}};initAuth()},[]);let signIn=async(e,r)=>{f(!0),g(null);try{let t=await i.signIn(e,r);(null==t?void 0:t.user)&&(null==t?void 0:t.session)&&(s(t.user),c(t.session),localStorage.setItem("access_token",t.session.access_token),v.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),g(e instanceof Error?e.message:"Authentication failed"),e}finally{f(!1)}},signUp=async(e,r,t)=>{f(!0),g(null);try{let n=await i.signUp(e,r,t);(null==n?void 0:n.user)&&v.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),g(e instanceof Error?e.message:"Registration failed"),e}finally{f(!1)}},signOut=async()=>{f(!0);try{await i.signOut(),s(null),c(null),localStorage.removeItem("access_token"),v.push("/")}catch(e){console.error("Sign out error:",e),s(null),c(null),localStorage.removeItem("access_token"),v.push("/")}finally{f(!1)}},refreshSession=async()=>{if(!h)try{let e=await i.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(s(e.user),c(e.session),localStorage.setItem("access_token",e.session.access_token)):(s(null),c(null),localStorage.removeItem("access_token"),v.push("/login"))}catch(e){console.error("Session refresh error:",e),s(null),c(null),localStorage.removeItem("access_token"),v.push("/login")}};return(0,n.jsx)(u.Provider,{value:{user:t,session:l,loading:h,error:d,isAuthenticated:!!t,signIn,signUp,signOut,refreshSession},children:r})},useAuth=()=>{let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var l=u},622:function(e,r,t){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=t(2265),o=Symbol.for("react.element"),s=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function q(e,r,t){var n,s={},l=null,c=null;for(n in void 0!==t&&(l=""+t),void 0!==r.key&&(l=""+r.key),void 0!==r.ref&&(c=r.ref),r)i.call(r,n)&&!u.hasOwnProperty(n)&&(s[n]=r[n]);if(e&&e.defaultProps)for(n in r=e.defaultProps)void 0===s[n]&&(s[n]=r[n]);return{$$typeof:o,type:e,key:l,ref:c,props:s,_owner:a.current}}r.Fragment=s,r.jsx=q,r.jsxs=q},7437:function(e,r,t){"use strict";e.exports=t(622)},4033:function(e,r,t){e.exports=t(94)}},function(e){e.O(0,[2971,2472,1744],function(){return e(e.s=7401)}),_N_E=e.O()}]);