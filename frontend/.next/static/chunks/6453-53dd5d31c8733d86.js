"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6453],{5243:function(e,r,t){t.d(r,{a:function(){return useAuth}});var o=t(4523);function useAuth(){var e;let r=(0,o.useAuth)(),t=(null===(e=r.user)||void 0===e?void 0:e.role)||"customer",signIn=async(e,t)=>{try{return await r.signIn(e,t),{error:null}}catch(e){return{error:e}}},signUp=async(e,t,o)=>{try{return await r.signUp(e,t,o),{error:null}}catch(e){return{error:e}}};return{...r,role:t,signIn,signUp}}},4389:function(e,r,t){t.d(r,{Od:function(){return addStatusUpdate},im:function(){return getPropertyRequests}});let o="bigdealegypt.up.railway.app/api",getPropertyRequests=async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=new URLSearchParams;Object.entries(r).forEach(e=>{let[r,t]=e;null!=t&&a.append(r,t.toString())}),a.has("viewAll")||"customer"===r.role?a.has("viewAll")||a.append("viewAll","false"):a.append("viewAll","true"),a.append("_t",Date.now());let s=await fetch("".concat(o,"/property-requests?").concat(a.toString()),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!s.ok){var t;let e=await s.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch property requests")}return await s.json()}catch(e){throw console.error("Get property requests error:",e),e}},getPropertyRequestById=async(e,r)=>{try{if(!r)throw Error("Request ID is required");let a=await fetch("".concat(o,"/property-requests/").concat(r),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to fetch property request")}return await a.json()}catch(e){throw console.error("Get property request error:",e),e}},createPropertyRequest=async(e,r)=>{try{let a=await fetch("".concat(o,"/property-requests"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to create property request")}return await a.json()}catch(e){throw console.error("Create property request error:",e),e}},updatePropertyRequest=async(e,r,t)=>{try{if(!r)throw Error("Request ID is required");let s=await fetch("".concat(o,"/property-requests/").concat(r),{method:"PUT",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){var a;let e=await s.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update property request")}return await s.json()}catch(e){throw console.error("Update property request error:",e),e}},deletePropertyRequest=async(e,r)=>{try{if(!r)throw Error("Request ID is required");let a=await fetch("".concat(o,"/property-requests/").concat(r),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to delete property request")}return await a.json()}catch(e){throw console.error("Delete property request error:",e),e}},getPropertyRequestFields=async e=>{try{let t=Date.now(),a=await fetch("".concat(o,"/property-requests/fields?_t=").concat(t),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!a.ok){var r;let e=await a.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to fetch property request fields")}return await a.json()}catch(e){throw console.error("Get property request fields error:",e),e}},assignPropertyRequest=async function(e,r,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";try{if(!r)throw Error("Request ID is required");if(!t)throw Error("Sales operator ID is required");let n=await fetch("".concat(o,"/property-requests/").concat(r,"/assign"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({salesOpId:t,notes:a})});if(!n.ok){var s;let e=await n.json();throw Error((null===(s=e.error)||void 0===s?void 0:s.message)||"Failed to assign property request")}return await n.json()}catch(e){throw console.error("Assign property request error:",e),e}},addStatusUpdate=async(e,r,t)=>{try{if(!r)throw Error("Request ID is required");if(!t.status)throw Error("Status is required");let s=await fetch("".concat(o,"/property-requests/").concat(r,"/status"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){var a;let e=await s.json();throw Error((null===(a=e.error)||void 0===a?void 0:a.message)||"Failed to update property request status")}return await s.json()}catch(e){throw console.error("Add status update error:",e),e}};r.ZP={getPropertyRequests,getPropertyRequestById,createPropertyRequest,updatePropertyRequest,deletePropertyRequest,getPropertyRequestFields,assignPropertyRequest,addStatusUpdate}},4523:function(e,r,t){t.r(r),t.d(r,{AuthProvider:function(){return AuthProvider},default:function(){return l},useAuth:function(){return useAuth}});var o=t(7437),a=t(2265);let s="bigdealegypt.up.railway.app/api",signIn=async(e,r)=>{try{let o=await fetch("".concat(s,"/auth/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r}),credentials:"include"});if(!o.ok){var t;let e=await o.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Authentication failed")}return await o.json()}catch(e){throw console.error("Sign in error:",e),e}},signUp=async(e,r,t)=>{try{let a=await fetch("".concat(s,"/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r,name:t})});if(!a.ok){var o;let e=await a.json();throw Error((null===(o=e.error)||void 0===o?void 0:o.message)||"Registration failed")}return await a.json()}catch(e){throw console.error("Sign up error:",e),e}},signOut=async()=>{try{let r=await fetch("".concat(s,"/auth/signout"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Sign out failed")}return await r.json()}catch(e){throw console.error("Sign out error:",e),e}},getSession=async e=>{try{let t=await fetch("".concat(s,"/auth/session"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)},credentials:"include"});if(!t.ok){var r;let e=await t.json();throw Error((null===(r=e.error)||void 0===r?void 0:r.message)||"Failed to retrieve session")}return await t.json()}catch(e){throw console.error("Get session error:",e),e}},refreshToken=async()=>{try{let r=await fetch("".concat(s,"/auth/refresh-token"),{method:"POST",credentials:"include"});if(!r.ok){var e;let t=await r.json();throw Error((null===(e=t.error)||void 0===e?void 0:e.message)||"Failed to refresh token")}return await r.json()}catch(e){throw console.error("Refresh token error:",e),e}},getUserProfile=async(e,r)=>{try{let o=await fetch("".concat(s,"/auth/profile/").concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(r)}});if(!o.ok){var t;let e=await o.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to get user profile")}return await o.json()}catch(e){throw console.error("Get user profile error:",e),e}};var n={signIn,signUp,signOut,getSession,refreshToken,getUserProfile},i=t(4033);let c=(0,a.createContext)(void 0),AuthProvider=e=>{let{children:r}=e,[t,s]=(0,a.useState)(null),[l,u]=(0,a.useState)(null),[h,d]=(0,a.useState)(!0),[p,y]=(0,a.useState)(null),g=(0,i.useRouter)();(0,a.useEffect)(()=>{if(l){let e=new Date(l.expires_at).getTime(),r=Date.now(),t=e-r;if(t<3e5){refreshSession();return}let o=setTimeout(()=>{refreshSession()},t-3e5);return()=>clearTimeout(o)}},[l]),(0,a.useEffect)(()=>{let initAuth=async()=>{d(!0),y(null);try{let e=localStorage.getItem("access_token");if(!e){d(!1);return}let r=await n.getSession(e);(null==r?void 0:r.user)&&(null==r?void 0:r.session)?(s(r.user),u(r.session),localStorage.setItem("access_token",r.session.access_token)):localStorage.removeItem("access_token")}catch(e){console.error("Auth initialization error:",e),localStorage.removeItem("access_token"),y("Authentication error. Please login again.")}finally{d(!1)}};initAuth()},[]);let signIn=async(e,r)=>{d(!0),y(null);try{let t=await n.signIn(e,r);(null==t?void 0:t.user)&&(null==t?void 0:t.session)&&(s(t.user),u(t.session),localStorage.setItem("access_token",t.session.access_token),g.push("/dashboard"))}catch(e){throw console.error("Sign in error:",e),y(e instanceof Error?e.message:"Authentication failed"),e}finally{d(!1)}},signUp=async(e,r,t)=>{d(!0),y(null);try{let o=await n.signUp(e,r,t);(null==o?void 0:o.user)&&g.push("/login?registered=true")}catch(e){throw console.error("Sign up error:",e),y(e instanceof Error?e.message:"Registration failed"),e}finally{d(!1)}},signOut=async()=>{d(!0);try{await n.signOut(),s(null),u(null),localStorage.removeItem("access_token"),g.push("/")}catch(e){console.error("Sign out error:",e),s(null),u(null),localStorage.removeItem("access_token"),g.push("/")}finally{d(!1)}},refreshSession=async()=>{if(!h)try{let e=await n.refreshToken();(null==e?void 0:e.user)&&(null==e?void 0:e.session)?(s(e.user),u(e.session),localStorage.setItem("access_token",e.session.access_token)):(s(null),u(null),localStorage.removeItem("access_token"),g.push("/login"))}catch(e){console.error("Session refresh error:",e),s(null),u(null),localStorage.removeItem("access_token"),g.push("/login")}};return(0,o.jsx)(c.Provider,{value:{user:t,session:l,loading:h,error:p,isAuthenticated:!!t,signIn,signUp,signOut,refreshSession},children:r})},useAuth=()=>{let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e};var l=c}}]);